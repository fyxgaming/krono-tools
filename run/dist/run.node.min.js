module.exports=function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"u",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.u)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.u?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=35)}([function(t,e,n){const{h:r,g:o,_:i,P:s,O:c,S:a,v:u,A:h,I:f,j:l,R:p,k:y,$:d,C:g,U:w}=n(1),b=n(26),_=n(3),{N:m,F:P}=n(10),O=n(11),{B:E}=n(5),{M:S,D:v,L:A,G:I,J:x}=O,j=n(18),T=n(6),R=n(4),k=n(23),$=n(19),C=R.W,U="Code",N=new WeakMap,F={},B=new Map,M={},D=[Symbol.hasInstance],L=["auth","sync",...S];class Code{constructor(t,e=!0,r=[]){const o=V(t);if(o)return o;const i=new b,s=new G,c=new(n(22))(i);return b.H(i,c),s.V(c,i),N.set(c,s),T.K.add(c),t&&s.q(t,e,r),r.push(c),c}toString(){const t=N.get(this);if(!t)return E(()=>this.toString());const e=t.Y,n=d(e.toString(),t.Z.name);return t.X?n.startsWith("class")?`class ${e.name} { [native code] }`:`function ${e.name}() { [native code] }`:n}async sync(t={}){_.tt(U,"Sync",r(this));const e=N.get(this);if(s(e,"sync unavailable"),e.X)return;const o=n(33);return await o(this,t),this}upgrade(t,e=!0){const o=n(13),i=n(8);if(_.tt(U,"Upgrade",r(this),"to",r(t)),i.nt.et.length)throw new Error("upgrade unavailable");const c=N.get(this);s(c&&!c.X,"upgrade unavailable");const a=new k(this);try{const n=[];c.q(t,e,n),i.nt.rt(()=>{n.length&&z(...n),o.ot(this,a)})}catch(t){throw a.it(),t}return this}auth(){_.tt(U,"Auth",r(this));const t=N.get(this);s(t&&!t.X,"auth unavailable");return n(13).st(this),this}destroy(){_.tt(U,"Destroy",r(this));const t=N.get(this);s(t&&!t.X,"destroy unavailable");return n(13).ct(this),this}static[Symbol.hasInstance](t){return T.K.has(t)}}class G{V(t,e){this.Z=void 0,this.Y=e,this.at=t,this.ut=!1,this.ht=!1,this.ft=!1,this.lt="";try{this.lt=o().pt.network}catch(t){}this.X=void 0,this.yt=!1}q(t,e=!0,n=[]){if(_.tt(U,"Install",r(t)),this.ut)return p(t===this.Z),this.dt();p(!this.X);const o=b.gt(this.Y);F[this.lt]=F[this.lt]||new Map,F[this.lt].delete(this.Z),e&&F[this.lt].set(t,this.at);try{this.wt(t,e,n),this.bt(),this._t(this.ht?o:null),this.Z=t,this.ft=e,this.ut=!1,this.ht=!0,this.X=!1,this.yt=!1}catch(e){throw F[this.lt].delete(t),this.local&&F[this.lt].set(this.Z,this.at),b.Pt(this.Y,o),e}}Ot(t){if(this.ut)return;let e=!0;try{o()}catch(t){e=!1}if(e)this.q(t);else{if(_.tt(U,"Preinstall",r(t)),this.ht||this.X)throw new Error("Cannot preinstall "+r(t));B.set(t,this.at);try{this.wt(t,!0),this.Z=t,this.ft=!0,this.ut=!0,this.ht=!1,this.X=!1,this.yt=!1}catch(e){throw B.delete(t),e}}}dt(){if(this.ut){_.tt(U,"Postinstall",r(this.Z)),this.lt=o().pt.network;try{B.delete(this.Z),F[this.lt]=F[this.lt]||new Map,F[this.lt].set(this.Z,this.at),this.bt(),this._t(),this.ut=!1,this.ht=!0}catch(t){throw B.set(this.Z,this.at),F[this.lt].delete(this.Z),this.lt="",t}}}wt(t,e=!1,r=[]){const o=e?H(this.at,t,e,r)[0]:t,Jig=n(2),i=y(t,Jig)?j.Et():j.St();if($.At(this.at).vt=i,this.ht){const e=y(this.Z,Jig),n=y(t,Jig);s(e===n,"Cannot change staticness of code in upgrade")}Object.getOwnPropertyNames(o.prototype).filter(t=>"constructor"!==t).forEach(t=>{const e=n(22),r=j.It(this.at,!0,!0);o.prototype[t]=new e(o.prototype[t],r)}),b.Pt(this.Y,o)}bt(){E(()=>{if(f(this.at,"presets")){const t=this.at.presets[this.lt];Object.getOwnPropertyNames(t||{}).forEach(e=>l(this.at,e,t[e])),delete this.at.presets}})}_t(t){E(()=>{t?S.forEach(e=>l(this.at,e,t[e])):f(this.at,"location")||O.V(this.at)})}xt(t,e=!1){_.tt(U,"Install native",r(t)),p(void 0===this.X),p(!c(t)),p(!(t.name in M));const[n,o]=R.jt(t,{},!0,!1);Object.assign(o,t.deps);const i=t.sealed;process.env.COVER&&Object.keys(n).forEach(t=>{delete n[t]}),f(n,"sealed")&&l(n,"sealed",i),b.Pt(this.Y,n),n.origin="native://"+t.name,n.location="native://"+t.name,n.nonce=0,n.owner=null,n.satoshis=null,M[t.name]=this.at,$.At(this.at).vt=j.Tt(),this.Z=t,this.ut=!1,this.ht=!0,this.ft=!0,this.X=!0,this.yt=e}Rt(){_.kt(U,"Deploy",r(this.at)),this.dt(),s(!this.X,"Cannot deploy native code"),z(this.at)}$t(){if(!this.ft)return;const t=this.Z;f(t,"presets")||l(t,"presets",{}),f(t.presets,this.lt)||l(t.presets,this.lt,{}),E(()=>{S.forEach(e=>{const n=t.presets[this.lt];f(n,e)||l(n,e,this.at[e]),f(t,e)||l(t,e,this.at[e])})})}}function J(t){i("function"==typeof t,"Only functions and classes are supported: "+r(t)),W(t),i(!t.prototype||t.prototype.constructor===t,"Prototypal inheritance not supported: "+r(t)),i(!a(t),"Anonymous types not supported: "+r(t)),i(t!==Code,"The Code class itself cannot be used in code"),i(-1===t.toString().indexOf("[native code]"),"Cannot install intrinsic: "+r(t)),function(t){const Jig=n(2);if(!y(t,Jig))return;const e="Cannot override Jig methods or properties";D.forEach(n=>{s(!Object.getOwnPropertyNames(t).includes(n),e),s(!Object.getOwnPropertySymbols(t).includes(n),e)}),L.forEach(n=>{s(!Object.getOwnPropertyNames(t.prototype).includes(n),e),s(!Object.getOwnPropertySymbols(t.prototype).includes(n),e)})}(t),function(t){const e="Symbol methods not supported";E(()=>{s(!Object.getOwnPropertySymbols(t).length,e),s(!Object.getOwnPropertySymbols(t.prototype).length,e)})}(t),function(t){const e="Getters and setters not supported",n=t=>s(!("get"in t||"set"in t),e);E(()=>{Object.getOwnPropertyNames(t).map(e=>Object.getOwnPropertyDescriptor(t,e)).forEach(t=>n(t)),Object.getOwnPropertyNames(t.prototype).map(e=>Object.getOwnPropertyDescriptor(t.prototype,e)).forEach(t=>n(t))})}(t)}function W(t){const e=Object.getOwnPropertyNames(t),n=g.find(t=>e.includes(t))||w.find(t=>e.includes(t));i(!n,"Must not have any reserved words: "+n)}function H(t,e,r=!1,o){J(e),function(t,e){if(!e.ht)return;if(s(!e.X,"Cannot upgrade native code"),i(!(t instanceof Code),"Cannot upgrade to a code jig"),f(t,"presets")){const n=t.presets[e.lt],r="Preset bindings not supported for upgrades",o=t=>s(!(t in n),r);O.M.forEach(t=>o(t))}const n=E(()=>e.at.origin);s(n!==O.Ct,"Cannot upgrade undeployed code")}(e,N.get(t));const a=c(e),p=a&&new Code(a,r,o);p&&Code.Ut(p).dt(),function(t,e){if(f(t,"deps")){if(i(h(t.deps),"deps must be a basic object"),e){const n=t.deps[e.name],r=V(n);i(!n||r===e,"Parent dependency mismatch")}i(!(t.name in t.deps),"Illegal dependency")}}(e,p),function(t){if(!f(t,"presets"))return;const e=t.presets;i(h(e),"presets must be a basic object");for(const t of Object.keys(e)){const n=e[t];i(h(n),`Presets for ${t} network must be an object`);const r=S.some(t=>!u(n[t])),o=!S.some(t=>u(n[t]));if(i(!r||o,t+" presets not fully defined"),r){const t=v(n.location);i(t.txid&&("vout"in t||"vdel"in t)&&!("berry"in t),"Bad location");const e=v(n.origin);i(e.txid&&("vout"in e||"vdel"in e)&&!("berry"in e),"Bad origin"),A(n.nonce),I(n.owner,!0),x(n.satoshis)}i(!("deps"in n),t+" presets must not contain deps"),i(!("presets"in n),t+" presets must not contain presets"),W(n)}}(e),function(t){if(f(t,"sealed")){const e="Invalid sealed option: "+t.sealed;i(!0===t.sealed||!1===t.sealed||"owner"===t.sealed,e)}}(e),function(t){const e=Object.getOwnPropertyNames(t),n=S.find(t=>e.includes(t));i(!n,"Must not have any bindings: "+n)}(e);const y={};p&&(y[p.name]=p);const[d,g]=R.jt(e,y,!1,!0);Object.defineProperty(d,"name",{value:e.name,configurable:!0});const w=Object.assign({},e),b=m(w,C,t=>"function"==typeof t?new Code(t,r,o):void 0);return p&&(b.deps=b.deps||new C.Object,b.deps[p.name]=p),Object.assign(g,b.deps),g[e.name]=t,Object.keys(b).forEach(t=>l(d,t,b[t])),function(t){if("caller"in t)return;const e=n(8);Object.defineProperty(t,"caller",{get:()=>e.nt.Nt(),set:()=>{throw new Error("Cannot set caller")},configurable:!0,enumerable:!0})}(g),[d,g]}function z(...t){const e=n(13),r=new Set;t.forEach(t=>{const e=N.get(t);p(!e.X);(function t(e,r=new Set){if(p(e instanceof Code),r.has(e))return;const o=E(()=>e.location),{undeployed:i}=v(o);if(!i)return r;const s=c(e);s&&t(s,r);r.add(e);const a=E(()=>Object.assign({},e)),u=n(6);return P(a,e=>(e instanceof Code&&t(e,r),!(e instanceof u))),r})(t=V(t)).forEach(t=>r.add(t))}),r.size&&e.Rt([...r])}function V(t){if(N.has(t))return t;let e="";try{e=o().pt.network}catch(t){}const n=F[e];if(!n)return;if(n.has(t))return n.get(t);const r=f(t,"presets")&&f(t.presets,e)&&t.presets[e].location;if(r)for(const t of n.values())if(E(()=>t.location)===r)return t}Code.Ft=z,Code.Bt=V,Code.Mt=function(t){p(t.startsWith("native://"));const e=t.slice("native://".length),n=M[e];if(n)return p(!N.get(n).yt),n},Code.Dt=function(){let t="";try{t=o().pt.network}catch(t){}function e(t,e){S.forEach(t=>{delete e[t]})}_.kt(U,"Deactivate",t,"bindings"),F[t]&&E(()=>F[t].forEach(e))},Code.Lt=function(){let t="";try{t=o().pt.network}catch(t){}if(_.kt(U,"Activate",t,"bindings"),F[t]){E(()=>F[t].forEach(e));for(const t of B.values())Code.Ut(t).dt();B.clear()}function e(e,n){S.forEach(e=>{const r=f(n,"presets")&&f(n.presets,t)&&n.presets[t][e];l(n,e,r)})}},Code.Gt=H,Code.Ot=function(t){const e=new Code;return Code.Ut(e).Ot(t),e},Code.Ut=t=>N.get(V(t)),t.exports=Code},function(t,e,n){const{ArgumentError,StateError,InternalError}=n(12),{B:r}=n(5),o=n(6);function i(t){return"object"==typeof t&&!!t&&2===y(t)}function s(t){return Array.isArray(t)&&3===y(t)}function c(t){const e=n(4),r=e.W;return(t instanceof e.Jt.Set||t instanceof r.Set)&&3===y(t)}function a(t){const e=n(4),r=e.W;return(t instanceof e.Jt.Map||t instanceof r.Map)&&3===y(t)}function u(t){const e=n(4),r=e.W;return(t instanceof e.Jt.Uint8Array||t instanceof r.Uint8Array)&&4===y(t)}function h(t){if("object"!=typeof t||!t)return!1;const Code=n(0);if(!(t.constructor instanceof Code))return!1;if(t instanceof n(2))return!1;return!(t instanceof n(25))}const f=/^class\s*{/,l=/^class\s+(extends)?\s+\S+\s*{/,p=/^function\s*\(/;function y(t){if(!t)return 0;let e=0;do{e++,t=Object.getPrototypeOf(t)}while(t);return e}function d(t,e){const{D:o}=n(11);return r(()=>{if(t===e)return!0;if(o(t.origin).error)return!1;if(o(e.origin).error)return!1;if(t.origin!==e.origin)return!1;if(t.location!==e.location)throw new Error("Inconsistent worldview");return!0})}const g=(t,e)=>t.some(t=>d(t,e));t.exports={C:["toString","upgrade","sync","auth","destroy","mustBeRecent","pluck","encryption","blockhash","blocktime","blockheight","upgradable"],U:["load"],g:function(){const t=n(31);if(!t.Wt)throw new Error("Run instance not active");return t.Wt},R:function(t){if(!t)throw new InternalError("assert failed")},_:function(t,e){if(!t)throw new ArgumentError(e)},P:function(t,e){if(!t)throw new StateError(e)},Ht:function(t){return t.startsWith("main")?"mainnet":"testnet"},O:function(t){if("function"!=typeof t)return;const e=n(4),Code=n(0),r=e.W.Object,o=e.Jt.Object,i=Object.getPrototypeOf(t);return i!==o.getPrototypeOf(o)&&i!==r.getPrototypeOf(r)&&i!==Code.prototype?i:void 0},zt:function(t){const e=t.match(/^\s*class\s+[a-zA-Z0-9_$]+\s+extends\s+([a-zA-Z0-9_$]+)\s*{/);return e&&e[1]},k:function(t,e){for(;t;)if((t=Object.getPrototypeOf(t))===e)return!0;return!1},h:function(t){return r(()=>{switch(typeof t){case"string":return`"${t.length>20?t.slice(0,20)+"â€¦":t}"`;case"object":{if(!t)return"null";if(!t.constructor.name)return"[anonymous object]";const Jig=n(2),Berry=n(2);return`[${t instanceof Jig?"jig":t instanceof Berry?"berry":"object"} ${t.constructor.name}]`}case"function":{const e="function"==typeof t.toString&&!t.toString.toString().startsWith("class")?t.toString():Function.prototype.toString.apply(t);if(/^\(/.test(e)||/^function\s*\(/.test(e)||/^[a-zA-Z0-9_$]+\s*=>/.test(e))return"[anonymous function]";return/^class\s*{/.test(e)?"[anonymous class]":t.name}case"undefined":return"undefined";default:return t.toString()}})},Vt:function(t,e){const n=Object.getPrototypeOf(e);if(n.prototype){const r=/^class\s+[a-zA-Z0-9_$]+\s+extends\s+[a-zA-Z0-9_.$]+\s*{/;return t.replace(r,`class ${e.name} extends ${n.name} {`)}const r=t.match(/^([a-zA-Z0-9_$]+)\s*\(/);return r&&"function"!==r[1]?"function "+t:t},Kt:function(t){const e=t.match(/^(function\s+)([a-zA-Z0-9$_]+)(\s*)\((.*)/ms);if(e)return`${e[1]}${e[3]}(${e[4]}`;const n=t.match(/^(class\s+)([a-zA-Z0-9$_]+)(\s*){(.*)/ms);if(n)return`${n[1]}${n[3]}{${n[4]}`;const r=t.match(/^(class\s+)([a-zA-Z0-9$_]+)(\s*)extends(.*)/ms);if(r)return`${r[1]}${r[3]}extends${r[4]}`;throw new Error("Bad source code: "+t)},$:function(t,e){if(n(4).excludes.includes(e))return t;const r=t.match(/^(function\s)(.*)/ms);if(r)return`${r[1]}${e}${r[2]}`;const o=t.match(/^(class\s)(.*)/ms);if(o)return`${o[1]}${e}${o[2]}`;throw new Error("Bad source code: "+t)},A:i,qt:s,Yt:c,Zt:a,Qt:u,Xt:h,v:function(t){return void 0===t},te:function(t){return"boolean"==typeof t},ee:function(t){const e=t=>void 0===t||("boolean"==typeof t||("number"==typeof t||("string"==typeof t||(null===t||!function(t){const e=n(4);return!!e.ne.has(t)||!!e.re.has(t)}(t)&&(!!i(t)||(!!s(t)||(!!c(t)||(!!a(t)||(!!u(t)||(!!h(t)||t instanceof o)))))))))),{F:r}=n(10);let f=!0;try{r(t,t=>{f=f&&e(t)})}catch(t){}return f},S:function(t){if("function"!=typeof t)return!1;if(!t.name)return!0;const e=t.toString();return!e.startsWith("class")&&!e.startsWith("function")||(f.test(e)||l.test(e)||p.test(e))},oe:y,ie:function(t,e){if(!t||"function"!=typeof t&&"object"!=typeof t)return!1;const n=Object.getOwnPropertyDescriptor(t,e);return n&&n.value},I:function(t,e){return!(!t||"function"!=typeof t&&"object"!=typeof t)&&Object.getOwnPropertyNames(t).includes(e)},j:function(t,e,n){let r=Object.getOwnPropertyDescriptor(t,e);r||(r={configurable:!0,enumerable:!0,writable:!0}),r.value=n,Object.defineProperty(t,e,r)},se:function(t,e,n){Object.defineProperty(t,e,{get:n,configurable:!0,enumerable:!0})},ce:function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t)).filter(e=>Object.getOwnPropertyDescriptor(t,e).get)},ae:function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t)).filter(t=>"constructor"!==t).filter(e=>"function"==typeof Object.getOwnPropertyDescriptor(t,e).value)},ue:d,he:g,fe:function(t,e){return t.concat(e.filter(e=>!g(t,e)))},le:function(t,e){return t.filter(t=>!g(e,t))}}},function(t,e,n){class JigDeps{static get pe(){return n(13)}static get ye(){return n(11)}static get de(){return n(0)}static get ge(){return n(10)}static get we(){return n(3)}static get be(){return n(22)}static get _e(){return n(1)}static get me(){return n(2)}static get Pe(){return n(8)}static get Oe(){return n(18)}static get Ee(){return n(4)}static get B(){return n(5).B}static get Se(){return n(33)}static get ve(){return n(6)}static get Ae(){return"Jig"}}class Jig{constructor(...t){const e=JigDeps.pe,n=JigDeps.ye,Code=JigDeps.de,r=JigDeps.ge.N,o=JigDeps.ve.Ie,i=JigDeps.be,s=JigDeps.me,c=JigDeps.Pe,a=JigDeps.Oe,u=JigDeps.Ee.W,h=JigDeps.B,f=c.nt;if(!(this.constructor instanceof Code))return f.rt(()=>{const e=new Code(this.constructor);return Code.Ut(e).Rt(),new e(...t)});const l=[];let p=this.constructor;for(;p!==s;)l.push(p),p=Object.getPrototypeOf(p);if(0===l.length)throw new Error("Jig must be extended");const y=/\s+constructor\s*\(/;if(l.some(t=>y.test(t.toString())))throw new Error("Jig must use init() instead of constructor()");n.V(this);const d=f.et,g=d.length&&d[d.length-1].xe;g&&(this.owner=h(()=>r(g.owner,u)));const w=new i(this,a.je());return o.add(w),e.Te(this.constructor,w,t),w}init(){}sync(t={}){const e=JigDeps.we,n=JigDeps.Ae,r=JigDeps.Se,o=JigDeps._e.h,i=JigDeps.me,s=JigDeps.Pe.nt;if(e.tt(n,"Sync",o(this)),!(this instanceof i))throw new Error("sync unavailable");if(s.et.length)throw new Error("sync cannot be called internally");return r(this,t).then(()=>this)}destroy(){const t=JigDeps.we,e=JigDeps.Ae,n=JigDeps._e.h,r=JigDeps.me,o=JigDeps.pe;if(t.tt(e,"Destroy",n(this)),!(this instanceof r))throw new Error("destroy unavailable");return o.ct(this),this}auth(){const t=JigDeps.we,e=JigDeps.Ae,n=JigDeps._e.h,r=JigDeps.me,o=JigDeps.pe,i=JigDeps.ye,s=JigDeps.B;if(t.tt(e,"Auth",n(this)),!(this instanceof r))throw new Error("auth unavailable");if(s(()=>this.origin===i.Ct))throw new Error("Cannot auth undeployed");return o.st(this),this}toString(){return`[jig ${this.constructor.name}]`}static[Symbol.hasInstance](t){if(!JigDeps.ve.Ie.has(t))return!1;if(this===JigDeps.me)return!0;const e=JigDeps.de.Bt(this);return!!e&&JigDeps.B(()=>{let n=Object.getPrototypeOf(t);for(;n;){if(n.constructor.origin===e.origin)return!0;n=Object.getPrototypeOf(n)}return!1})}}Jig.deps={JigDeps},Jig.sealed=!1,Jig.toString();const r=new JigDeps.de;JigDeps.de.Ut(r).xt(Jig,!1),t.exports=r},function(t,e){const n={};function r(t,e,...r){n.Re&&n.Re[t]&&"function"==typeof n.Re[t]&&n.Re[t]((new Date).toISOString(),t.toUpperCase(),`[${e}]`,...r)}n.ke={warn:console.warn,error:console.error},n.Re=n.ke,n.kt=(...t)=>r("info",...t),n.$e=(...t)=>r("warn",...t),n.Ce=(...t)=>r("error",...t),n.tt=(...t)=>r("debug",...t),t.exports=n},function(module,exports,__webpack_require__){const DeterministicRealm=__webpack_require__(37),{Vt:_sandboxSourceCode,Kt:_anonymizeSourceCode}=__webpack_require__(1),Log=__webpack_require__(3),TAG="Sandbox";class Sandbox{constructor(){Log.tt(TAG,"Creating deterministic realm"),this.excludes=[],this.Ue=new DeterministicRealm;const compartment=this.Ue.makeCompartment();this.W=compartment.evaluate(_getIntrinsicsSrc),this.Jt=eval(_getIntrinsicsSrc),this.re=new Set(Object.entries(this.W).map(([t,e])=>e)),this.ne=new Set(Object.entries(this.Jt).map(([t,e])=>e))}jt(t,e,n=!1,r=!1){if(process.env.COVER&&n||this.excludes.includes(t.name)){return[t,"undefined"!=typeof global?global:window]}const o=_sandboxSourceCode(t.toString(),t),i=r?_anonymizeSourceCode(o):o;return this.Ne(i,e)}Ne(t,e={}){const n=this.Ue.makeCompartment();Object.assign(n.global,this.W,e);const r=t.startsWith("class")?"AnonymousClass":"anonymousFunction",o=`const ${r}=${t};${r}`;"Math"in e||Object.defineProperty(n.global,"Math",{get:()=>{throw new ReferenceError("Math is not defined\n\nHint: Math is disabled because it is non-deterministic.")}}),"Date"in e||Object.defineProperty(n.global,"Date",{get:()=>{throw new ReferenceError("Date is not defined\n\nHint: Date is disabled because it is non-deterministic.")}});return[n.evaluate(o),n.global]}}const _intrinsicNames=["console","eval","isFinite","isNaN","parseFloat","parseInt","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","Object","Function","Boolean","Symbol","Error","EvalError","RangeError","ReferenceError","SyntaxError","TypeError","URIError","Number","BigInt","Math","Date","String","RegExp","Array","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array","Map","Set","WeakMap","WeakSet","ArrayBuffer","DataView","JSON","Promise","Generator","GeneratorFunction","AsyncFunction","Reflect","Proxy","Intl","WebAssembly"];let _getIntrinsicsSrc="const x = {}\n";_intrinsicNames.forEach(t=>{_getIntrinsicsSrc+=`x.${t} = typeof ${t} !== 'undefined' ? ${t} : undefined\n`}),_getIntrinsicsSrc+="x",module.exports=new Sandbox},function(t,e){let n=!1;t.exports={B:function(t){const e=n;try{return n=!0,t()}finally{n=e}},Fe:function(){return n}}},function(t,e){const n=new WeakSet,r=new WeakSet,o=new WeakSet;class i{static[Symbol.hasInstance](t){return!!n.has(t)||(!!r.has(t)||!!o.has(t))}}i.Ie=n,i.K=r,i.Be=o,t.exports=i},function(t,e){t.exports=require("bsv")},function(t,e,n){const r=n(7),{crypto:o}=r,Unbound=n(9),{R:i,h:s,P:c,he:a}=n(1),{D:u,Ct:h}=n(11),{B:f}=n(5),l=n(23),{pe:p}=n(13),y=n(3),d="Record";class g{constructor(){this.Me="record://"+o.Random.getRandomBuffer(32).toString("hex"),this.De=0,this.Le=[],this.et=[],this.Ce=null,this.Ge=[],this.Je=[],this.We=[],this.He=[],this.ze=[],this.Ve=[],this.Ke=[],this.qe=[],this.Ye=new Map,this.Ze=!0}Qe(){y.tt(d,"Begin"),this.De++}Xe(){i(this.De),y.tt(d,"End"),this.De--,!this.De&&this.Ze&&this.tn()}en(t){i(t instanceof p),y.tt(d,"Push "+t),this.et.push(t)}nn(){i(this.et.length);const t=this.et.pop();y.tt(d,"Pop "+t),this.et.length||this.rn(t)}rn(t){i(t instanceof p),i(!this.et.length),y.tt(d,"Add "+t),this.Le.push(t),f(()=>{for(const[t,e]of this.Ye)a(this.Ve,t)||e.sn.owner!==t.owner&&e.sn.satoshis!==t.satoshis&&t.owner instanceof Unbound&&t.satoshis instanceof Unbound&&(t.owner.cn||t.satoshis.cn)&&this.an(t)}),this.He.filter(t=>!a(this.Ve,t)).forEach(t=>this.an(t)),this.Ge.forEach(t=>this.un(t)),this.ze.forEach(t=>this.un(t)),this.We.forEach(t=>this.un(t)),this.He.forEach(t=>this.un(t)),!this.De&&this.Ze&&this.tn()}an(t){a(this.Ve,t)||(y.tt(d,"Disable "+s(t)),this.Ve.push(t))}un(t){this.qe.includes(t)||(this.qe.push(t),f(()=>{t.location=`${this.Me}_j${this.qe.length-1}`,t.origin===h&&(t.origin=t.location)}))}tn(){const t=n(24);if(y.tt(d,"Commit"),this.Me===g.nt.Me&&(i(!g.nt.De),g.nt=new g),!this.Le.length)return y.$e(d,"No actions found"),i(!this.Ge.length),i(!this.We.length),i(!this.He.length),void i(!this.ze.length);if(!this.Le.length||this.Ge.length||this.We.length||this.He.length||this.ze.length)try{return new t(this)}catch(t){throw this.it(),t}}hn(t){if(a(this.Ge,t))return void this.fn();y.tt(d,"Create",s(t));const Code=n(0),Jig=n(2);i(t instanceof Code||t instanceof Jig);const e=f(()=>u(t.origin).nativeid);i(!e),i(!a(this.We,t)),i(!a(this.He,t)),i(!a(this.ze,t)),i(!a(this.Ve,t)),this.Ge.push(t),this.ln(t),this.pn(t),this.fn()}_read(t){if(a(this.Je,t))return;y.tt(d,"Read",s(t));const e=n(6);i(t instanceof e),this.Je.push(t),this.ln(t),this.pn(t)}yn(t,e){if(a(this.We,t))return void this.fn();y.tt(d,"Update",s(t));const Code=n(0),Jig=n(2);i(t instanceof Code||t instanceof Jig);const r=f(()=>t.origin===h);i(!r||a(this.Ge,t));const o=f(()=>u(t.origin).nativeid);i(!o),this.dn(t),this.We.push(t),this.ln(t),this.pn(t,e),this.fn()}gn(t){if(a(this.He,t))return void this.fn();y.tt(d,"Delete",s(t));const Code=n(0),Jig=n(2);i(t instanceof Code||t instanceof Jig);const e=f(()=>u(t.origin).nativeid);i(!e),this.dn(t),this.He.push(t),this.ln(t),this.pn(t),this.fn(),f(()=>{t.owner=null,t.satoshis=0})}st(t,e=!0){if(a(this.ze,t))return void(e&&this.fn());y.tt(d,"Auth",s(t));const Code=n(0),Jig=n(2);i(t instanceof Code||t instanceof Jig),i(!a(this.Ge,t)),this.dn(t),this.ze.push(t),this.ln(t),this.pn(t),this.fn()}fn(){this.et.map(t=>t.xe).filter(t=>!!t).filter(t=>!a(this.Ge,t)).forEach(t=>this.st(t,!1))}dn(t){const e="Jig: "+s(t),n=`New owners cannot sign for changes in this transaction\n\n${e}\n\nHint: Split your action into multiple transactions`,r="Destroyed jigs cannot be used again in this transaction\n\n"+e,o=a(this.He,t)?r:n;c(!a(this.Ve,t),o)}pn(t,e){if(this.Ye.has(t))return;const n=e||new l(t);this.Ye.set(t,n)}ln(t){const e=f(()=>t.location),{commitid:r,recordid:o}=u(e);if(!r&&!o)return;if(o&&o.startsWith(this.Me))return;const i=n(24).wn(r);if(!i)throw new Error("Cannot link "+s(t));this.Ke.includes(i)||this.Ke.push(i)}it(t){y.tt(d,"Rollback"),this.Ye.forEach(t=>t.it()),this.Me===g.nt.Me&&(g.nt=new g)}Nt(){const{bn:t}=n(13),e=this.et.filter(e=>e instanceof t);return e.length<2?null:e[e.length-2].xe}rt(t){try{this.Qe();const e=t();return this.Xe(),e}catch(t){throw this.it(),t}}}g.nt=new g,t.exports=g},function(t,e,n){const Code=n(0);class Unbound{constructor(t){this.cn=t}}Unbound.toString();const r=new Code;Code.Ut(r).xt(Unbound,!0),t.exports=r},function(t,e,n){const{qt:r,A:o,h:i,Yt:s,Zt:c,Qt:a,Xt:u,P:h,ue:f}=n(1),{B:l}=n(5),p=n(4),y=p.Jt,d=p.W,g=p.ne,w=p.re,b=y.Object,_=d.Object,m=n(6);t.exports={F:function t(e,n,r=new Set){return l(()=>{if("function"!=typeof e&&"object"!=typeof e||!e)return void n(e);if(r.has(e))return;if(r.add(e),!1===n(e))return;if(e instanceof y.Set||e instanceof d.Set)for(const o of e)t(o,n,r);if(e instanceof y.Map||e instanceof d.Map)for(const[o,i]of e)t(o,n,r),t(i,n,r);Object.keys(e).forEach(o=>{t(e[o],n,r)}),"object"!=typeof e||g.has(e.constructor)||w.has(e.constructor)||t(e.constructor,n,r);const o=Object.getPrototypeOf(e);"function"==typeof e&&o!==b.getPrototypeOf(b)&&o!==_.getPrototypeOf(_)&&t(o,n,r)})},_n:function t(e,r,o=new Map){if("function"!=typeof e&&"object"!=typeof e||!e)return e;if(o.has(e))return o.get(e);const i=r(e)||e;if(o.set(e,i),"function"!=typeof i&&"object"!=typeof i||!i)return i;const s=n(4),Code=n(0),c=s.Jt,a=s.W,u=s.ne,h=s.re,f=c.Object,l=a.Object;if(i instanceof c.Set||i instanceof a.Set){const e=Array.from(i);for(let n=0;n<e.length;n++)e[n]=t(e[n],r,o);i.clear(),e.forEach(t=>i.add(t))}if(i instanceof c.Map||i instanceof a.Map){const e=Array.from(i);for(let n=0;n<e.length;n++)e[n][0]=t(e[n][0],r,o),e[n][1]=t(e[n][1],r,o);i.clear(),e.forEach(t=>i.set(t[0],t[1]))}if(Object.keys(i).forEach(e=>{i[e]=t(i[e],r,o)}),"object"==typeof i&&!u.has(i.constructor)&&!h.has(i.constructor)){const e=t(i.constructor,r,o);Object.getPrototypeOf(i)!==e.prototype&&Object.setPrototypeOf(i,e.prototype)}const p=Object.getPrototypeOf(i);if("function"==typeof i&&p!==f.getPrototypeOf(f)&&p!==l.getPrototypeOf(l)){const e=t(p,r,o);if(p!==e){Object.setPrototypeOf(i,e);const t=i instanceof Code?Object.getPrototypeOf(i.prototype):i.prototype;Object.setPrototypeOf(t,e.prototype)}}return i},N:function t(e,f,l,p=new Map){if("symbol"==typeof e)throw new Error("Cannot clone: "+i(e));if("function"!=typeof e&&"object"!=typeof e||!e)return e;if(p.has(e))return p.get(e);if(l){const t=l(e);if(t)return p.set(e,t),t}const y=n(4),d=n(6),g=y.Jt,w=y.ne,b=y.re;if(f=f||g,e instanceof d)return e;if("function"==typeof e)throw new Error("Cannot clone non-code function: "+i(e));if(w.has(e)||b.has(e))throw new Error("Cannot clone intrinsic: "+i(e));let _=null;if(r(e)&&(_=new f.Array),o(e)&&(_=new f.Object),a(e))return new f.Uint8Array(f.Array.from(e));s(e)&&(_=new f.Set),c(e)&&(_=new f.Map);let m=!1;if(_||(m=!0,_=new f.Object),!_)throw new Error("Cannot clone: "+i(e));if(p.set(e,_),_ instanceof f.Set)for(const n of e){const e=t(n,f,l,p);_.add(e)}if(_ instanceof f.Map)for(const n of e){const e=t(n[0],f,l,p),r=t(n[1],f,l,p);_.set(e,r)}if(Object.keys(e).forEach(n=>{if("symbol"==typeof n)throw new Error("Cannot clone: "+i(n));_[n]=t(e[n],f,l,p)}),!w.has(e.constructor)&&!b.has(e.constructor)){const n=t(e.constructor,f,l,p);Object.setPrototypeOf(_,n.prototype)}return m&&h(u(_),"Cannot clone: "+i(e)),_},mn:function t(e,n){if(typeof e!=typeof n)return!1;if("number"==typeof e&&isNaN(e)&&isNaN(n))return!0;if(e instanceof m)return n instanceof m&&!!f(e,n);if("object"!=typeof e||!e||!n)return e===n;const i=Array.from(Object.keys(e)),u=Array.from(Object.keys(n));if(i.length!==u.length)return!1;if(i.some(r=>!t(e[r],n[r])))return!1;if(o(e))return!!o(n);if(r(e))return!!r(n);if(s(e))return!!s(n)&&(e.size===n.size&&!!t(Array.from(e.entries()),Array.from(n.entries())));if(c(e))return!!c(n)&&(e.size===n.size&&!!t(Array.from(e.entries()),Array.from(n.entries())));if(a(e))return!!a(n);throw new Error("Unsupported: "+e)}}},function(t,e,n){const{Address:r,PublicKey:o}=n(7),{h:i,j:s}=n(1),{B:c}=n(5),a=/^(?<protocol>error):\/\/(?<error>.*)/s,u=/^(?<protocol>native):\/\/(?<nativeid>[a-zA-Z0-9_$]+)/s,h=/^(?<protocol>commit):\/\/(?<commitid>[a-f0-9]+)_(?:o(?<vout>[0-9]+)|(?:d(?<vdel>[0-9]+)))$/,f=/^(?<protocol>record):\/\/(?<recordid>[a-f0-9]+)_j(?:(?<vjig>[0-9]+))$/,l=/^(?<txid>[a-f0-9]+)?_(?:(?:o(?<vout>[0-9]+))|(?:d(?<vdel>[0-9]+)))(?:_(?<berry>[a-z0-9_]*))?$/,p="error://Undeployed";t.exports={D:function(t,e){if("string"!=typeof t)throw new Error("Location is not a string: "+i(t));const n=t.match(l)||t.match(h)||t.match(f)||t.match(a)||t.match(u);if(n){const e={},r=n.groups;return"commit"===r.protocol&&(e.commitid="commit://"+r.commitid),"record"===r.protocol&&(e.recordid="record://"+r.recordid),"error"===r.protocol&&(e.error=r.error),"native"===r.protocol&&(e.nativeid="native://"+r.nativeid),void 0!==r.txid&&(e.txid=r.txid),void 0!==r.vout&&(e.vout=parseInt(r.vout)),void 0!==r.vdel&&(e.vdel=parseInt(r.vdel)),void 0!==r.vjig&&(e.vjig=parseInt(r.vjig)),void 0!==r.berry&&(e.berry=r.berry),t===p&&(e.undeployed=!0),e}throw new Error("Bad location: "+i(t))},L:function(t){if(Number.isInteger(t)&&t>=1)return t;throw new Error("Invalid nonce: "+i(t))},G:function(t,e=!1,s){const StandardLock=n(27);if("string"==typeof t){try{const e=new o(t,{network:s}),n=s?"testnet"===s:void 0;return new StandardLock(e.toAddress().toString(),n)}catch(t){}try{new r(t,s);return new StandardLock(t,s?"testnet"===s:void 0)}catch(t){}}const{Lock:c}=n(28);if(t instanceof c)return t;if(null===t&&e)return null;throw new Error("Invalid owner: "+i(t))},J:function(t){if("number"!=typeof t)throw new Error("satoshis must be a number");if(!Number.isInteger(t))throw new Error("satoshis must be an integer");if(t<0)throw new Error("satoshis must be non-negative");if(t>1e8)throw new Error("satoshis must be <= 100000000");return t},V:function(t){const Unbound=n(9);c(()=>{s(t,"origin",p),s(t,"location",p),s(t,"nonce",0),s(t,"owner",new Unbound(void 0)),s(t,"satoshis",new Unbound(void 0))})},M:["location","origin","nonce","owner","satoshis"],Ct:p}},function(t,e){class ArgumentError extends Error{constructor(t="Unknown reason"){super(t),this.name=this.constructor.name}}class InternalError extends Error{constructor(t){super(t),this.name=this.constructor.name}}class RequestError extends Error{constructor(t,e,n,r,o){super(`${e} ${n}\n\n${r} ${o}\n\n${t}`),this.reason=t,this.status=e,this.statusText=n,this.method=r,this.url=o,this.name=this.constructor.name}}class StateError extends Error{constructor(t="Unknown reason"){super(t),this.name=this.constructor.name}}class TimeoutError extends Error{constructor(t){super(t),this.name=this.constructor.name}}class UnimplementedError extends Error{constructor(t){super(t),this.name=this.constructor.name}}t.exports={ArgumentError,InternalError,RequestError,StateError,TimeoutError,UnimplementedError}},function(t,e,n){const{M:r,D:o}=n(11),{R:i,h:s,O:c,I:a,P:u}=n(1),{F:h,N:f,_n:l}=n(10),{StateError,UnimplementedError}=n(12),{B:p}=n(5),y=n(3),d=n(19),g=n(6),w=n(4).W,b="Action";class _{constructor(t){this.xe=t}toString(){return""+this.constructor.name}opcode(){throw new UnimplementedError}data(){throw new UnimplementedError}}class m extends _{constructor(){super(null),this.Pn=[],this.On=[]}toString(){return`Deploy (count: ${this.Pn.length})`}opcode(){return"DEPLOY"}data(){i(this.Pn.length===this.On.length);const t=[];for(let e=0;e<this.Pn.length;e++){const n=this.Pn[e],r=this.On[e];t.push(n),t.push(r)}return t}}class P extends _{constructor(t,e,n){super(t),this.En=e,this.sn=n}toString(){return"Upgrade "+s(this.xe)}opcode(){return"UPGRADE"}data(){const t=[];return t.push(this.xe),t.push(this.En),t.push(this.sn),t}}class O extends _{toString(){return"Destroy "+s(this.xe)}opcode(){return"DESTROY"}data(){return this.xe}}class E extends _{toString(){return"Auth "+s(this.xe)}opcode(){return"AUTH"}data(){return this.xe}}class S extends _{constructor(t,e,n){super(t),this.Sn=e,this.vn=n}toString(){return`Call ${s(this.xe)} ${this.Sn}`}opcode(){return"CALL"}data(){const t=[];return t.push(this.xe),t.push(this.Sn),t.push(this.vn),t}}class v extends _{constructor(t,e,n){super(e),this.xe=e,this.An=t,this.vn=n}toString(){return"New "+s(this.xe)}opcode(){return"NEW"}data(){const t=[];return t.push(this.An),t.push(this.vn),t}}function A(t){const Code=n(0),e=n(8).nt,r=c(t);if(!r)return;A(r);if(Code.Ut(r).X)return;const o=a(r,"sealed")?r.sealed:"owner";switch(o){case"owner":e.Ge.includes(r)||e.st(r);break;case!0:throw new StateError("Parent class sealed");case!1:break;default:throw new StateError("Bad sealed property: "+o)}}function I(t){const e=n(6),r=n(8).nt;h(t,t=>{if(t instanceof e)return r._read(t),!1})}function x(t,e){const Jig=n(2),Code=n(0);t instanceof Code&&Code.Ut(t).Rt();const r=f(e,w,t=>{if("function"==typeof t&&!(t instanceof g)){const e=new Code(t);return Code.Ut(e).Rt(),e}t instanceof Code&&Code.Ut(t).Rt()});return p(()=>{const e=new Map;e.set(t.location,t),t instanceof Jig&&e.set(t.constructor.location,t.constructor),l([t,r],t=>{if(t instanceof g){const n=e.get(t.location)||t;return e.set(t.location,n),n}})}),r}t.exports={pe:_,In:m,xn:P,jn:O,Tn:E,bn:S,Rn:v,Rt:function(t){const Code=n(0),e=n(8).nt;i(t.length),i(t.every(t=>t instanceof Code)),y.tt(b,"Deploy",t.map(t=>s(t)).join(", ")),e.rt(()=>{t.forEach(t=>e.hn(t)),t.forEach(t=>A(t));const n=new m;for(const e of t){const t=e.toString(),o=p(()=>Object.assign({},e));r.forEach(t=>delete o[t]),i(!o.presets),n.Pn.push(t),n.On.push(o),I(o)}e.rn(n)})},ot:function(t,e){const Code=n(0),c=n(8).nt;i(t instanceof Code),y.tt(b,"Upgrade",s(t)),u(!("vdel"in o(p(()=>t.location))),"Cannot upgrade destroyed jig"),c.rt(()=>{A(t);const n=t.toString(),o=p(()=>Object.assign({},t));r.forEach(t=>delete o[t]),i(!o.presets);const s=new P(t,n,o);c.yn(t,e),I(o),c.rn(s)})},ct:function(t){const e=n(8),Code=n(0),Jig=n(2),r=e.nt;i(t instanceof Code||t instanceof Jig),y.kt(b,"Destroy",s(t)),"vdel"in o(p(()=>t.location))||r.rt(()=>{if(r.gn(t),r.et.length)return;const e=new O(t);r.rn(e)})},st:function(t){const e=n(8).nt,Code=n(0),Jig=n(2);i(t instanceof Code||t instanceof Jig),y.kt(b,"Auth",s(t)),u(!("vdel"in o(p(()=>t.location))),"Cannot auth destroyed jig"),e.rt(()=>{if(e.st(t),e.et.length)return;const n=new E(t);e.rn(n)})},kn:function(t,e,r,o){const i=n(8).nt;y.kt(b,"Call",s(t),e),i.rt(()=>{I(r);const n=new S(t,e,r);i.en(n),o(),i.nn()})},Te:function(t,e,r){const Jig=n(2),o=n(8).nt;y.kt(b,"New",s(t)),o.rt(()=>{let n=t;for(;n!==Jig;)o._read(n),n=Object.getPrototypeOf(n);const i=x(e,r),s=new v(t,e,i);o.hn(e),o.en(s);const c=e.init(...i);u(void 0===c,"init must not return a value"),o.nn(),d.At(e).vt.$n.push("init")})},Cn:x}},function(t,e,n){const r=n(7),{Transaction:o}=r,i=n(3),{R:s,k:c,h:a,P:u,_:h}=n(1),{D:f}=n(11),{B:l}=n(5),{ArgumentError}=n(12),Code=n(0);class p{constructor(t,e){s(t),this.Un=new Map,this.Nn=[],this.Fn=!0,this.g=t;const{Bn:r}=n(16);this.Mn=e||new r("load")}async Dn(t,e){const n=this.Fn;if(this.Fn=!1,!e){const e=this.Un.get(t);if(e)return e}const r=this.Ln(t,e);e||this.Un.set(t,r);const o=await r;if(n){for(;this.Nn.length;){const t=this.Nn;this.Nn=[],await Promise.all(t)}this.Fn=!0}return o}async Ln(t,e){if(i.kt("Loader","Load",t),e)return this.Gn(t,e);const n=f(t),r="Bad location: "+t;return h(!n.error,r),h(!n.commitid,r),h(!n.recordid,r),n.nativeid?this.Jn(t):(h(n.txid,r),n.berry?this.Wn(t):this.Hn(t))}async Wn(t){const{zn:e}=n(21),r="berry://"+t,o=await e(r,void 0,this);if(o)return this.Nn.push(o.completer),o.cn;const i=t.slice(0,t.lastIndexOf("_")),s=new p(this.g,this.Mn),c=await s.load(i),a=f(t).berry;return this.Vn(a,c)}async Hn(t){const{txid:e,vout:r,vdel:i}=f(t),s=await this.g.pt.fetch(e),c=new o(s),a=y(c),u="number"==typeof r&&r>=1&&r<=a.out.length,l="number"==typeof i&&i>=0&&i<a.del.length;h(u||l,"Jig does not exist: "+t);const p=u?a.out[r-1]:a.del[i],d="jig://"+t,{zn:g}=n(21),w=await g(d,p,this);return w?(this.Nn.push(w.Kn),w.cn):this.qn(c,a,t)}async qn(t,e,r){const{vout:o,vdel:i}=f(r),s=e.exec.some(t=>"DEPLOY"===t.op),c=e.exec.some(t=>"UPGRADE"===t.op),a=this.g.Yn;if((s||c)&&a&&!a.includes(t.hash))throw new Error("Transaction not whitelisted for code: "+t.hash);const u=n(16),h=await u(t,e,this.g,!0,null,this.Mn);if("number"==typeof o&&o>=1&&o<=h.Zn.length)return h.Zn[o-1];if("number"==typeof i&&i>=0&&i<=h.He.length-1)return h.He[i];throw new ArgumentError("Jig not found: "+r)}async Gn(t,e){const Berry=n(25),{zn:r}=n(21);h(c(e,Berry),"Berry class must extend from Berry");const o=new Code(e),i=l(()=>o.location),s=f(i),a=!s.commitid&&!s.recordid&&!s.error&&s.txid?`${i}_${t}`:void 0;if(a){const t=this.Un.get(a);if(t)return t}const u=(async()=>{const n="berry://"+a,o=await r(n,void 0,this);if(o)return o;const i=t;return this.Vn(i,e)})();return a&&this.Un.set(a,u),u}async Vn(t,e){return e.pluck(t)}Jn(t){const{nativeid:e}=f(t),n=Code.Mt(e);h(n,"Native code not found: "+e);const r=Code.Ut(n);return h(!r.yt,a(n)+" cannot be a dependency"),n}}function y(t){const{Qn:e}=n(15),r="Not a run transaction: Bad payload structure",o="Not a run transaction: Bad payload JSON";u(t.outputs.length,r);const i=t.outputs[0].script.chunks;u(i.length>=6,r),u(0===i[0].opcodenum,r),u(106===i[1].opcodenum,r),u("run"===i[2].buf.toString(),r);const s=Buffer.from(e).toString("hex");u(i[3].buf.toString("hex")===s,"Unsupported run protocol");try{const t=i[5].buf.toString("utf8"),e=JSON.parse(t);return u("number"==typeof e.in,o),u(Array.isArray(e.ref),o),u(Array.isArray(e.out),o),u(Array.isArray(e.del),o),u(Array.isArray(e.cre),o),u(Array.isArray(e.exec),o),u(!e.ref.some(t=>"string"!=typeof t),o),u(!e.out.some(t=>"string"!=typeof t),o),u(!e.del.some(t=>"string"!=typeof t),o),u(!e.exec.some(t=>"object"!=typeof t),o),e}catch(t){u(!1,o)}}p.Xn=y,t.exports=p},function(t,e,n){const r=n(7),o=n(14),{R:i,Ht:s,fe:c,P:a}=n(1),{F:u}=n(10),{StateError}=n(12),h=n(3),f=n(20),{D:l,G:p}=n(11),{B:y}=n(5),d=n(32),{Transaction:g,Script:w}=r,b="Publish",_=[3],m=new d;async function P(t){try{h.tt(b,"Publish",t.Me),i(!t.tr.length),i(!t.er),await O(t),E(t);const e=S(t),r=await v(t),s=A(r),c=I(t,e),a=x(t,s,c,e),u=j(t,a),f=(await m.nr(async()=>{const e=await R(u,t),r=await C(e,t);return function(t,e){e.rr.forEach((n,r)=>{if(t.inputs[r].isFullySigned())return;const o=e.or.get(n),i=`${"origin: "+o.sn.origin}\n${"location: "+o.sn.location}\n${"owner: "+o.sn.owner}`,s=t.inputs[r].script.toBuffer().length?"Bad signature":"Missing signature";throw new StateError(`${s} for ${n.constructor.name}\n\n${i}`)})}(r,t),await async function(t,e){if("function"==typeof t.g.ir.broadcast)try{await t.g.ir.broadcast(e.toString("hex"))}catch(t){h.Ce(b,t.toString())}try{await t.g.pt.broadcast(e.toString("hex"))}catch(r){throw await async function(t,e,r){const i=t.toString();let s="Broadcast failed: "+t.message;if(-1!==i.indexOf("tx has no inputs")||-1!==i.indexOf("insufficient priority")){s=`${s}\n\n${"Hint: Is the purse funded to pay for this transaction?"}`}if(-1!==i.indexOf("Missing inputs")||-1!==i.indexOf("txn-mempool-conflict"))for(const i of r.inputs)try{const r=i.prevTxId.toString("hex"),c=i.outputIndex,a=`${r}_o${c}`,u=await e.g.pt.spends(r,c);if(!u)continue;let h="Payment";try{const t=new o(e.g,e.Mn),r=await t.Dn(a);h=r instanceof n(0)?r.name:r.toString()}catch(t){}s=`${s}\n\n${h} was spent in another transaction\n`,s=`${s}\nLocation: ${a}`,s=`${s}\nSpending Tx: ${u}`}catch(t){}return new Error(s)}(r,t,e)}}(t,r),r})).hash;T(t,f),await U(t,r,f),N(t),t.sr()}catch(e){t.cr(e),N(t)}}async function O(t){h.tt(b,"Assign owners");const Unbound=n(9),e=n(6);if(t.Ge.map(e=>t.ar.get(e).sn.owner).some(t=>t instanceof Unbound&&!t.cn)){for(let e=0;e<t.Ge.length;e++){const n=t.Ge[e],r=t.ar.get(n),o=r.sn.owner;if(!(o instanceof Unbound)||o.cn)continue;const i=await t.g.G.owner(),s=Array.isArray(i)?i[0]:i;r.sn.owner=new Unbound(s)}const n=t.Ge.map(e=>t.ar.get(e).sn.owner);u(n,t=>{if(t instanceof e){const e=y(()=>t.location),{txid:n,nativeid:r}=l(e);a(n||r,"Lock must be deployed")}})}}function E(t){const Unbound=n(9);t.Zn.forEach(e=>{const n=t.ar.get(e).sn;n.owner instanceof Unbound&&(n.owner=n.owner.cn),n.satoshis instanceof Unbound&&(n.satoshis=n.satoshis.cn||0),t.ur(e)||y(()=>{e.owner instanceof Unbound&&(e.owner=n.owner),e.satoshis instanceof Unbound&&(e.satoshis=n.satoshis||0)})}),t.He.forEach(e=>{y(()=>{const n=t.ar.get(e).sn;n.owner instanceof Unbound&&(n.owner=n.owner.cn),n.satoshis instanceof Unbound&&(n.satoshis=n.satoshis.cn||0),e.owner instanceof Unbound&&(e.owner=e.owner.cn),e.satoshis instanceof Unbound&&(e.satoshis=e.satoshis.cn||0),i(null===e.owner),i(0===e.satoshis)})})}function S(t){let e=c(t.rr,t.hr);return e=c(e,t.Ge),e}async function v(t){const{rt:e}=n(21),r=new Map,o=t.Zn.concat(t.He);for(const n of o){const o=await e(n,t);r.set(n,o)}return r}function A(t){const{_hash:e}=n(21),r=new Map;for(const[n,o]of t){if(r.has(n))continue;const t=e(o);r.set(n,t)}return r}function I(t,e){const n=(new f).lr(t=>{const n=e.indexOf(t);return i(n>=0),n});return t.Le.map(t=>({op:t.opcode(),data:n.pr(t.data())}))}function x(t,e,n,r){const o=t.Zn.map(t=>e.get(t)),s=t.He.map(t=>e.get(t)),c=(new f).lr(t=>{const e=r.indexOf(t);return i(e>=0),e}),a=t.Ge.map(e=>t.ar.get(e).sn.owner),u=c.pr(a),l=t.hr.map(e=>t.or.get(e).sn.location),p={in:t.rr.length,ref:l,out:o,del:s,cre:u,exec:n};return h.tt(b,"Payload",JSON.stringify(p,0,2)),p}function j(t,e){h.tt(b,"Create partial tx");const n=new g,o=r.deps.Buffer,i=o.from("run","utf8"),c=o.from(_,"hex"),a=o.from(t.g.yr,"utf8"),u=o.from(JSON.stringify(e),"utf8"),f=w.buildSafeDataOut([i,c,a,u]),y=new g.Output({script:f,satoshis:0});n.addOutput(y);const d=s(t.g.pt.network);for(const e of t.rr){const r=t.or.get(e),i=r.sn.location,{txid:s,vout:c}=l(i),a=r.sn.satoshis,u=r.sn.owner,h=p(u,false,d),f=o.from(h.script()),y={txid:s,vout:c,script:w.fromBuffer(f),satoshis:a};n.from(y)}for(const e of t.Zn){const r=t.ar.get(e),i=Math.max(g.DUST_AMOUNT,r.sn.satoshis),s=r.sn.owner,c=p(s,false,d),a=o.from(c.script()),u=w.fromBuffer(a);n.addOutput(new g.Output({script:u,satoshis:i}))}return n}function T(t,e){t.Zn.forEach((n,r)=>{const o=r+1,i=t.ar.get(n),s=`${e}_o${o}`;i.sn.origin.startsWith("commit://")&&(i.sn.origin=s),i.sn.location=s,y(()=>{n.origin.startsWith("commit://")&&(n.origin=s),t.ur(n)||(n.location=s)})}),t.He.forEach((n,r)=>{const o=t.ar.get(n),i=`${e}_d${r}`;o.sn.origin.startsWith("commit://")&&(o.sn.origin=i),o.sn.location=i,y(()=>{n.origin.startsWith("commit://")&&(n.origin=i),n.location=i})})}async function R(t,e){const n=r.deps.Buffer,o=k(e),i=$(e),s=o.map(t=>n.alloc(t.domain())),c=[...Array(o.length).keys()].filter(e=>!t.inputs[e].script.toBuffer().length);c.forEach(e=>t.inputs[e].setScript(s[e]));const a=t.toString("hex"),u=await e.g.ir.pay(a,i),h=new g(u);return c.forEach(e=>t.inputs[e].setScript("")),h}function k(t){return t.rr.map(e=>t.or.get(e)).map(t=>t.sn.owner).map(t=>p(t))}function $(t){const e=r.deps.Buffer,n=t.rr.map(e=>t.or.get(e)).map(t=>t.sn.owner).map(t=>p(t)).map(t=>e.from(t.script())).map(t=>w.fromBuffer(t)),o=t.rr.map(e=>t.or.get(e)).map(t=>Math.max(t.sn.satoshis,g.DUST_AMOUNT));return n.map((t,e)=>({script:t,satoshis:o[e]}))}async function C(t,e){const n=k(e),r=$(e),o=t.toString("hex"),i=await e.g.G.sign(o,r,n);return new g(i)}async function U(t,e,n){for(let r=0;r<t.Zn.length;r++){const o=t.Zn[r],i=e.get(o),s=`jig://${n}_o${r+1}`;await t.g.dr.set(s,i)}for(let r=0;r<t.He.length;r++){const o=t.He[r],i=e.get(o),s=`jig://${n}_d${r}`;await t.g.dr.set(s,i)}}function N(t){t.Zn.filter(e=>!t.ur(e)).forEach(e=>t.g.gr("jig",e)),t.He.filter(e=>!t.ur(e)).forEach(e=>t.g.gr("jig",e))}P.Qn=_,P.wr=O,P.br=E,P._r=S,P.mr=v,P.Pr=A,P.Or=I,P.Er=x,P.Sr=j,P.vr=m,P.Ar=R,P.Ir=C,P.xr=T,P.jr=U,t.exports=P},function(t,e,n){const{g:r,P:o,he:i,fe:s}=n(1),c=n(3),{_n:a}=n(10),{B:u}=n(5),h=n(14),f=n(8),l=n(39),p=n(6);class y{constructor(t,e=r()){this.Tr=e.Mn,this.Rr=t}kr(){o(this.Tr--,"Import limit reached during "+this.Rr)}}async function d(t,e,r,d,g,w){const b=n(40);c.kt("Import","Import",t.hash),(w=w||new y("import",r)).kr();const _=g?u(()=>g.location):null;let m=[],P=[],O=!g;for(let n=0;n<e.in;n++){const e=t.inputs[n],o=`${e.prevTxId.toString("hex")}_o${e.outputIndex}`,i=new h(r,w),s=_===o?g:i.Dn(o);_===o&&(O=!0),m.push(s)}o(O,"Jig not spent in the transaction");for(let t=0;t<e.ref.length;t++){const n=e.ref[t],o=new h(r,w).Dn(n);P.push(o)}m=await Promise.all(m),P=await Promise.all(P),o(!m.some(t=>i(P,t)),"Illegal reference");const E=m.concat(P);E.forEach(t=>function(t,e,r){const Jig=n(2),Code=n(0);if(t instanceof Code&&Code.Ut(t).X)return;u(()=>a(t,n=>{if(n===t)return;if(n===r)return;if(!(n instanceof Jig||n instanceof Code))return;const i=e.find(t=>t.origin===n.origin);return i?(t!==r&&o(i.nonce>=n.nonce,"Illegal reference due to time travel"),i):void 0}))}(t,E,g)),function(t,e){const n=new Map;t&&n.set(t.location,t);u(()=>a(e,t=>{if(!(t instanceof p))return;const e=n.get(t.location)||t;return n.set(t.location,e),e}))}(g,E);const S=new f;S.Ze=!1;const v=f.nt;try{m.forEach(t=>S.yn(t)),P.forEach(t=>S._read(t)),f.nt=S;for(const t of e.exec){const{op:e,data:n}=t;o(2===Object.keys(t).length,"Invalid exec"),o("string"==typeof e,"Invalid op: "+e),o("object"==typeof n&&n,"Invalid data: "+n);b(e,n,s(E,S.Ge))}}catch(t){throw S.it(),t}finally{f.nt=v}let A=null;try{return A=S.tn(),o(A,"Invalid payload: no commit generated"),await l(A,t,e,d),A}finally{A&&A.Dt()}}d.Bn=y,t.exports=d},function(t,e,n){const r=n(7),{Script:o,Transaction:i}=r,{Interpreter:s}=o,{Input:c}=i,{ECDSA:a,Hash:u,Signature:h}=r.crypto,{BufferReader:f,BufferWriter:l}=r.encoding,{BN:p}=r.deps.bnjs;t.exports={$r:function(t){if(t.Cr)return;t.Cr=!0,i.FEE_PER_KB=500;const e=i.prototype.sign;i.prototype.sign=function(...t){const n=c.prototype.isValidSignature;c.prototype.isValidSignature=()=>!0;const r=e.call(this,...t);return c.prototype.isValidSignature=n,r},c.prototype.clearSignatures=()=>{},c.prototype.getSignatures=()=>[],c.prototype.isFullySigned=function(){return!!this.script.toBuffer().length},i.prototype.isFullySigned=function(){return!this.inputs.some(t=>!t.isFullySigned())},i.prototype.isValidSignature=function(t){const e=new s,n=t.inputIndex,r=this.inputs[n],o=s.SCRIPT_VERIFY_STRICTENC|s.SCRIPT_VERIFY_DERSIG|s.SCRIPT_VERIFY_LOW_S|s.SCRIPT_VERIFY_NULLDUMMY|s.SCRIPT_VERIFY_SIGPUSHONLY|s.SCRIPT_ENABLE_MONOLITH_OPCODES|s.SCRIPT_ENABLE_MAGNETIC_OPCODES|s.SCRIPT_ENABLE_SIGHASH_FORKID;return e.verify(r.script,r.output.script,this,n,o,r.output.satoshisBN)}},Ur:function(t){const{Hash:e}=r.crypto;return t._hash=t._hash||e.sha256(t.toBuffer()).reverse().toString("hex"),t._hash},Nr:function(t,e,n,r,o,i=h.SIGHASH_ALL){i|=h.SIGHASH_FORKID;const c=new p(r),y=(s.SCRIPT_ENABLE_SIGHASH_FORKID,function(t,e,n,r,o){const i=t.inputs[n];function s(e){const n=new l;if(void 0===e){if(t._hashOutputsAll)return t._hashOutputsAll;t.outputs.forEach(t=>{t.toBufferWriter(n)})}else t.outputs[e].toBufferWriter(n);const r=n.toBuffer(),o=u.sha256sha256(r);return void 0===e&&(t._hashOutputsAll=o),o}let c=Buffer.alloc(32),a=Buffer.alloc(32),p=Buffer.alloc(32);e&h.SIGHASH_ANYONECANPAY||(c=function(){if(t._hashPrevouts)return t._hashPrevouts;const e=new l;t.inputs.forEach(t=>{e.writeReverse(t.prevTxId),e.writeUInt32LE(t.outputIndex)});const n=e.toBuffer();return t._hashPrevouts=u.sha256sha256(n),t._hashPrevouts}()),e&h.SIGHASH_ANYONECANPAY||(31&e)===h.SIGHASH_SINGLE||(31&e)===h.SIGHASH_NONE||(a=function(){if(t._hashSequence)return t._hashSequence;const e=new l;t.inputs.forEach(t=>{e.writeUInt32LE(t.sequenceNumber)});const n=e.toBuffer();return t._hashSequence=u.sha256sha256(n),t._hashSequence}()),(31&e)!==h.SIGHASH_SINGLE&&(31&e)!==h.SIGHASH_NONE?p=s():(31&e)===h.SIGHASH_SINGLE&&n<t.outputs.length&&(p=s(n));const y=new l;y.writeInt32LE(t.version),y.write(c),y.write(a),y.writeReverse(i.prevTxId),y.writeUInt32LE(i.outputIndex),y.writeVarintNum(r.toBuffer().length),y.write(r.toBuffer()),y.writeUInt64LEBN(o),y.writeUInt32LE(i.sequenceNumber),y.write(p),y.writeUInt32LE(t.nLockTime),y.writeUInt32LE(e>>>0);const d=y.toBuffer(),g=u.sha256sha256(d);return new f(g).readReverse()}(t,i,e,n,c)),d=a.sign(y,o,"little"),g=Buffer.from(d.toDER());return Buffer.concat([g,Buffer.from([255&i])]).toString("hex")}}},function(t,e,n){const{R:r}=n(1),o=n(19);class i{constructor(){this.Fr=!1,this.Fe=!1,this.Br=!1,this.Mr=!1,this.Dr=!1,this.Lr=!1,this.Gr=!1,this.Jr=!1,this.Wr=!1,this.Hr=!1,this.zr=!1,this.Vr=!1,this.Kr=!1,this.qr=!1,this.Yr=!1,this.$n=[]}static Et(){const t=new i;return t.Fr=null,t.Fe=!0,t.Br=!0,t.Mr=!0,t.Dr=!0,t.Lr=!0,t.Gr=!1,t.Jr=!0,t.Wr=!1,t.Hr=!0,t.zr=!0,t.Vr=!0,t.Kr=!1,t.qr=!1,t.Yr=!1,t.$n=[],t}static St(){const t=new i;return t.Fr=null,t.Fe=!0,t.Br=!0,t.Mr=!0,t.Dr=!0,t.Lr=!0,t.Gr=!1,t.Jr=!1,t.Wr=!0,t.Hr=!0,t.Zr=!1,t.Vr=!1,t.Kr=!0,t.qr=!1,t.Yr=!1,t.$n=[],t}static Tt(){const t=new i;return t.Fr=null,t.Fe=!0,t.Br=!0,t.Mr=!0,t.Dr=!1,t.Lr=!0,t.Gr=!1,t.Jr=!1,t.Wr=!0,t.Hr=!1,t.zr=!1,t.Vr=!0,t.Kr=!1,t.qr=!1,t.Yr=!1,t.$n=[],t}static je(){const t=new i;return t.Fr=null,t.Fe=!0,t.Br=!0,t.Mr=!0,t.Dr=!0,t.Lr=!1,t.Gr=!0,t.Jr=!0,t.Wr=!1,t.Hr=!0,t.zr=!0,t.Vr=!0,t.Kr=!1,t.qr=!1,t.Yr=!1,t.$n=[],t}static Qr(){const t=new i;return t.Fr=null,t.Fe=!0,t.Br=!0,t.Mr=!0,t.Dr=!0,t.Lr=!1,t.Gr=!1,t.Jr=!0,t.Wr=!0,t.Hr=!0,t.zr=!1,t.Vr=!0,t.Kr=!1,t.qr=!1,t.Yr=!1,t.$n=[],t}static qr(){const t=new i;return t.Fr=null,t.Fe=!0,t.Br=!0,t.Mr=!1,t.Dr=!1,t.Lr=!1,t.Gr=!1,t.Jr=!1,t.Wr=!1,t.Hr=!1,t.zr=!1,t.Vr=!1,t.Kr=!1,t.qr=!0,t.Yr=!1,t.$n=[],t}static It(t,e,n){const s=o.At(t);r(s);const c=s.vt,a=new i;return a.Fr=c.qr?null:t,a.Fe=c.Fe,a.Br=c.Br,a.Mr=!1,a.Dr=!1,a.Lr=!1,a.Gr=!1,a.Jr=c.Jr,a.Wr=c.Wr||e,a.Hr=c.Hr,a.zr=!1,a.Vr=c.Vr,a.Kr=c.Kr&&n,a.qr=c.qr,a.Yr=c.Yr,a.$n=[],a}}t.exports=i},function(t,e,n){const{Yt:r,Zt:o,Qt:i,ce:s,ae:c,R:a}=n(1),u=n(4),h=u.W,f=new WeakMap,l=new WeakMap,p=new WeakMap,y=new WeakMap,d=s(Set.prototype),g=s(Map.prototype),w=s(Uint8Array.prototype).concat(s(Object.getPrototypeOf(Uint8Array.prototype))),b=c(Set.prototype),_=c(Map.prototype),m=c(Uint8Array.prototype).concat(c(Object.getPrototypeOf(Uint8Array.prototype))),P=["add","clear","copyWithin","delete","fill","reverse","set","sort"],O=["entries","every","filter","find","findIndex","forEach","get","has","includes","indexOf","join","keys","lastIndexOf","map","reduce","reduceRight","slice","some","subarray","toLocaleString","toString","values",Symbol.iterator];class E{constructor(t,e){const n=new h.Proxy(t,this);return f.set(n,t),l.set(t,e),l.set(n,e),p.set(n,this),this.Xr=e,this.eo=t,n}apply(t,e,n){return this.Xr.no?this.Xr.no(this.eo,e,n):Reflect.apply(this.eo,e,n)}construct(t,e,n){return this.Xr.ro?this.Xr.ro(this.eo,e,n):Reflect.construct(this.eo,e,n)}defineProperty(t,e,n){return this.Xr.oo?this.Xr.oo(this.eo,e,n):Reflect.defineProperty(this.eo,e,n)}deleteProperty(t,e){return this.Xr.io?this.Xr.io(this.eo,e):Reflect.deleteProperty(this.eo,e)}getOwnPropertyDescriptor(t,e){return this.Xr.so?this.Xr.so(this.eo,e):Reflect.getOwnPropertyDescriptor(this.eo,e)}getPrototypeOf(t){return this.Xr.co?this.Xr.co(this.eo):Reflect.getPrototypeOf(this.eo)}has(t,e){return this.Xr.ao?this.Xr.ao(this.eo,e):Reflect.has(this.eo,e)}isExtensible(t){return this.Xr.uo?this.Xr.uo(this.eo):Reflect.isExtensible(this.eo)}ownKeys(t){return this.Xr.ho?this.Xr.ho(this.eo):Reflect.ownKeys(this.eo)}preventExtensions(t){return this.Xr.fo?this.Xr.fo(this.eo):Reflect.preventExtensions(this.eo)}set(t,e,n,r){return this.Xr.lo?this.Xr.lo(this.eo,e,n,r):Reflect.set(this.eo,e,n,r)}setPrototypeOf(t,e){return this.Xr.po?this.Xr.po(this.eo,e):Reflect.setPrototypeOf(this.eo,e)}get(t,e,n){const s=r(this.eo),c=o(this.eo),a=i(this.eo);if(s&&d.includes(e)||c&&g.includes(e)||a&&w.includes(e))return this.Xr.yo&&this.Xr.yo(),Reflect.get(this.eo,e,this.eo);if(s&&b.includes(e)||c&&_.includes(e)||a&&m.includes(e)){const t=Reflect.get(this.eo,e,n);if(this.Xr.yo&&this.Xr.yo(),y.has(t))return y.get(t);const r=new S(s,c,a,e),o=new Proxy(t,r);return y.set(t,o),o}return this.Xr.wn?this.Xr.wn(this.eo,e,n):Reflect.get(this.eo,e,n)}static At(t){return l.get(t)}static do(t){return f.get(t)}static wo(t,e){const n=f.get(t),r=l.get(t),o=p.get(t);a(n),o.eo=e,l.delete(n),l.set(e,r),f.set(t,e)}}class S{constructor(t,e,n,r){this.bo=t,this._o=e,this.Qt=n,this.mo=r,this._read=O.includes(r),this.yn=P.includes(r),this.Po=t&&["add"].includes(r)||e&&["set"].includes(r)||n&&["copyWithin","fill","reverse","sort"].includes(r),this.Oo=t&&["entries","values",Symbol.iterator].includes(r)||e&&["entries","keys","values",Symbol.iterator].includes(r),this.Eo=this.Oo&&"entries"===r,this.So=e&&"get"===r,this.vo=t&&["add","delete","has"].includes(r)||e&&["delete","get","has","set"].includes(r),this.Ao=e&&"set"===r,this.Io=t&&"forEach"===r||e&&"forEach"===r}apply(t,e,n){const r=E.At(e);r&&(r.xo&&this._read&&r.xo(),r.jo&&this.yn&&r.jo()),this.Io&&(n[0]=t=>r&&r.To&&t?r.To(t):t),this.vo&&n[0]&&r&&r.Ro&&(n[0]=r.Ro(n[0])),this.Ao&&n[1]&&r&&r.Ro&&(n[1]=r.Ro(n[1]));const o=E.do(e)||e,i=Reflect.apply(t,o,n);return this.Po?e:this.So?r&&r.To&&i?r.To(i):i:this.Oo?new A(i,r,this.Eo):i}}class v{constructor(t,e,n){this.ko=t,this.Xr=e,this.$o=n}next(){const t=this.ko.next(),e={};if(e.done=t.done,e.value=t.value,this.Xr&&this.Xr.To)if(this.$o&&e.value){const t=e.value[0]?this.Xr.To(e.value[0]):e.value[0],n=e.value[1]?this.Xr.To(e.value[1]):e.value[1];e.value=[t,n]}else e.value=e.value?this.Xr.To(e.value):e.value;return e}[Symbol.iterator](){return this}}const A=u.jt(v,{},!0,!1)[0];t.exports=E},function(t,e,n){const{h:r,A:o,qt:i,Yt:s,Zt:c,Qt:a,v:u}=n(1),h=n(6),f=n(4),l=f.W,p=f.Jt,y=f.re,d=f.ne,g=new Set;"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split("").forEach(t=>g.add(t));const w=t=>{throw new Error("Cannot encode "+r(t))},b=t=>{throw new Error("Cannot decode "+r(JSON.stringify(t)))};t.exports=class{constructor(){this.Co=p,this.Uo=void 0,this.No=void 0,this.Fo=new Map,this.Bo=new Map,this.Mo=null}pr(t){return this.Fo=new Map,this.Do(t,[])}Lo(t){return this.Bo=new Map,this.Mo=t,this.Go(t)}Jo(){return this.Co=l,this}lr(t){return this.Uo=t,this}Wo(t){return this.No=t,this}Do(t,e){switch(typeof t){case"undefined":{const t=this.Ho();return t.$und=1,t}case"string":case"boolean":return t;case"number":if(isNaN(t)||!isFinite(t)||Object.is(t,-0)){const e=this.Ho();return isNaN(t)&&(e.$nan=1),t===1/0&&(e.$inf=1),t===-1/0&&(e.$ninf=1),Object.is(t,-0)&&(e.$n0=1),e}return t;case"symbol":break;case"object":case"function":if(!t)return null;if(this.Fo.has(t)){const e=this.Ho();return e.$dup=this.Co.Array.from(this.Fo.get(t)),e}return this.Fo.set(t,e),this.zo(t,e)}w(t)}zo(t,e){if((y.has(t)||d.has(t))&&w(t),o(t)){const n=Object.keys(t).some(t=>t.startsWith("$")),r=this.Ho();let o=r,i=e;return n&&(r.$obj=this.Ho(),o=r.$obj,i=e.concat(["$obj"])),Object.keys(t).forEach(e=>{o[e]=this.Do(t[e],i.concat([e.toString()]))}),r}if(i(t)){const n=Object.keys(t);if(n.length===t.length){const r=this.Vo();return n.forEach(n=>r.push(this.Do(t[n],e.concat([n.toString()])))),r}{const r=this.Ho(),o=this.Ho(),i=e.concat(["$arr"]);return n.forEach(e=>{o[e]=this.Do(t[e],i.concat([e.toString()]))}),r.$arr=o,r}}if(s(t)){const n=this.Ho();n.$set=this.Vo();let r=0;const o=e.concat(["$set"]);for(const e of t)n.$set.push(this.Do(e,o.concat([r.toString()]))),r++;if(Object.keys(t).length){n.props=this.Ho();const r=e.concat(["props"]);Object.keys(t).forEach(e=>{n.props[e]=this.Do(t[e],r.concat([e.toString()]))})}return n}if(c(t)){const n=this.Ho();n.$map=this.Vo();let r=0;const o=e.concat(["$map"]);for(const[e,i]of t){const t=this.Vo();t.push(this.Do(e,o.concat([r.toString(),"0"]))),t.push(this.Do(i,o.concat([r.toString(),"1"]))),n.$map.push(t),r++}if(Object.keys(t).length){n.props=this.Ho();const r=e.concat(["props"]);Object.keys(t).forEach(e=>{n.props[e]=this.Do(t[e],r.concat([e.toString()]))})}return n}if(a(t)){Object.keys(t).length!==t.length&&w(t);const e=this.Ho(),n=Buffer.from(new Uint8Array(t));return e.$ui8a=n.toString("base64"),e}if(this.Uo){if(t instanceof h){const e=this.Ho();return e.$jig=this.Uo(t),e}const n=this.Ho(),r=Object.assign({},t),o=e.concat(["$arb"]),i=e.concat(["T"]);return n.$arb=this.Do(r,o),n.T=this.Do(t.constructor,i),n}w(t)}Go(t){switch(typeof t){case"string":case"boolean":return t;case"number":if(isNaN(t)||!isFinite(t)||Object.is(t,-0))break;return t;case"object":case"function":return t?this.Ko(t):null}b(t)}Ko(t){if(o(t)){let e;if(Object.keys(t).forEach(n=>{n.startsWith("$")&&(e&&b(t),e=n)}),"$und"===e&&1===t.$und)return;if("$n0"===e&&1===t.$n0)return-0;if("$nan"===e&&1===t.$nan)return NaN;if("$inf"===e&&1===t.$inf)return 1/0;if("$ninf"===e&&1===t.$ninf)return-1/0;if(!e){const e=this.Ho();return this.Bo.set(t,e),Object.keys(t).forEach(n=>{e[n]=this.Go(t[n])}),e}if("$obj"===e){const e=t.$obj;o(e)&&e||b(t);const n=this.Ho();return this.Bo.set(t,n),Object.keys(e).forEach(t=>{n[t]=this.Go(e[t])}),n}if("$arr"===e){o(t.$arr)&&t.$arr||b(t);const e=this.Vo();this.Bo.set(t,e);const n=t.$arr;return Object.keys(n).forEach(t=>{e[t]=this.Go(n[t])}),e}if("$dup"===e){const e=t.$dup;i(e)||b(t);let n=this.Mo;for(let r=0;r<e.length;r++){const o=e[r];o in n||b(t),n=n[o]}const r=this.Bo.get(n);return this.Bo.set(t,r),r}if("$set"===e){i(t.$set)||b(t),u(t.props)||o(t.props)||b(t);const e=this.qo();this.Bo.set(t,e);for(const n of t.$set)e.add(this.Go(n));const n=t.props;return n&&Object.keys(n).forEach(t=>{e[t]=this.Go(n[t])}),e}if("$map"===e){i(t.$map)||b(t),u(t.props)||o(t.props)||b(t);const e=this.Yo();this.Bo.set(t,e);for(const n of t.$map)i(n)&&2===n.length||b(t),e.set(this.Go(n[0]),this.Go(n[1]));const n=t.props;return n&&Object.keys(n).forEach(t=>{e[t]=this.Go(n[t])}),e}if("$ui8a"===e){"string"!=typeof t.$ui8a&&b(t),t.$ui8a.split("").some(t=>!g.has(t))&&b(t);const e=Buffer.from(t.$ui8a,"base64"),n=new this.Co.Uint8Array(e);return this.Bo.set(n,n),n}}if(i(t)){const e=this.Vo();this.Bo.set(t,e);for(const n of t)e.push(this.Go(n));return e}if(this.No){if(o(t)&&!u(t.$jig)){const e=this.No(t.$jig);if(e)return this.Bo.set(t,e),e}if(o(t)&&!u(t.$arb)&&!u(t.T)){const e=this.Ho();this.Bo.set(t,e),Object.assign(e,this.Go(t.$arb));const n=this.Go(t.T);return Object.setPrototypeOf(e,n.prototype),e}}b(t)}Ho(){return new this.Co.Object}Vo(){return new this.Co.Array}qo(){return new this.Co.Set}Yo(){return new this.Co.Map}}},function(t,e,n){const r=n(7),o=n(3),{g:i,R:s,zt:c,ue:a,he:u,P:h,h:f,j:l}=n(1),{F:p}=n(10),{StateError}=n(12),{B:y}=n(5),Code=n(0),d=n(22),g=n(18),w=n(20),b=n(4),{Ie:_}=n(6);class m{constructor(t,e){s(e instanceof Promise),this.cn=t,this.Kn=e}}t.exports={zn:async function(t,e,s){const a=n(14);s=s||new a(i());const u=await s.g.dr.get(t);if(!u)return;if(o.kt("State","Recreate",t),h("03"===u.version,"Unsupported state version: "+u.version),e){const n=JSON.stringify(u),o=new r.deps.Buffer(n,"utf8"),i=r.crypto.Hash.sha256(o).toString("hex");h(i===e,"State hash mismatch for "+t)}const f=new Map,p=(new w).Jo().Wo(t=>(f.set(t,null),(t=>{class e{}return e.location=t,e})(t))),P=p.Lo(u.props);u.cls&&p.Lo(u.cls);const O=t.split("//")[1].split("_")[0];switch(u.kind){case"code":return async function(t,e,n,r,o){const i={},s=c(t.src);if(s){const t=e.deps[s].location,c=t.startsWith("_")?r+t:t,a=await o.Dn(c);n.set(t,a),i[s]=a}const a=new Code,u=b.Ne(t.src,i)[0],[f,p]=Code.Gt(a,u),d=!1;Code.Ut(a).q(f,d);const g=(async()=>{for(const t of n.keys()){if(n.get(t))continue;const e=t.startsWith("_")?r+t:t,i=await o.Dn(e);n.set(t,i)}function e(t){const e=n.get(t),o=t.startsWith("_")?r+t:t;return h(e,"Jig not loaded: "+o),e}const i=(new w).Jo().Wo(e).Lo(t.props);Object.keys(i.deps||{}).forEach(t=>{const e={configurable:!0,enumerable:!0,writable:!0};e.value=i.deps[t],Object.defineProperty(p,t,e)}),y(()=>{Object.keys(i).forEach(t=>{l(a,t,i[t])})}),y(()=>{a.origin.startsWith("_")&&(a.origin=r+a.origin),a.location.startsWith("_")&&(a.location=r+a.location)})})();return new m(a,g)}(u,P,f,O,s);case"jig":return async function(t,e,n,r,o){const i=g.je(),s=new d(e,i);async function c(){for(const t of n.keys()){if(n.get(t))continue;const e=t.startsWith("_")?r+t:t,i=await o.Dn(e);n.set(t,i)}const e=n.get(t.cls.$jig);function i(t){const e=n.get(t),o=t.startsWith("_")?r+t:t;return h(e,"Jig not loaded: "+o),e}y(()=>Object.setPrototypeOf(s,e.prototype));const c=(new w).Jo().Wo(i).Lo(t.props);y(()=>{Object.keys(c).forEach(t=>{l(s,t,c[t])})}),y(()=>{s.origin.startsWith("_")&&(s.origin=r+s.origin),s.location.startsWith("_")&&(s.location=r+s.location)})}_.add(s);const a=c();return new m(s,a)}(u,P,f,O,s);case"berry":return async function(t,e){return new m({$berry:123},Promise.resolve())}();default:throw new StateError("Unknown jig kind: "+u.kind)}},rt:async function(t,e){o.tt("State","Capture",f(t));const r=e.ar.get(t);s(r);const i={version:"03"};i.kind=r.Zo,i.props=Object.assign({},r.sn),r.Qo&&(i.cls=r.Qo),r.En&&(i.src=r.En);const c=e.Zn.findIndex(e=>a(e,t)),h=e.He.findIndex(e=>a(e,t)),l=-1===c?"_d"+h:"_o"+(c+1);i.props.origin.startsWith(e.Me)&&(i.props.origin=l),i.props.location=l;const d=await async function(t,e){if(u(e.Ge,t))return new Map;const r=e.or.get(t).sn.location,o=new(n(14))(e.g,e.Mn),i=await o.Dn(r),s=new Map,c=n(6);return p(i,t=>{t instanceof c&&y(()=>s.set(t.origin||t.location,t.location))}),s}(t,e),g=(new w).lr(t=>{const n=e.Zn.findIndex(e=>a(t,e));if(n>=0)return"_o"+(n+1);const r=e.He.findIndex(e=>a(t,e));if(r>=0)return"_d"+r;const o=e.hr.find(e=>a(t,e));if(o)return e.or.get(o).sn.location;const i=y(()=>t.origin);if(i.startsWith("native://"))return i;const c=d.get(i);return s(c),c});return i.props=g.pr(i.props),i.cls&&(i.cls=g.pr(i.cls)),i},_hash:function(t){const e=JSON.stringify(t),n=r.deps.Buffer.from(e,"utf8");return r.crypto.Hash.sha256(n).toString("hex")}}},function(t,e,n){const{Fe:r,B:o}=n(5),{R:i,P:s,h:c,I:a,j:u,ee:h,C:f,ie:l}=n(1),{D:p,G:y,J:d,M:g}=n(11),{N:w,F:b}=n(10),_=n(4),m=_.W,P=n(19),O=n(18),E=n(6),Code=n(0),S=()=>n(8).nt,v=new WeakMap;let A=new Set;function I(t){const Code=n(0),e=`function ${t} (...args) { return Code.prototype.${t}.apply(this, args) }`,r=_.Ne(e,{Code})[0];return Object.freeze(r)}const x={toString:I("toString"),sync:I("sync"),upgrade:I("upgrade"),destroy:I("destroy"),auth:I("auth")},j=Object.keys(x),T=["init","sync"];class R{constructor(t,e=new O){return this.vt=e,this.Xo=new P(t,this),this.xe=this.vt.Fr||this.Xo,this.Xo}no(t,e,r){return this.ti()?Reflect.apply(t,e,r):this.ei(()=>{this.ni(),this.vt.Kr&&(e=void 0),this.ri()&&S()._read(this.xe);let o=P.At(e);const i=o&&o.vt.$n,a=i&&i.includes(t.name);s(!a,t.name+" disabled");let u=o&&o.vt.zr&&this.vt.Hr;const Jig=n(2);if(u||"function"!=typeof e||e instanceof Jig||(e=new Code(e),o=P.At(e),u=o&&o.vt.zr&&this.vt.Hr),!u)return Reflect.apply(t,e,r);const f=S().et,p=!f.length||e!==f[f.length-1].xe;return S().rt(()=>{if(!f.length){const{Cn:t}=n(13);r=t(e,r)}f.length&&o.oi("",r);let i=null;const a=this.ii(o,r);n(13).kn(e,t.name,r,()=>{const n=`Cannot call ${t.name} on ${c(e)}`,r=function(t,e,n){if(!t)return!0;if(!(t instanceof E))return!1;if(t[e]===n)return!0;const r=S().et;if(r.length<2||r[r.length-2].xe!==t)return!1;let o=Object.getPrototypeOf(t);for(;o;){if(l(o,e)===n)return!0;o=Object.getPrototypeOf(o)}return!1}(e,t.name,this.Xo);s(r,n),this.ri()&&S()._read(this.xe);const o=A;try{p&&(A=new Set),i=Reflect.apply(t,e,a)}finally{A=o}}),s(!(i instanceof Promise||i instanceof m.Promise),"Async methods not supported"),s(h(i),"Return value not serializable");return this.si(i,e,!1)})})}ro(t,e,r){return this.ti()?Reflect.construct(t,e,r):this.ei(()=>{if(this.ni(),this.ri()){const t=n(6);let e=this.xe;for(;e instanceof t;)e=Object.getPrototypeOf(e)}return Reflect.construct(t,e,r)})}oo(t,e,r){return this.ti()?Reflect.defineProperty(t,e,r):this.ei(()=>{this.ni(),this.ri()&&S().yn(this.xe);const o=Object.getOwnPropertyDescriptor(t,e);if(r=Object.assign({},o,r),s("value"in r,"Descriptor must have a value"),s(!("get"in r),"Getters are not supported"),s(!("set"in r),"Getters are not supported"),s(r.configurable,"Descriptor must be configurable"),s(r.writable,"Descriptor must be writable"),s(r.enumerable,"Descriptor must be enumerable"),this.ci(e))throw new Error("Cannot define "+e);if(this.ai(e))throw new Error("Cannot define "+e);if(this.oi(e,r.value),this.ui(t,e,r.value),this.hi(e),!this.fi(e))throw new Error("Cannot define private property "+e);if(this.vt.Wr)throw new Error("defineProperty disabled");this.li(),t=this.pi()||t,r.value=this.ii(this,r.value),this.yi(r.value);const Unbound=n(9);return!this.di(e)||r.value instanceof Unbound||(r.value=new Unbound(r.value)),r.value instanceof E||(r.value=P.do(r.value)||r.value),Reflect.defineProperty(t,e,r)})}io(t,e){return this.ti()?Reflect.deleteProperty(t,e):this.ei(()=>{if(this.ni(),this.ri()&&S().yn(this.xe),this.ci(e))throw new Error("Cannot delete "+e);if(this.ai(e))throw new Error("Cannot delete "+e);if(this.di(e))throw new Error("Cannot delete "+e);if(!this.fi(e))throw new Error("Cannot delete private property "+e);if(this.vt.Wr)throw new Error("delete disabled");return this.li(),t=this.pi()||t,Reflect.deleteProperty(t,e)})}wn(t,e,r){return this.ti()?Reflect.get(t,e,r):this.ei(()=>{if(this.ni(),this.ci(e))return x[e];if(this.ai(e)&&"init"!==e){const Jig=n(2);let o=Reflect.get(t,e,r);return o=this.gi(o,Jig,!0),o}if("function"==typeof t&&"prototype"===e||"constructor"===e||"symbol"==typeof e)return Reflect.get(t,e,r);if(this.ri()&&S()._read(this.xe),this.wi(t,e),!this.fi(e))throw new Error("Cannot access private property "+e);let o=Reflect.get(t,e,r);if(this.bi(o))return o;if(o instanceof E)return o;const Unbound=n(9);this.di(e)&&o instanceof Unbound&&(o=o.cn);const i=this._i(e),s=i===this.xe;return o=this.si(o,i,s),o})}so(t,e){return this.ti()?Reflect.getOwnPropertyDescriptor(t,e):this.ei(()=>{this.ni(),this.ri()&&S()._read(this.xe);if("function"==typeof t&&"prototype"===e||"constructor"===e||"symbol"==typeof e)return Reflect.getOwnPropertyDescriptor(t,e);if(this.ci(e))return;if(this.ai(e))return;if(this.wi(t,e),!this.fi(e))throw new Error("Cannot access private property "+e);const r=Reflect.getOwnPropertyDescriptor(t,e);if(!r)return;if(this.bi(r.value))return r;if(r.value instanceof E)return r;const Unbound=n(9);this.di(e)&&r.value instanceof Unbound&&(r.value=r.value.cn);return r.value=this.si(r.value,this.xe,!0),r})}co(t){return this.ti()?Reflect.getPrototypeOf(t):this.ei(()=>(this.ni(),this.ri()&&S()._read(this.xe),Reflect.getPrototypeOf(t)))}ao(t,e){return this.ti()?Reflect.has(t,e):this.ei(()=>{if(this.ni(),this.ri()&&S()._read(this.xe),this.ci(e))return!0;if(this.ai(e))return!0;if(!this.fi(e))throw new Error("Cannot access private property "+e);return Reflect.has(t,e)})}uo(t){return this.ti()?Reflect.isExtensible(t):this.ei(()=>(this.ni(),!0))}ho(t){return this.ti()?Reflect.ownKeys(t):this.ei(()=>(this.ni(),this.ri()&&S()._read(this.xe),Reflect.ownKeys(t).filter(t=>this.fi(t))))}fo(t){return this.ti()?Reflect.preventExtensions(t):this.ei(()=>{throw this.ni(),new Error("preventExtensions disabled")})}lo(t,e,r,i){return this.ti()?Reflect.set(t,e,r,i):this.ei(()=>{if(this.ni(),i!==this.Xo)return u(i,e,r),!0;if(this.ri()&&S().yn(this.xe),this.ci(e))throw new Error("Cannot set "+e);if(this.ai(e))throw new Error("Cannot set "+e);if(this.oi(e,r),this.ui(t,e,r),this.hi(e),!this.fi(e))throw new Error("Cannot set private property "+e);if(this.vt.Wr)throw new Error("set disabled");this.li(),t=this.pi()||t,r=this.ii(this,r),this.yi(r);const Unbound=n(9);return!this.di(e)||r instanceof Unbound||(r=new Unbound(r)),r instanceof E||(r=P.do(r)||r),o(()=>u(t,e,r)),!0})}po(t,e){return this.ti()?Reflect.setPrototypeOf(t,e):this.ei(()=>{throw this.ni(),new Error("setPrototypeOf disabled")})}yo(){if(!this.ti())return this.ei(()=>{this.ni(),this.ri()&&S()._read(this.xe)})}To(t){return this.ti()?t:this.ei(()=>{if(this.ni(),this.bi(t))return t;if(t instanceof E)return t;return t=this.si(t,this.xe,!0)})}Ro(t){return this.ti()?t:this.ei(()=>(this.ni(),t instanceof E?t:(this.oi("",t),t=this.ii(this,t),this.yi(t),t=P.do(t)||t)))}xo(){if(!this.ti())return this.ei(()=>{this.ni(),this.ri()&&S()._read(this.xe)})}jo(){if(!this.ti())return this.ei(()=>{if(this.ni(),this.ri()&&S().yn(this.xe),this.vt.Wr)throw new Error("Immutable");this.li(),this.pi()})}ni(){if(!this.vt.Br)return;const t=P.do(this.xe);if(!a(t,"location"))return;const{error:e,undeployed:n}=p(t.location);if(e&&!n)throw new Error(e)}ei(t){const e=S();try{const n=t();if(e.Ce)throw e.Ce;return n}catch(t){throw e.et.length&&!e.Ce&&(e.Ce=t),t}}li(){if(!this.vt.Vr)return;const t=S().et;if(!t.length||t[t.length-1].xe!==this.xe)throw new Error("Updates must be performed in the jig's methods")}oi(t,e){s("symbol"!=typeof t,"Symbol names are not serializable"),s(h(e),"Not serializable: "+c(e)),b(e,t=>s(h(t),"Not serializable: "+c(t)))}wi(t,e){if(this.vt.Mr)try{if("location"===e||"origin"===e||"nonce"===e){const n=Reflect.get(t,e),r=p("nonce"===e?t.location:n);if(s(!r.undeployed,"Hint: Sync the jig to deploy it"),s(!r.error,"A previous error occurred\n\n"+r.error),r.nativeid)return;const o="Hint: Sync the jig to assign it in a transaction";s(r.txid,o)}if("owner"===e||"satoshis"===e){const r=Reflect.get(t,e),o=r instanceof n(9)&&void 0===r.cn;s(!o,"Hint: Sync the jig to assign it in a transaction")}}catch(t){throw new Error(`Cannot read ${e}\n\n${t.message}`)}}ui(t,e,r){if(!this.vt.Mr)return;s("origin"!==e,"Cannot set origin"),s("location"!==e,"Cannot set location"),s("nonce"!==e,"Cannot set nonce");const Unbound=n(9),o=`Cannot set ${e}\n\nHint: Sync the jig to bind it in a transaction`,i=this.di(e)&&t[e]instanceof Unbound&&t[e].cn;s(!i,o);"owner"===e&&y(r,!1),"satoshis"===e&&d(r)}hi(t){this.vt.Dr&&s(!f.includes(t),t+" is reserved")}fi(t){if(!this.vt.Jr)return!0;if("string"!=typeof t||!t.startsWith("_"))return!0;const Jig=n(2),e=S().et;if(!e.length)return!1;const r=e[e.length-1].xe;return"function"==typeof this.xe?r===this.xe||r.constructor===this.xe:(i(this.xe instanceof Jig),r.constructor===this.xe.constructor||r===this.xe.constructor)}si(t,e,n){if(!e)return t;if(!this.mi(t))return t;if(t instanceof E)return t;const r=S().et,o=r.length&&r[r.length-1].xe===this.xe;return o&&A.has(t)||(t=this.gi(t,e,n),o||(t=this.Pi(t))),t}gi(t,e,n){if(P.do(t))return t;if(v.has(e)||v.set(e,new WeakMap),v.get(e).has(t))return v.get(e).get(t);const r="function"==typeof t,o=O.It(e,r,n),i=new R(t,o);return v.get(e).set(t,i),i}Pi(t){if(!this.vt.Yr)return t;if("function"==typeof t)return t;const e=S().et;if(e.length&&e[e.length-1].xe===this.xe)return t;const n=O.qr();return new R(t,n)}ii(t,e){if(!t.vt.Vr)return e;const n=S().et;if(!(!n.length||n[n.length-1].xe!==t.xe))return e;if(!t.mi(e))return e;if(e instanceof E)return e;const r=O.qr();return new R(e,r)}yi(t){b(t,t=>{if(t instanceof E)return!1;const e=P.At(t);if(e){if(e.vt.Fr===this.xe)return!1;s(!e.vt.Fr,"Ownership violation"),e.pi();const n="function"==typeof t,r=!0;e.vt=O.It(this.xe,n,r)}else S().et.length&&A.add(t)})}pi(){if(!this.vt.qr)return;const t=P.do(this.Xo),e=w(t,m);return P.wo(this.Xo,e),this.vt.qr=!1,e}_i(t){let e=this.xe,n=this.Xo;for(;!a(n,t);)n=Object.getPrototypeOf(n),i(n),e="object"==typeof n?n.constructor:n,e instanceof E||(e=null),e&&this.ri()&&P.At(e).ri()&&S()._read(e);return e}ti(){return this.vt.Fe&&r()}ci(t){return this.vt.Lr&&j.includes(t)}ai(t){return this.vt.Gr&&T.includes(t)}ri(){return this.vt.Hr&&!!S().et.length}di(t){return this.vt.Mr&&g.includes(t)}mi(t){return t&&("object"==typeof t||"function"==typeof t)}bi(t){return["undefined","boolean","number","string","symbol"].includes(typeof t)||null===t}}t.exports=R},function(t,e,n){const{h:r,$:o,j:i}=n(1),{N:s}=n(10),{B:c}=n(5),a=n(3),u=n(26);t.exports=class{constructor(t){a.tt("Snapshot","Snapshot",r(t)),this.xe=t;const Jig=n(2),Code=n(0),Berry=n(25);if(t instanceof Jig)this.Zo="jig";else if(t instanceof Code)this.Zo=Code.Ut(t).X?"native":"code";else{if(!(t instanceof Berry))throw new Error("Must only snapshot jigs: "+r(t));this.Zo="berry"}if(c(()=>{const e=Object.assign({},t),n=s(e);this.sn=n}),"jig"!==this.Zo&&"berry"!==this.Zo||(this.Qo=t.constructor),"code"===this.Zo){const e=Code.Ut(t),n=e.Y;this.Z=e.Z,this.Oi=u.gt(n),this.En=o(n.toString(),e.Z.name)}}it(){if("native"!==this.Zo)return c(()=>{if("code"===this.Zo){const t=n(0).Ut(this.xe);t.Z=this.Z;const e=t.Y;u.Pt(e,this.Oi)}Object.keys(this.xe).forEach(t=>{delete this.xe[t]}),Object.keys(this.sn).forEach(t=>{i(this.xe,t,this.sn[t])})})}}},function(t,e,n){const{R:r,g:o,ue:i,fe:s,le:c}=n(1),{B:a}=n(5),{M:u,Ct:h}=n(11),f=n(23),l=n(3),p=n(15),y="Commit",d=new Map;class g{constructor(t){const e=t.Me.split("record://")[1];this.Me="commit://"+e,l.tt(y,"Create",this.Me),this.Ei=t,this.rr=c(s(s(t.We,t.ze),t.He),t.Ge),this.Zn=c(s(this.rr,t.Ge),t.He),this.hr=c(c(c(t.Je,this.rr),this.Zn),t.He),this.Ge=[...t.Ge],this.He=[...t.He],this.Le=[...t.Le],r(this.Le.length),r(this.rr.length||this.Zn.length||this.He.length),this.tr=t.Ke,this.Si=[],this.tr.forEach(t=>t.Si.push(this)),this.vi(),this.or=new Map(t.Ye),this.ar=new Map;this.Zn.concat(this.He).forEach(t=>{const e=new f(t);this.ar.set(t,e)}),this.Ai=[],this.er=!1,this.Ce=null,this.g=o();const{Bn:i}=n(16);this.Mn=new i("publish"),d.set(this.Me,this),!this.tr.length&&this.Ei.Ze&&p(this)}async Se(){if(l.tt(y,"Sync",this.Me),r(d.has(this.Me)),!this.er||this.Ce){if(this.er&&this.Ce)throw this.Ce;return new Promise((t,e)=>{this.Ai.push({resolve:t,reject:e})})}}vi(){a(()=>{this.Zn.forEach((t,e)=>{const n=`${this.Me}_o${e+1}`,r=t.origin!==t.location;t.origin=r?t.origin:n,t.location=n,t.nonce=t.nonce+1}),this.He.forEach((t,e)=>{const n=`${this.Me}_d${e}`,r=t.origin!==t.location;t.origin=r?t.origin:n,t.location=n,t.nonce=t.nonce+1})})}Ii(t){this.tr=this.tr.filter(e=>e!==t);for(const[e,r]of t.ar){const t=this.rr.find(t=>i(t,e))||this.hr.find(t=>i(t,e));if(!t)continue;const o=this.or.get(t);if(!o)continue;u.forEach(t=>{o.sn[t]=r.sn[t]});const Unbound=n(9),s=this.ar.get(t);if(s){const t=s.sn;s.sn.origin=r.sn.origin,t.owner instanceof Unbound&&!t.owner.cn&&(t.owner=r.sn.owner),t.satoshis instanceof Unbound&&!t.satoshis.cn&&(t.satoshis=r.sn.satoshis)}this.ur(t)||a(()=>{t.owner instanceof Unbound&&!t.owner.cn&&(t.owner=r.sn.owner),t.satoshis instanceof Unbound&&!t.satoshis.cn&&(t.satoshis=r.sn.satoshis)})}!this.tr.length&&this.Ei.Ze&&p(this)}ur(t){for(const e of this.Si)for(const n of e.rr)if(i(t,n))return!0;return!1}Dt(){r(d.delete(this.Me)),this.er=!0,r(!this.Ai.length),r(!this.Si.length)}Lt(){d.set(this.Me,this),this.er=!1}sr(){r(d.delete(this.Me)),this.er=!0,this.Ai.forEach(t=>t.resolve()),this.Ai=[],this.Si.forEach(t=>t.Ii(this))}cr(t){r(d.delete(this.Me)),r(t),this.er=!0,this.Ce=t,this.Si.forEach(e=>e.cr(t));const e=t&&0===this.Ai.length;l.Ce(y,e?"Unhandled":"",t),l.tt(y,"Rollback "+this.Me);for(const[t,e]of this.or)e.it(),a(()=>{const Jig=n(2);t instanceof Jig&&t.location===h&&(t.origin="error://Deploy failed",t.location="error://Deploy failed")});if(e){const e="error://Unhandled "+t;a(()=>{this.Zn.forEach(t=>{t.location=e}),this.He.forEach(t=>{t.location=e})})}t&&(this.Ai.forEach(e=>e.reject(t)),this.Ai=[])}}g.wn=t=>d.get(t),g.xi=async()=>{const t=[];for(const e of d.values())t.push(e.Se());return Promise.all(t)},t.exports=g},function(t,e,n){class BerryDeps{static get de(){return n(0)}static get Be(){return n(6).Be}}class Berry{constructor(...t){this.constructor,BerryDeps.de,BerryDeps.Be.add(this)}static[Symbol.hasInstance](t){return BerryDeps.Be.has(t)}}Berry.deps={BerryDeps},Berry.sealed=!1,Berry.toString();const r=new BerryDeps.de;BerryDeps.de.Ut(r).xt(Berry,!1),t.exports=r},function(t,e,n){const r=n(4),{_:o,h:i}=n(1),{Fe:s}=n(5),c=r.W,a=new WeakMap;function u(t){const e=a.get(t);return o(e,"Not a dynamic type: "+i(t)),e}function h(){const t=a.get(this),e=t?t.Oi:this;return c.Function.prototype.toString.apply(e)}class f{constructor(){const t=r.Ne("function dynamic() {}")[0];Object.getOwnPropertyNames(t.prototype).forEach(e=>{delete t.prototype[e]});const e={},n=new p,o=new Proxy(e,n),i=Object.getPrototypeOf(t.prototype);Object.setPrototypeOf(e,i),Object.setPrototypeOf(t.prototype,o),Object.freeze(t.prototype);const s=new l;n.V(o,s);const c=new Proxy(t,s);return s.V(t,e,c),a.set(c,s),c}static gt(t){return u(t).Oi}static Pt(t,e){u(t).Pt(e)}static ji(t){return u(t).Ti}static H(t,e){u(t).H(e)}}class l{V(t,e,n){this.Ri=t,this.Oi=t,this.Ti=n,this.Xo=n,this.ki=e}apply(t,e,n){return Reflect.apply(this.Oi,e,n)}construct(t,e,n){let r=n;try{r=f.ji(n)}catch(t){}return Reflect.construct(this.Oi,e,r)}defineProperty(t,e,n){if("prototype"===e)throw new Error("Cannot define prototype");if("toString"===e)throw new Error("Cannot define toString");if(!n.configurable)throw new Error("Cannot define nonconfigurable property");return Reflect.defineProperty(this.Oi,e,n),!0}deleteProperty(t,e){if("prototype"===e)throw new Error("Cannot delete prototype");if("toString"===e)throw new Error("Cannot delete toString");return Reflect.deleteProperty(this.Oi,e),!0}get(t,e,n){return"prototype"===e?this.Ri.prototype:"toString"===e?h:Reflect.get(this.Oi,e,n)}getPrototypeOf(t){return Reflect.getPrototypeOf(this.Oi)}getOwnPropertyDescriptor(t,e){return"prototype"===e?Object.getOwnPropertyDescriptor(this.Ri,e):Reflect.getOwnPropertyDescriptor(this.Oi,e)}has(t,e){return Reflect.has(this.Oi,e)}isExtensible(t){return Reflect.isExtensible(this.Ri)}ownKeys(t){return Reflect.ownKeys(this.Oi)}preventExtensions(t){return Object.preventExtensions(this.Ri),Object.preventExtensions(this.Oi),!0}set(t,e,n,r){if("prototype"===e)throw new Error("Cannot set prototype");if("toString"===e)throw new Error("Cannot set toString");return Reflect.set(this.Oi,e,n),!0}setPrototypeOf(t,e){return Reflect.setPrototypeOf(this.Oi,e),!0}Pt(t){o("function"==typeof t,"Inner type must be a function type: "+t);let e=t;for(;e&&e!==Function.prototype&&e!==c.Function.prototype;){const n="toString is a reserved property: "+t;o(!Object.getOwnPropertyNames(e).includes("toString"),n),e=Reflect.getPrototypeOf(e)}Reflect.isExtensible(this.Ri)&&Reflect.isExtensible(t)||(Reflect.preventExtensions(this.Ri),Reflect.preventExtensions(t));const n=this.Oi.toString().startsWith("class"),r=t.toString().startsWith("class"),i="Classes can only be changed to classes and functions to functions: "+t,s=this.Oi===this.Ri||t===this.Ri;o(s||n===r,i);Object.getOwnPropertyNames(this.ki).forEach(t=>{delete this.ki[t]});const a=Reflect.getPrototypeOf(t.prototype);Reflect.setPrototypeOf(this.ki,a);Object.getOwnPropertyNames(t.prototype).forEach(e=>{const n=Reflect.getOwnPropertyDescriptor(t.prototype,e);Reflect.defineProperty(this.ki,e,n)}),this.ki.constructor=this.Ti,this.Oi=t}H(t){this.Ti!==this.Xo&&a.delete(this.Ti),a.set(t,this),this.Ti=t,this.ki.constructor=t}}class p{V(t,e){this.Xo=t,this.$i=e}defineProperty(t,e,n){throw new Error("defineProperty disabled")}deleteProperty(t,e){throw new Error("deleteProperty disabled")}preventExtensions(){throw new Error("preventExtensions disabled")}set(t,e,n,r){if(r===this.Xo)throw new Error("Cannot set property");const o=Reflect.getPrototypeOf(r);try{return Reflect.setPrototypeOf(r,Reflect.getPrototypeOf(Object)),r[e]=n,!0}catch(t){throw new Error("Cannot set property")}finally{Reflect.setPrototypeOf(r,o)}}setPrototypeOf(t,e){if(!s())throw new Error("setPrototypeOf disabled");return Reflect.setPrototypeOf(t,e),Reflect.setPrototypeOf(this.$i.Oi.prototype,e),!0}}t.exports=f},function(t,e,n){const Code=n(0);class StandardLock{constructor(t,e){this.address=t,this.testnet=e}script(){if("string"!=typeof this.address)throw new Error("Address is not a string: "+this.address);const t=[],e=[];let n,r,o;const i=this.address;for(let s=0;s<i.length;s++){if(n=0,r="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz".indexOf(i[s]),r<0)throw new Error(`Invalid character in address: ${i}\n\nDetails: i=${s}, c=${i[s]}`);for(r||e.length^s||e.push(0);n in t||r;)o=t[n],o=o?58*o+r:r,r=o>>8,t[n]=o%256,n++}for(;n--;)e.push(t[n]);if(e.length<6)throw new Error("Address too short: "+i);if(0!==e[0]&&111!==e[0])throw new Error("Address may only be a P2PKH type: "+i);if(!0===this.testnet&&0===e[0]||!1===this.testnet&&111===e[0])throw new Error("Invalid network");const s=[118,169,20,...e.slice(1,e.length-4),136,172];return new Uint8Array(s)}domain(){return 108}}StandardLock.sealed=!0,StandardLock.toString();const r=new Code;Code.Ut(r).xt(StandardLock,!0),t.exports=r},function(t,e,n){const r=n(4),{UnimplementedError}=n(12);class o{get network(){throw new UnimplementedError}async broadcast(t){throw new UnimplementedError}async fetch(t){throw new UnimplementedError}async utxos(t){throw new UnimplementedError}async time(t){throw new UnimplementedError}async spends(t,e){throw new UnimplementedError}static[Symbol.hasInstance](t){return("object"==typeof t||"function"==typeof t)&&(!!t&&("string"==typeof t.network&&("function"==typeof t.broadcast&&("function"==typeof t.fetch&&("function"==typeof t.utxos&&("function"==typeof t.time&&"function"==typeof t.spends))))))}}class i{async pay(t,e){throw new UnimplementedError}async broadcast(t){throw new UnimplementedError}static[Symbol.hasInstance](t){return("object"==typeof t||"function"==typeof t)&&(!!t&&"function"==typeof t.pay)}}class s{async sign(t,e,n){throw new UnimplementedError}async owner(){throw new UnimplementedError}static[Symbol.hasInstance](t){return("object"==typeof t||"function"==typeof t)&&(!!t&&("function"==typeof t.sign&&"function"==typeof t.owner))}}class c{info(...t){}debug(...t){}warn(...t){}error(...t){}static[Symbol.hasInstance](t){return("object"==typeof t||"function"==typeof t)&&!!t}}class a{async get(t){throw new UnimplementedError}async set(t,e){throw new UnimplementedError}static[Symbol.hasInstance](t){return("object"==typeof t||"function"==typeof t)&&(!!t&&("function"==typeof t.get&&"function"==typeof t.set))}}class u{script(){throw new UnimplementedError}domain(){throw new UnimplementedError}static[Symbol.hasInstance](t){if("object"!=typeof t||!t)return!1;if("function"!=typeof t.constructor.prototype.script)return!1;if(Object.getOwnPropertyNames(t).includes("script"))return!1;const e=t.script(),n=r.W.Uint8Array;if(!(e instanceof Uint8Array||e instanceof n))return!1;return"function"==typeof t.constructor.prototype.domain&&(!Object.getOwnPropertyNames(t).includes("domain")&&(!!Number.isSafeInteger(t.domain())&&!(t.domain()<0)))}}t.exports={Blockchain:o,Purse:i,Logger:c,Cache:a,Lock:u,Owner:s}},function(t,e,n){const r=n(3),{RequestError,TimeoutError}=n(12);class o{static async wn(t,e=2e3,n={}){return o.Ci(t,"GET",void 0,e,n)}static async Ui(t,e,n=2e3,r={}){return o.Ci(t,"POST",e,n,r)}static async Ci(t,e,n,o,s){r.kt("REST",e,t);let c=null;try{c=await i(t,e,n,o,s)}catch(n){throw n.message+=`\n\n${e} ${t}`,n}const{data:a,status:u,statusText:h}=c;if(u>=200&&u<300)return a;const f=a.message?a.message.message||a.message:a,l=a.name&&f?`${a.name}: ${f}`:a.name||f;throw new RequestError(l,u,h,e,t)}}let i=null;i=async function(t,e,r,o,i){return new Promise((s,c)=>{const a=t.startsWith("http://")?n(43):n(44),u=n(45);i.accept="application/json",i["accept-encoding"]="gzip",r&&(i["content-type"]="application/json");const h={method:e,headers:i,timeout:o};function f(t,e){t.headers["content-type"].includes("application/json")&&e&&(e=JSON.parse(e)),s({data:e,status:t.statusCode,statusText:t.statusMessage})}const l=a.request(t,h,(function(t){let e=Buffer.alloc(0);t.on("data",t=>{e=Buffer.concat([e,t])}),t.on("end",()=>{"gzip"===t.headers["content-encoding"]?u.gunzip(e,(function(e,n){if(e)return c(e);f(t,n.toString())})):f(t,e.toString())})}));r&&l.write(JSON.stringify(r)),l.on("error",t=>c(t)),l.on("timeout",()=>{l.abort(),c(new TimeoutError(`Request timed out after ${o}ms`))}),l.end()})},t.exports=o},function(t,e){function hex(t){if("string"!=typeof t||t.length%2!=0)throw new Error("Bad hex: "+t);t=t.toLowerCase();const e="0123456789abcdef".split(""),n=[];for(let r=0;r<t.length;r+=2){const o=e.indexOf(t[r]),i=e.indexOf(t[r+1]);if(-1===o||-1===i)throw new Error("Bad hex: "+t);n.push(16*o+i)}return n}hex.originMainnet="b6cd82f20242845ebef6867e05fd048c7763edf966cc3f8bc236a9e221843ce0_o2",hex.locationMainnet="b6cd82f20242845ebef6867e05fd048c7763edf966cc3f8bc236a9e221843ce0_o2",hex.ownerMainnet="13B8kvB8i2ka8JUKQYa3B1x33AZx5n7cXw",hex.originTestnet="6d626438e7a4fdbad1855b6656bb1abf74d0e2e500cc46b47ee79083838b429f_o2",hex.locationTestnet="6d626438e7a4fdbad1855b6656bb1abf74d0e2e500cc46b47ee79083838b429f_o2",hex.ownerTestnet="mzHqorB2BvtguytBnC65v325cTH9b6qSgb",t.exports=hex},function(t,e,n){const r=n(7),{Ht:o}=n(1),Code=n(0);class i{constructor(){this.pt=null,this.ir=null,this.dr=null,this.yr=null,this.G=null,this.Ni=[],this.Mn=1/0,this.Yn=null}Lt(){i.Wt!==this&&(i.Wt&&i.Wt.Dt(),i.Wt=this,r.Networks.defaultNetwork=r.Networks[o(this.pt.network)],Code.Lt())}Dt(){i.Wt&&(Code.Dt(),i.Wt=null)}Fi(t,e){this.Ni.push({event:t,listener:e})}gr(t,e){"jig"===t&&e instanceof Code&&Code.Ut(e).$t(),this.Ni.filter(e=>e.event===t).forEach(n=>n.listener(t,e))}}i.Wt=null,t.exports=i},function(t,e){t.exports=class{constructor(){this.tasks=[]}async nr(t){return new Promise((e,n)=>{this.tasks.push({func:t,reject:n,resolve:e}),1===this.tasks.length&&this.Bi()})}async Bi(){const t=this.tasks[0];try{const e=t.func();t.resolve(e instanceof Promise?await e:e)}catch(e){t.reject(e)}finally{this.tasks.shift(),this.tasks.length&&this.Bi()}}}},function(t,e,n){const{Transaction:r}=n(7),{Bn:o}=n(16),{R:i,g:s,h:c,P:a}=n(1),u=n(3),{F:h}=n(10),{B:f}=n(5),{D:l}=n(11),p="Sync";async function y(t,e){const{Xn:c}=n(14);if(!1===e.forward)return;e.Mn=e.Mn||new o("sync");const a=s();let h=f(()=>t.location),y=l(h);for(;void 0===y.vdel;){i(y.txid&&void 0!==y.vout);const o=await a.pt.spends(y.txid,y.vout);if(!o)break;u.kt(p,"Forward syncing to",o);const s=await a.pt.fetch(o),d=new r(s);let g=null;try{g=c(d)}catch(t){u.Ce(p,t);break}const w=n(16),b=!0,_=t;await w(d,g,a,b,_,e.Mn),h=f(()=>t.location),y=l(h)}}async function d(t,e){if(!1===e.inner)return;u.tt(p,"Inner sync");const r=function(t){const Jig=n(2),Code=n(0),e=new Set;return f(()=>{h(t,n=>n===t||(n instanceof Jig||n instanceof Code?(e.add(n),!1):void 0))}),Array.from(e)}(t).map(t=>t.sync(e));await Promise.all(r)}t.exports=async function(t,e={}){const Jig=n(2),Code=n(0);if(i(t instanceof Jig||t instanceof Code),e.Mi=e.Mi||new Set,e.Mi.has(t))return;e.Mi.add(t),t instanceof Code&&f(()=>l(t.location)).undeployed&&Code.Ut(t).Rt(),u.kt(p,"Sync",c(t));let r=!1;try{r=await async function(t,e){const r=n(24);let o=!1;for(;;){const e=f(()=>t.location),{error:n,commitid:s}=l(e);if(a(!n,"Cannot sync\n\n"+n),!s)break;u.tt(p,"Waiting to publish "+c(t)),o=!0;const h=r.wn(s);i(h),await h.Se()}return o}(t)}catch(n){try{await y(t,e),await d(t,e)}catch(t){}throw n}r||await y(t,e),await d(t,e)}},function(t,e,n){const hex=n(30);function asm(t){const e=t.split(" ");let n=[];for(const t of e){if(void 0!==asm.OP_CODES[t]){n.push(asm.OP_CODES[t]);continue}const e=hex(1===t.length?"0"+t:t);if(0!==e[0])if(1===e.length&&e[0]>=1&&e[0]<=16)n.push(e[0]+80);else if(e.length<=75)n=n.concat(e.length).concat(e);else if(e.length<256)n=n.concat(asm.OP_CODES.OP_PUSHDATA1).concat([e.length]).concat(e);else if(e.length<65536){const t=[e.length/256,e.length%256];n=n.concat(asm.OP_CODES.OP_PUSHDATA2).concat(t).concat(e)}else{if(!(e.length<4294967296))throw new Error("Hex data too long");{const t=[e.length/256/256/256,e.length/256/256%256,e.length/256%256,e.length%256];n=n.concat(asm.OP_CODES.OP_PUSHDATA4).concat(t).concat(e)}}else n.push(e[0])}return new Uint8Array(n)}asm.OP_CODES={OP_FALSE:0,OP_0:0,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_TRUE:81,OP_1:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_IF:99,OP_NOTIF:100,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SPLIT:127,OP_NUM2BIN:128,OP_BIN2NUM:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_1ADD:139,OP_1SUB:140,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_NOP1:176,OP_NOP2:177,OP_NOP3:178,OP_NOP4:179,OP_NOP5:180,OP_NOP6:181,OP_NOP7:182,OP_NOP8:183,OP_NOP9:184,OP_NOP10:185,OP_PUBKEYHASH:253,OP_PUBKEY:254,OP_INVALIDOPCODE:255},asm.deps={hex},asm.originMainnet="b6cd82f20242845ebef6867e05fd048c7763edf966cc3f8bc236a9e221843ce0_o1",asm.locationMainnet="b6cd82f20242845ebef6867e05fd048c7763edf966cc3f8bc236a9e221843ce0_o1",asm.ownerMainnet="13B8kvB8i2ka8JUKQYa3B1x33AZx5n7cXw",asm.originTestnet="6d626438e7a4fdbad1855b6656bb1abf74d0e2e500cc46b47ee79083838b429f_o1",asm.locationTestnet="6d626438e7a4fdbad1855b6656bb1abf74d0e2e500cc46b47ee79083838b429f_o1",asm.ownerTestnet="mzHqorB2BvtguytBnC65v325cTH9b6qSgb",t.exports=asm},function(t,e,n){const r=n(7),o=n(36),{$r:i}=n(17),{se:s}=n(1);!function(){if(process&&process.version){if(Number(process.version.match(/^v(\d+\.\d+)/)[1])<10)throw new Error("Run is supported only on Node v10 and above")}if("undefined"!=typeof window){const t=window.navigator.userAgent;if(-1!==t.indexOf("MSIE")||-1!==t.indexOf("Trident"))throw new Error("Run is not supported on Internet Explorer. Please upgrade to Edge.")}}(),global.Jig=o.Jig,global.Berry=o.Berry,s(global,"Token",()=>o.Token),i(r),t.exports=o},function(t,e,n){const r=n(7),{PrivateKey:o,PublicKey:i,Address:s}=r,c=n(31),{Blockchain:a,Logger:u,Purse:h,Cache:f,Lock:l,Owner:p}=n(28),Jig=n(2),Berry=n(25),Code=n(0),y=n(24),d=n(14),g=n(41),StandardLock=n(27),w=n(4),b=n(3),{h:_,se:m}=n(1),{BlockchainServer:P,MatterCloud:O,WhatsOnChain:E,RemoteBlockchain:S}=n(42),v=n(46),A=n(47),I=n(48),x=n(49),j=n(50),T=n(51);class R{constructor(t={}){b.kt("Run","Create"),t=Object.assign({},R.defaults,t),this.logger=t.logger,this.g=new c,this.g.dr=C(t.cache),this.g.pt=function(t,e){const{api:n,apiKey:r,blockchain:o,network:i,timeout:s}=t;if(o instanceof a)return o;const u=c.Wt&&c.Wt.pt;if(void 0===o)switch(i){case"mock":return u instanceof j?u:new j;case"main":case"test":case"stn":return u instanceof S&&u.api===n&&u.apiKey===r&&u.timeout===s&&u.network===i?u:S.create({api:n,apiKey:r,network:i,timeout:s,cache:e,lastBlockchain:u});default:throw new Error("Unsupported network: "+i)}throw new Error("Invalid blockchain: "+_(o))}(t,this.g.dr),this.g.ir=k(t.purse,this.blockchain,t.wallet),this.g.yr=$(t.app),this.g.G=function(t,e,n){if(n){if(!(n instanceof p))throw new Error("wallet does not implement the Owner API");return n}if(t instanceof p)return t;if(void 0===t||"string"==typeof t||t instanceof o)try{return new A({privkey:t,blockchain:e})}catch(t){}if("string"==typeof t||t instanceof i||t instanceof s)try{return new x(t.toString())}catch(t){}if("object"==typeof t)try{return new x(t)}catch(t){}throw new Error("Invalid owner: "+_(t))}(t.owner,this.blockchain,t.wallet),this.g.Mn=void 0===t.importLimit?10:t.importLimit,this.g.Yn=void 0===t.codeWhitelist?null:t.codeWhitelist,this.blockchain instanceof j&&this.purse instanceof I&&t.autofund&&this.blockchain.fund(this.purse.bsvAddress,1e8),this.activate()}get app(){return this.g.yr}get blockchain(){return this.g.pt}get logger(){return b.Re}get owner(){return function(t,e){const n=t=>{const e=`run.owner.${t} is now deprecated.`,n="Please switch to run.inventory."+t;b.$e("Owner",`${e} ${n}`)};"jigs"in t||Object.defineProperty(t,"jigs",{configurable:!0,enumerable:!0,get:()=>{n("jigs");try{return e.jigs}catch(t){return[]}}});"code"in t||Object.defineProperty(t,"code",{configurable:!0,enumerable:!0,get:()=>{n("code");try{return e.code}catch(t){return[]}}});return t}(this.g.G,this.inventory)}get purse(){return this.g.ir}get wallet(){return this.g.ir===this.g.G?this.g.ir:void 0}get cache(){return this.g.dr}set app(t){this.g.yr=$(t)}set logger(t){this.Re=b.Re=function(t){if(t instanceof u)return t;if(void 0===t)return b.ke;if(null===t)return{};throw new Error("Invalid logger: "+_(t))}(t)}set purse(t){this.g.ir=k(t,this.blockchain)}set cache(t){this.g.dr=null,this.g.dr=C(t)}get codeWhitelist(){return this.g.Yn}set codeWhitelist(t){this.g.Yn=t}async load(t,e){this.Di();return new d(this.g).Dn(t,e)}async sync(){return y.xi()}deploy(t){this.Di();const e=this.install(t);return Code.Ut(e).Rt(),e}install(t){const e=Code.Bt(t)||new Code,n=Code.Ut(e);return n.ht||n.q(t),e}transaction(t){const e=new g,n=e.update(t);return e.publish(),n}import(t){return g.import(t)}activate(){return R.instance=this,this.g.Lt(),this}deactivate(){return R.instance=null,this.g.Dt(),this}payload(t){const{Xn:e}=n(14);return e(new r.Transaction(t))}Di(){if(c.Wt!==this.g){throw new Error("This Run instance is not active\n\n"+"Hint: Call run.activate() on this instance first")}}Fi(t,e){this.g.Ni.push({event:t,listener:e})}}function k(t,e,n){if(n){if(!(n instanceof h))throw new Error("wallet does not implement the Purse API");return n}if(t instanceof h)return t;switch(typeof t){case"string":return new I({privkey:t,blockchain:e});case"undefined":return new I({blockchain:e});case"object":if(t instanceof o)return new I({privkey:t,blockchain:e})}throw new Error("Invalid purse: "+_(t))}function $(t){switch(typeof t){case"string":return t;case"undefined":return"";default:throw new Error("Invalid app: "+_(t))}}function C(t){if(t instanceof f)return t;if(void 0===t)return R.instance&&R.instance.cache?R.instance.cache:new v;throw new Error("Invalid cache: "+_(t))}R.instance=null,R.defaults={},R.defaults.app="",R.defaults.network="main",R.defaults.logger=void 0,R.defaults.api=void 0,R.defaults.apiKey=void 0,R.defaults.purse=void 0,R.defaults.owner=void 0,R.defaults.autofund=!0,R.configure=(t,e)=>{if(t.APP&&(R.defaults.app=t.APP),e=e||t.NETWORK||R.defaults.network,R.defaults.network=e,"debug"===t.LOGGER)R.defaults.logger=console;else if(t.LOGGER&&JSON.parse(t.LOGGER)){const t={info:console.info,warn:console.warn,error:console.error};R.defaults.logger=t}else R.defaults.logger={};b.Re=R.defaults.logger;const n=t.PURSE||t["PURSE_"+e.toUpperCase()];void 0!==n&&(R.defaults.purse=n);const r=t.OWNER||t["OWNER_"+e.toUpperCase()];void 0!==r&&(R.defaults.owner=r),void 0!==t.API&&(R.defaults.api=t.API);const o=t.APIKEY||t["APIKEY_"+(R.defaults.api||"").toUpperCase()];void 0!==o&&(R.defaults.apiKey=o)},R.preinstall=t=>Code.Ot(t),R.Berry=Berry,R.Code=Code,R.Jig=Jig,R.StandardLock=StandardLock,R.Transaction=g,R.BlockchainServer=P,R.LocalOwner=A,R.LocalPurse=I,R.MatterCloud=O,R.Mockchain=j,R.PayServer=T,R.RemoteBlockchain=S,R.LocalCache=v,R.Viewer=x,R.WhatsOnChain=E,R.asm=n(34),R.expect=n(52),R.GroupLock=n(53),R.hex=n(30),m(R,"Token",()=>n(54)),R.Fe=n(5).Fe,R.Mr=n(11),R.Li=n(17),R.Gi=n(20),R.ge=n(10),R.Ji=n(26),R.we=n(3),R.Xn=n(14).Xn,R.be=n(22),R._e=n(1),R.Pe=n(8),R.C=n(1).C,R.U=n(1).U,R.Wi=n(29),R.Oe=n(18),R.Hi=n(32),R.zi=n(23),R.B=n(5).B,R.Vi=n(19),R.Ki=n(9),R.ve=n(6),R.api={},R.api.Blockchain=a,R.api.Logger=u,R.api.Purse=h,R.api.Cache=f,R.api.Lock=l,R.api.Owner=p,R.errors=n(12),R.sandbox=w,R.version="0.6.0",R.protocol=n(15).Qn,t.exports=R},function(t,e,n){t.exports=function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"u",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.u)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.u?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){const r=n(1);r.version="0.1.10",r.variant="node",t.exports=r},function(t,e,n){const r=n(2),{makeDeterministic:o,nonDeterministicIntrinsics:i}=n(3);t.exports=class{constructor(){const t=`var m=${o.toString()};m();`;{const e=n(4);this.Compartment=e.runInNewContext(`${t};${r};SES.lockdown();Compartment`)}this.globalOverrides={},i.forEach(t=>{this.globalOverrides[t]=void 0});const e=this.makeNondeterministicCompartment();e.global.c=console,this.globalOverrides.console=e.evaluate("Object.assign(...Object.entries(c).map(([k, f])=>({[k]:(...a)=>f(...a)})))")}makeCompartment(){const t=this.makeNondeterministicCompartment();return Object.assign(t.global,this.globalOverrides),{evaluate:e=>t.evaluate(e),global:new Proxy({},{set:(e,n,r)=>(e[n]=t.global[n]=r,!0),deleteProperty:(e,n)=>(delete e[n],n in this.globalOverrides?t.global[n]=this.globalOverrides[n]:delete t.global[n],!0),defineProperty:(e,n,r)=>(Object.defineProperty(e,n,r),Object.defineProperty(t.global,n,r),!0)})}}makeNondeterministicCompartment(){return new this.Compartment}}},function(t){t.exports=JSON.parse('"!function(t,o){\\"object\\"==typeof exports&&\\"undefined\\"!=typeof module?o(exports):\\"function\\"==typeof define&&define.amd?define([\\"exports\\"],o):o((t=t||self).SES={})}(this,(function(t){\\"use strict\\";function o(t,o){if(!t)throw new TypeError(o)}const{getPrototypeOf:r}=Object;const{getOwnPropertyDescriptor:e,getPrototypeOf:n}=Object;function a(t){return n(t).constructor}const i=[\\"Array\\",\\"ArrayBuffer\\",\\"ArrayBufferPrototype\\",\\"ArrayIteratorPrototype\\",\\"ArrayPrototype\\",\\"AsyncFunction\\",\\"AsyncFunctionPrototype\\",\\"AsyncGenerator\\",\\"AsyncGeneratorFunction\\",\\"AsyncGeneratorPrototype\\",\\"AsyncIteratorPrototype\\",\\"Atomics\\",\\"BigInt\\",\\"BigIntPrototype\\",\\"BigInt64Array\\",\\"BigInt64ArrayPrototype\\",\\"BigUint64Array\\",\\"BigUint64ArrayPrototype\\",\\"Boolean\\",\\"BooleanPrototype\\",\\"DataView\\",\\"DataViewPrototype\\",\\"Date\\",\\"DatePrototype\\",\\"decodeURI\\",\\"decodeURIComponent\\",\\"encodeURI\\",\\"encodeURIComponent\\",\\"Error\\",\\"ErrorPrototype\\",\\"eval\\",\\"EvalError\\",\\"EvalErrorPrototype\\",\\"Float32Array\\",\\"Float32ArrayPrototype\\",\\"Float64Array\\",\\"Float64ArrayPrototype\\",\\"Function\\",\\"FunctionPrototype\\",\\"Generator\\",\\"GeneratorFunction\\",\\"GeneratorPrototype\\",\\"Int8Array\\",\\"Int8ArrayPrototype\\",\\"Int16Array\\",\\"Int16ArrayPrototype\\",\\"Int32Array\\",\\"Int32ArrayPrototype\\",\\"isFinite\\",\\"isNaN\\",\\"IteratorPrototype\\",\\"JSON\\",\\"Map\\",\\"MapIteratorPrototype\\",\\"MapPrototype\\",\\"Math\\",\\"Number\\",\\"NumberPrototype\\",\\"Object\\",\\"ObjectPrototype\\",\\"parseFloat\\",\\"parseInt\\",\\"Promise\\",\\"PromisePrototype\\",\\"Proxy\\",\\"RangeError\\",\\"RangeErrorPrototype\\",\\"ReferenceError\\",\\"ReferenceErrorPrototype\\",\\"Reflect\\",\\"RegExp\\",\\"RegExpPrototype\\",\\"RegExpStringIteratorPrototype\\",\\"Set\\",\\"SetIteratorPrototype\\",\\"SetPrototype\\",\\"SharedArrayBuffer\\",\\"SharedArrayBufferPrototype\\",\\"String\\",\\"StringIteratorPrototype\\",\\"StringPrototype\\",\\"Symbol\\",\\"SymbolPrototype\\",\\"SyntaxError\\",\\"SyntaxErrorPrototype\\",\\"ThrowTypeError\\",\\"TypedArray\\",\\"TypedArrayPrototype\\",\\"TypeError\\",\\"TypeErrorPrototype\\",\\"Uint8Array\\",\\"Uint8ArrayPrototype\\",\\"Uint8ClampedArray\\",\\"Uint8ClampedArrayPrototype\\",\\"Uint16Array\\",\\"Uint16ArrayPrototype\\",\\"Uint32Array\\",\\"Uint32ArrayPrototype\\",\\"URIError\\",\\"URIErrorPrototype\\",\\"WeakMap\\",\\"WeakMapPrototype\\",\\"WeakSet\\",\\"WeakSetPrototype\\",\\"escape\\",\\"unescape\\",\\"FunctionPrototypeConstructor\\",\\"Compartment\\",\\"CompartmentPrototype\\",\\"harden\\"],{getOwnPropertyDescriptor:c}=Object;function p(t,r){const e=c(t,r);return o(!(\\"get\\"in e||\\"set\\"in e),`unexpected accessor on global property: ${r}`),e.value}const{apply:s}=Reflect,y=(t=>(o,...r)=>s(t,o,r))(Object.prototype.hasOwnProperty);function l(){const t={__proto__:null},c=function(){const t=Function.prototype.constructor,o=typeof Symbol&&Symbol.iterator||\\"@@iterator\\",r=typeof Symbol&&Symbol.matchAll||\\"@@matchAll\\",i=e(arguments,\\"callee\\").get,c=(new String)[o](),p=n(c);let s=null,y=null;r in new RegExp&&(s=(new RegExp)[r](),y=n(s));const l=(new Array)[o](),u=n(l),g=n(Float32Array),f=(new Map)[o](),P=n(f),b=(new Set)[o](),m=n(b),d=n(u);function*h(){}const A=a(h),E=A.prototype;async function*S(){}const _=a(S),w=_.prototype,I=w.prototype,F=n(I);async function T(){}const v=a(T),O={FunctionPrototypeConstructor:t,ArrayIteratorPrototype:u,AsyncFunction:v,AsyncGenerator:w,AsyncGeneratorFunction:_,AsyncGeneratorPrototype:I,AsyncIteratorPrototype:F,Generator:E,GeneratorFunction:A,IteratorPrototype:d,MapIteratorPrototype:P,RegExpStringIteratorPrototype:y,SetIteratorPrototype:m,StringIteratorPrototype:p,ThrowTypeError:i,TypedArray:g};return O}();!function(t){const{FunctionPrototypeConstructor:e,ArrayIteratorPrototype:n,AsyncFunction:a,AsyncGenerator:i,AsyncGeneratorFunction:c,AsyncGeneratorPrototype:p,AsyncIteratorPrototype:s,Generator:y,GeneratorFunction:l,IteratorPrototype:u,MapIteratorPrototype:g,RegExpStringIteratorPrototype:f,SetIteratorPrototype:P,StringIteratorPrototype:b,ThrowTypeError:m,TypedArray:d}=t;o(r(m)===Function.prototype,\\"ThrowTypeError.__proto__ should be Function.prototype\\"),o(r(b)===u,\\"StringIteratorPrototype.__proto__ should be IteratorPrototype\\"),f&&o(r(f)===u,\\"RegExpStringIteratorPrototype.__proto__ should be IteratorPrototype\\"),o(r(d)===Function.prototype,\\"TypedArray.__proto__ should be Function.prototype\\"),o(r(g)===u,\\"MapIteratorPrototype.__proto__ should be IteratorPrototype\\"),o(r(P)===u,\\"SetIteratorPrototype.__proto__ should be IteratorPrototype\\"),o(r(u)===Object.prototype,\\"IteratorPrototype.__proto__ should be Object.prototype\\"),o(r(s)===Object.prototype,\\"AsyncIteratorPrototype.__proto__ should be Object.prototype\\"),o(r(n)===u,\\"AsyncIteratorPrototype.__proto__ should be IteratorPrototype\\"),o(r(l)===e,\\"GeneratorFunction.__proto__ should be Function\\"),o(\\"GeneratorFunction\\"===l.name,\'GeneratorFunction.name should be \\"GeneratorFunction\\"\'),o(r(y)===Function.prototype,\\"Generator.__proto__ should be Function.prototype\\"),o(r(c)===e,\\"AsyncGeneratorFunction.__proto__ should be Function\\"),o(\\"AsyncGeneratorFunction\\"===c.name,\'AsyncGeneratorFunction.name should be \\"AsyncGeneratorFunction\\"\'),o(r(i)===Function.prototype,\\"AsyncGenerator.__proto__ should be Function.prototype\\"),o(r(p)===s,\\"AsyncGeneratorPrototype.__proto__ should be AsyncIteratorPrototype\\"),o(r(a)===e,\\"AsyncFunction.__proto__ should be Function\\"),o(\\"AsyncFunction\\"===a.name,\'AsyncFunction.name should be \\"AsyncFunction\\"\')}(c);for(const o of i){if(y(c,o)){t[o]=c[o];continue}if(y(globalThis,o)){t[o]=p(globalThis,o);continue}if(o.endsWith(\\"Prototype\\")){const r=o.slice(0,-\\"Prototype\\".length);if(y(c,r)){const e=c[r];t[o]=e.prototype;continue}if(y(globalThis,r)){const e=p(globalThis,r);t[o]=e.prototype;continue}}}return function(t){Object.keys(t).forEach(o=>{if(void 0===t[o])throw new TypeError(`Malformed intrinsic: ${o}`)})}(t),t}const u={\\"**proto**\\":\\"FunctionPrototype\\",length:\\"number\\",name:\\"string\\"},g=u,f={get:g,set:\\"undefined\\"};function P(t){return{\\"**proto**\\":\\"Error\\",prototype:t,length:\\"number\\",name:\\"string\\"}}function b(t){return{\\"**proto**\\":\\"ErrorPrototype\\",constructor:t,message:\\"string\\",name:\\"string\\",toString:g}}function m(t){return{\\"**proto**\\":\\"TypedArray\\",length:\\"number\\",name:\\"string\\",BYTES_PER_ELEMENT:\\"number\\",prototype:t}}function d(t){return{\\"**proto**\\":\\"TypedArrayPrototype\\",BYTES_PER_ELEMENT:\\"number\\",constructor:t}}var h=function(t){return(typeof Symbol&&Symbol.matchAll||\\"@@matchAll\\")in new RegExp||delete t.RegExpStringIteratorPrototype,t}({\\"**proto**\\":null,ThrowTypeError:g,Infinity:\\"number\\",NaN:\\"number\\",undefined:\\"undefined\\",eval:g,isFinite:g,isNaN:g,parseFloat:g,parseInt:g,decodeURI:g,decodeURIComponent:g,encodeURI:g,encodeURIComponent:g,Object:{\\"**proto**\\":\\"FunctionPrototype\\",assign:g,create:g,defineProperties:g,defineProperty:g,entries:g,freeze:g,fromEntries:g,getOwnPropertyDescriptor:g,getOwnPropertyDescriptors:g,getOwnPropertyNames:g,getOwnPropertySymbols:g,getPrototypeOf:g,is:g,isExtensible:g,isFrozen:g,isSealed:g,keys:g,preventExtensions:g,prototype:\\"ObjectPrototype\\",seal:g,setPrototypeOf:g,values:g},ObjectPrototype:{\\"**proto**\\":null,constructor:\\"Object\\",hasOwnProperty:g,isPrototypeOf:g,propertyIsEnumerable:g,toLocaleString:g,toString:g,valueOf:g,__defineGetter__:g,__defineSetter__:g,__lookupGetter__:g,__lookupSetter__:g},Function:{\\"**proto**\\":\\"FunctionPrototype\\",length:\\"number\\",prototype:\\"FunctionPrototype\\"},FunctionPrototype:{length:\\"number\\",name:\\"string\\",apply:g,bind:g,call:g,constructor:\\"FunctionPrototypeConstructor\\",toString:g,\\"@@hasInstance\\":g},Boolean:{\\"**proto**\\":\\"FunctionPrototype\\",prototype:\\"BooleanPrototype\\"},BooleanPrototype:{constructor:\\"Boolean\\",toString:g,valueOf:g},Symbol:{\\"**proto**\\":\\"FunctionPrototype\\",asyncIterator:\\"symbol\\",for:g,hasInstance:\\"symbol\\",isConcatSpreadable:\\"symbol\\",iterator:\\"symbol\\",keyFor:g,match:\\"symbol\\",matchAll:\\"symbol\\",prototype:\\"SymbolPrototype\\",replace:\\"symbol\\",search:\\"symbol\\",species:\\"symbol\\",split:\\"symbol\\",toPrimitive:\\"symbol\\",toStringTag:\\"symbol\\",unscopables:\\"symbol\\"},SymbolPrototype:{constructor:\\"Symbol\\",description:f,toString:g,valueOf:g,\\"@@toPrimitive\\":g,\\"@@toStringTag\\":\\"string\\"},Error:{\\"**proto**\\":\\"FunctionPrototype\\",prototype:\\"ErrorPrototype\\",captureStackTrace:g,stackTraceLimit:\\"number\\"},ErrorPrototype:{constructor:\\"Error\\",message:\\"string\\",name:\\"string\\",toString:g},EvalError:P(\\"EvalErrorPrototype\\"),RangeError:P(\\"RangeErrorPrototype\\"),ReferenceError:P(\\"ReferenceErrorPrototype\\"),SyntaxError:P(\\"SyntaxErrorPrototype\\"),TypeError:P(\\"TypeErrorPrototype\\"),URIError:P(\\"URIErrorPrototype\\"),EvalErrorPrototype:b(\\"EvalError\\"),RangeErrorPrototype:b(\\"RangeError\\"),ReferenceErrorPrototype:b(\\"ReferenceError\\"),SyntaxErrorPrototype:b(\\"SyntaxError\\"),TypeErrorPrototype:b(\\"TypeError\\"),URIErrorPrototype:b(\\"URIError\\"),Number:{\\"**proto**\\":\\"FunctionPrototype\\",EPSILON:\\"number\\",isFinite:g,isInteger:g,isNaN:g,isSafeInteger:g,MAX_SAFE_INTEGER:\\"number\\",MAX_VALUE:\\"number\\",MIN_SAFE_INTEGER:\\"number\\",MIN_VALUE:\\"number\\",NaN:\\"number\\",NEGATIVE_INFINITY:\\"number\\",parseFloat:g,parseInt:g,POSITIVE_INFINITY:\\"number\\",prototype:\\"NumberPrototype\\"},NumberPrototype:{constructor:\\"Number\\",toExponential:g,toFixed:g,toLocaleString:g,toPrecision:g,toString:g,valueOf:g},BigInt:{\\"**proto**\\":\\"FunctionPrototype\\",asIntN:g,asUintN:g,prototype:\\"BigIntPrototype\\"},BigIntPrototype:{constructor:\\"BigInt\\",toLocaleString:g,toString:g,valueOf:g,\\"@@toStringTag\\":\\"string\\"},Math:{E:\\"number\\",LN10:\\"number\\",LN2:\\"number\\",LOG10E:\\"number\\",LOG2E:\\"number\\",PI:\\"number\\",SQRT1_2:\\"number\\",SQRT2:\\"number\\",\\"@@toStringTag\\":\\"string\\",abs:g,acos:g,acosh:g,asin:g,asinh:g,atan:g,atanh:g,atan2:g,cbrt:g,ceil:g,clz32:g,cos:g,cosh:g,exp:g,expm1:g,floor:g,fround:g,hypot:g,imul:g,log:g,log1p:g,log10:g,log2:g,max:g,min:g,pow:g,random:g,round:g,sign:g,sin:g,sinh:g,sqrt:g,tan:g,tanh:g,trunc:g},Date:{\\"**proto**\\":\\"FunctionPrototype\\",now:g,parse:g,prototype:\\"DatePrototype\\",UTC:g},DatePrototype:{constructor:\\"Date\\",getDate:g,getDay:g,getFullYear:g,getHours:g,getMilliseconds:g,getMinutes:g,getMonth:g,getSeconds:g,getTime:g,getTimezoneOffset:g,getUTCDate:g,getUTCDay:g,getUTCFullYear:g,getUTCHours:g,getUTCMilliseconds:g,getUTCMinutes:g,getUTCMonth:g,getUTCSeconds:g,setDate:g,setFullYear:g,setHours:g,setMilliseconds:g,setMinutes:g,setMonth:g,setSeconds:g,setTime:g,setUTCDate:g,setUTCFullYear:g,setUTCHours:g,setUTCMilliseconds:g,setUTCMinutes:g,setUTCMonth:g,setUTCSeconds:g,toDateString:g,toISOString:g,toJSON:g,toLocaleDateString:g,toLocaleString:g,toLocaleTimeString:g,toString:g,toTimeString:g,toUTCString:g,valueOf:g,\\"@@toPrimitive\\":g,getYear:g,setYear:g,toGMTString:g},String:{\\"**proto**\\":\\"FunctionPrototype\\",fromCharCode:g,fromCodePoint:g,prototype:\\"StringPrototype\\",raw:g},StringPrototype:{length:\\"number\\",charAt:g,charCodeAt:g,codePointAt:g,concat:g,constructor:\\"String\\",endsWith:g,includes:g,indexOf:g,lastIndexOf:g,localeCompare:g,match:g,matchAll:g,normalize:g,padEnd:g,padStart:g,repeat:g,replace:g,search:g,slice:g,split:g,startsWith:g,substring:g,toLocaleLowerCase:g,toLocaleUpperCase:g,toLowerCase:g,toString:g,toUpperCase:g,trim:g,trimEnd:g,trimStart:g,valueOf:g,\\"@@iterator\\":g,substr:g,anchor:g,big:g,blink:g,bold:g,fixed:g,fontcolor:g,fontsize:g,italics:g,link:g,small:g,strike:g,sub:g,sup:g,trimLeft:g,trimRight:g},StringIteratorPrototype:{\\"**proto**\\":\\"IteratorPrototype\\",next:g,\\"@@toStringTag\\":\\"string\\"},RegExp:{\\"**proto**\\":\\"FunctionPrototype\\",prototype:\\"RegExpPrototype\\",\\"@@species\\":f},RegExpPrototype:{constructor:\\"RegExp\\",exec:g,dotAll:f,flags:f,global:f,ignoreCase:f,\\"@@match\\":g,\\"@@matchAll\\":g,multiline:f,\\"@@replace\\":g,\\"@@search\\":g,source:f,\\"@@split\\":g,sticky:f,test:g,toString:g,unicode:f,compile:!1},RegExpStringIteratorPrototype:{\\"**proto**\\":\\"IteratorPrototype\\",next:g,\\"@@toStringTag\\":\\"string\\"},Array:{\\"**proto**\\":\\"FunctionPrototype\\",from:g,isArray:g,of:g,prototype:\\"ArrayPrototype\\",\\"@@species\\":f},ArrayPrototype:{length:\\"number\\",concat:g,constructor:\\"Array\\",copyWithin:g,entries:g,every:g,fill:g,filter:g,find:g,findIndex:g,flat:g,flatMap:g,forEach:g,includes:g,indexOf:g,join:g,keys:g,lastIndexOf:g,map:g,pop:g,push:g,reduce:g,reduceRight:g,reverse:g,shift:g,slice:g,some:g,sort:g,splice:g,toLocaleString:g,toString:g,unshift:g,values:g,\\"@@iterator\\":g,\\"@@unscopables\\":{\\"**proto**\\":null,copyWithin:\\"boolean\\",entries:\\"boolean\\",fill:\\"boolean\\",find:\\"boolean\\",findIndex:\\"boolean\\",flat:\\"boolean\\",flatMap:\\"boolean\\",includes:\\"boolean\\",keys:\\"boolean\\",values:\\"boolean\\"}},ArrayIteratorPrototype:{\\"**proto**\\":\\"IteratorPrototype\\",next:g,\\"@@toStringTag\\":\\"string\\"},TypedArray:{\\"**proto**\\":\\"FunctionPrototype\\",from:g,of:g,prototype:\\"TypedArrayPrototype\\",\\"@@species\\":f},TypedArrayPrototype:{buffer:f,byteLength:f,byteOffset:f,constructor:\\"TypedArray\\",copyWithin:g,entries:g,every:g,fill:g,filter:g,find:g,findIndex:g,forEach:g,includes:g,indexOf:g,join:g,keys:g,lastIndexOf:g,length:f,map:g,reduce:g,reduceRight:g,reverse:g,set:g,slice:g,some:g,sort:g,subarray:g,toLocaleString:g,toString:g,values:g,\\"@@iterator\\":g,\\"@@toStringTag\\":f},BigInt64Array:m(\\"BigInt64ArrayPrototype\\"),BigUint64Array:m(\\"BigUint64ArrayPrototype\\"),Float32Array:m(\\"Float32ArrayPrototype\\"),Float64Array:m(\\"Float64ArrayPrototype\\"),Int16Array:m(\\"Int16ArrayPrototype\\"),Int32Array:m(\\"Int32ArrayPrototype\\"),Int8Array:m(\\"Int8ArrayPrototype\\"),Uint16Array:m(\\"Uint16ArrayPrototype\\"),Uint32Array:m(\\"Uint32ArrayPrototype\\"),Uint8Array:m(\\"Uint8ArrayPrototype\\"),Uint8ClampedArray:m(\\"Uint8ClampedArrayPrototype\\"),BigInt64ArrayPrototype:d(\\"BigInt64Array\\"),BigUint64ArrayPrototype:d(\\"BigUint64Array\\"),Float32ArrayPrototype:d(\\"Float32Array\\"),Float64ArrayPrototype:d(\\"Float64Array\\"),Int16ArrayPrototype:d(\\"Int16Array\\"),Int32ArrayPrototype:d(\\"Int32Array\\"),Int8ArrayPrototype:d(\\"Int8Array\\"),Uint16ArrayPrototype:d(\\"Uint16Array\\"),Uint32ArrayPrototype:d(\\"Uint32Array\\"),Uint8ArrayPrototype:d(\\"Uint8Array\\"),Uint8ClampedArrayPrototype:d(\\"Uint8ClampedArray\\"),Map:{\\"**proto**\\":\\"FunctionPrototype\\",\\"@@species\\":f,prototype:\\"MapPrototype\\"},MapPrototype:{clear:g,constructor:\\"Map\\",delete:g,entries:g,forEach:g,get:g,has:g,keys:g,set:g,size:f,values:g,\\"@@iterator\\":g,\\"@@toStringTag\\":\\"string\\"},MapIteratorPrototype:{\\"**proto**\\":\\"IteratorPrototype\\",next:g,\\"@@toStringTag\\":\\"string\\"},Set:{\\"**proto**\\":\\"FunctionPrototype\\",prototype:\\"SetPrototype\\",\\"@@species\\":f},SetPrototype:{add:g,clear:g,constructor:\\"Set\\",delete:g,entries:g,forEach:g,has:g,keys:g,size:f,values:g,\\"@@iterator\\":g,\\"@@toStringTag\\":\\"string\\"},SetIteratorPrototype:{\\"**proto**\\":\\"IteratorPrototype\\",next:g,\\"@@toStringTag\\":\\"string\\"},WeakMap:{\\"**proto**\\":\\"FunctionPrototype\\",prototype:\\"WeakMapPrototype\\"},WeakMapPrototype:{constructor:\\"WeakMap\\",delete:g,get:g,has:g,set:g,\\"@@toStringTag\\":\\"string\\"},WeakSet:{\\"**proto**\\":\\"FunctionPrototype\\",prototype:\\"WeakSetPrototype\\"},WeakSetPrototype:{add:g,constructor:\\"WeakSet\\",delete:g,has:g,\\"@@toStringTag\\":\\"string\\"},ArrayBuffer:{\\"**proto**\\":\\"FunctionPrototype\\",isView:g,prototype:\\"ArrayBufferPrototype\\",\\"@@species\\":f},ArrayBufferPrototype:{byteLength:f,constructor:\\"ArrayBuffer\\",slice:g,\\"@@toStringTag\\":\\"string\\"},SharedArrayBuffer:!1,DataView:{\\"**proto**\\":\\"FunctionPrototype\\",prototype:\\"DataViewPrototype\\"},DataViewPrototype:{buffer:f,byteLength:f,byteOffset:f,constructor:\\"DataView\\",getBigInt64:g,getBigUint64:g,getFloat32:g,getFloat64:g,getInt8:g,getInt16:g,getInt32:g,getUint8:g,getUint16:g,getUint32:g,setBigInt64:g,setBigUint64:g,setFloat32:g,setFloat64:g,setInt8:g,setInt16:g,setInt32:g,setUint8:g,setUint16:g,setUint32:g,\\"@@toStringTag\\":\\"string\\"},Atomics:!1,JSON:{parse:g,stringify:g,\\"@@toStringTag\\":\\"string\\"},IteratorPrototype:{\\"@@iterator\\":g},AsyncIteratorPrototype:{\\"@@asyncIterator\\":g},GeneratorFunction:{\\"**proto**\\":\\"FunctionPrototypeConstructor\\",name:\\"string\\",length:\\"number\\",prototype:\\"Generator\\"},Generator:{\\"**proto**\\":\\"FunctionPrototype\\",constructor:\\"GeneratorFunction\\",prototype:\\"GeneratorPrototype\\"},AsyncGeneratorFunction:{\\"**proto**\\":\\"FunctionPrototypeConstructor\\",name:\\"string\\",length:\\"number\\",prototype:\\"AsyncGenerator\\"},AsyncGenerator:{\\"**proto**\\":\\"FunctionPrototype\\",constructor:\\"AsyncGeneratorFunction\\",prototype:\\"AsyncGeneratorPrototype\\",\\"@@toStringTag\\":\\"string\\"},GeneratorPrototype:{\\"**proto**\\":\\"IteratorPrototype\\",constructor:\\"Generator\\",next:g,return:g,throw:g,\\"@@toStringTag\\":\\"string\\"},AsyncGeneratorPrototype:{\\"**proto**\\":\\"AsyncIteratorPrototype\\",constructor:\\"AsyncGenerator\\",next:g,return:g,throw:g,\\"@@toStringTag\\":\\"string\\"},Promise:{\\"**proto**\\":\\"FunctionPrototype\\",all:g,allSettled:g,prototype:\\"PromisePrototype\\",race:g,reject:g,resolve:g,\\"@@species\\":f},PromisePrototype:{catch:g,constructor:\\"Promise\\",finally:g,then:g,\\"@@toStringTag\\":\\"string\\"},AsyncFunction:{\\"**proto**\\":\\"FunctionPrototypeConstructor\\",name:\\"string\\",length:\\"number\\",prototype:\\"AsyncFunctionPrototype\\"},AsyncFunctionPrototype:{\\"**proto**\\":\\"FunctionPrototype\\",constructor:\\"AsyncFunction\\",\\"@@toStringTag\\":\\"string\\"},Reflect:{apply:g,construct:g,defineProperty:g,deleteProperty:g,get:g,getOwnPropertyDescriptor:g,getPrototypeOf:g,has:g,isExtensible:g,ownKeys:g,preventExtensions:g,set:g,setPrototypeOf:g},Proxy:{\\"**proto**\\":\\"FunctionPrototype\\",revocable:g},escape:g,unescape:g,FunctionPrototypeConstructor:{\\"**proto**\\":\\"FunctionPrototype\\",length:\\"number\\",prototype:\\"FunctionPrototype\\"},Compartment:{\\"**proto**\\":\\"FunctionPrototype\\",prototype:\\"CompartmentPrototype\\"},CompartmentPrototype:{constructor:\\"Compartment\\",evaluate:g,global:f},harden:g});const{getPrototypeOf:A,getOwnPropertyDescriptor:E}=Object,{apply:S,ownKeys:_}=Reflect,w=(t=>(o,...r)=>S(t,o,r))(Object.prototype.hasOwnProperty);function I(t,o){if(\\"string\\"==typeof o)return o;if(\\"symbol\\"==typeof o)return`@@${o.toString().slice(14,-1)}`;throw new TypeError(`Unexpected property name type ${t} ${o}`)}function F(t){const o=[\\"undefined\\",\\"boolean\\",\\"number\\",\\"string\\",\\"symbol\\"];function r(r,e,n,i){if(\\"object\\"==typeof i)return a(r,e,i),!0;if(!1===i)return!1;if(\\"string\\"==typeof i)if(\\"prototype\\"===n||\\"constructor\\"===n){if(w(t,i))return e===t[i]}else if(o.includes(i))return typeof e===i;throw new TypeError(`Unexpected whitelist permit ${r}`)}function e(t,o,e,n){const a=E(o,e);return w(a,\\"value\\")?r(t,a.value,e,n):r(`${t}<get>`,a.get,e,n.get)&&r(`${t}<set>`,a.set,e,n.set)}function n(t,o){return w(t,o)?t[o]:\\"FunctionPrototype\\"===t[\\"**proto**\\"]&&w(u,o)?u[o]:void 0}function a(o,r,a){!function(o,r,e){const n=A(r);if(null!==n||null!==e){if(void 0!==e&&\\"string\\"!=typeof e)throw new TypeError(`Malformed whitelist permit ${o}.__proto__`);if(n!==t[e||\\"ObjectPrototype\\"])throw new Error(`Unexpected intrinsic ${o}.__proto__`)}}(o,r,a[\\"**proto**\\"]);for(const t of _(r)){if(\\"__proto__\\"===t)continue;const i=I(o,t),c=`${o}.${i}`,p=n(a,i);if(!p||!e(c,r,t,p))try{delete r[t]}catch(t){}}}a(\\"intrinsics\\",t,h)}const{defineProperties:T,getOwnPropertyDescriptors:v}=Object;const{getOwnPropertyDescriptor:O}=Object;const{defineProperties:U,getOwnPropertyDescriptors:x,getOwnPropertyDescriptor:R}=Object;const C=!0;var M={ObjectPrototype:\\"*\\",ArrayPrototype:\\"*\\",FunctionPrototype:{constructor:C,bind:C,name:C,toString:C},ErrorPrototype:{constructor:C,message:C,name:C},PromisePrototype:{constructor:C},TypedArrayPrototype:\\"*\\",Generator:{constructor:C,name:C,toString:C},IteratorPrototype:\\"*\\"};const{defineProperties:j,getOwnPropertyNames:G,getOwnPropertyDescriptor:k,getOwnPropertyDescriptors:N}=Object,{ownKeys:$}=Reflect;function D(t){return null!==t&&\\"object\\"==typeof t}const{assign:B,freeze:L,defineProperties:W,getOwnPropertyDescriptor:V,getOwnPropertyNames:z,getPrototypeOf:Y,setPrototypeOf:J,prototype:H}=Object,{apply:K,get:Q,set:X}=Reflect,{isArray:q,prototype:Z}=Array,{revocable:tt}=Proxy,{prototype:ot}=RegExp,{prototype:rt}=String,{prototype:et}=WeakMap,nt=t=>(o,...r)=>K(t,o,r),at=nt(H.hasOwnProperty),it=(nt(Z.filter),nt(Z.join)),ct=(nt(Z.push),nt(Z.pop)),pt=nt(Z.includes),st=nt(ot.test),yt=(nt(rt.match),nt(rt.search)),lt=nt(rt.slice),ut=nt(rt.split),gt=(nt(et.get),nt(et.set),nt(et.has),t=>Q(Y(t),\\"constructor\\")),ft=L({__proto__:null});function Pt(t,o){const r=`please report internal shim error: ${t}`;throw console.error(r),o&&(console.error(`${o}`),console.error(`${o.stack}`)),TypeError(r)}function bt(t,o){t||Pt(o)}const mt=[\\"await\\",\\"break\\",\\"case\\",\\"catch\\",\\"class\\",\\"const\\",\\"continue\\",\\"debugger\\",\\"default\\",\\"delete\\",\\"do\\",\\"else\\",\\"export\\",\\"extends\\",\\"finally\\",\\"for\\",\\"function\\",\\"if\\",\\"import\\",\\"in\\",\\"instanceof\\",\\"new\\",\\"return\\",\\"super\\",\\"switch\\",\\"this\\",\\"throw\\",\\"try\\",\\"typeof\\",\\"var\\",\\"void\\",\\"while\\",\\"with\\",\\"yield\\",\\"let\\",\\"static\\",\\"enum\\",\\"implements\\",\\"package\\",\\"protected\\",\\"interface\\",\\"private\\",\\"public\\",\\"await\\",\\"null\\",\\"true\\",\\"false\\",\\"this\\",\\"arguments\\"],dt=new RegExp(\\"^[a-zA-Z_$][\\\\\\\\w$]*$\\");function ht(t){return\\"eval\\"!==t&&!pt(mt,t)&&st(dt,t)}function At(t,o){const r=V(t,o);return(!1===r.configurable&&!1===r.writable&&at(r,\\"value\\"))}const Et=new Proxy(ft,{get(t,o){Pt(`unexpected scope handler trap called: ${String(o)}`)}});function St(t,o){const r=yt(t,o);return r<0?-1:ut(lt(t,0,r),\\"\\\\n\\").length}const _t=new RegExp(\\"(?:\\\\x3c!--|--\\\\x3e)\\");const wt=new RegExp(\\"\\\\\\\\bimport\\\\\\\\s*(?:\\\\\\\\(|/[/*])\\");const It=new RegExp(\\"\\\\\\\\beval\\\\\\\\s*(?:\\\\\\\\(|/[/*])\\");const Ft={rewrite:t=>(function(t){const o=St(t,_t);if(o<0)return t;throw new SyntaxError(`possible html comment syntax rejected around line ${o}`)}(t.src),function(t){const o=St(t,wt);if(o<0)return t;throw new SyntaxError(`possible import expression rejected around line ${o}`)}(t.src),function(t){const o=St(t,It);if(o<0)return t;throw new SyntaxError(`possible direct eval expression rejected around line ${o}`)}(t.src),t)};function Tt(t,o=[]){const r=function(t){return 0===t.length?\\"\\":`const {${it(t,\\",\\")}} = this;`}(o);return t.intrinsics.Function(`\\\\n    with (this) {\\\\n      ${r}\\\\n      return function() {\\\\n        \'use strict\';\\\\n        return eval(arguments[0]);\\\\n      };\\\\n    }\\\\n  `)}function vt(t,o,r,e={},{localTransforms:n=[],globalTransforms:a=[],sloppyGlobalsMode:i=!1}={}){let c={src:o,endowments:e};c=function(t,o){for(const r of o)\\"function\\"==typeof r.rewrite&&(t=r.rewrite(t));return t}(c,[...n,...a,Ft]);const p=function(t,o,r={},{sloppyGlobalsMode:e=!1}={}){return{__proto__:Et,useUnsafeEvaluator:!1,get(e,n){if(\\"symbol\\"!=typeof n)return\\"eval\\"===n&&!0===this.useUnsafeEvaluator?(this.useUnsafeEvaluator=!1,t.intrinsics.eval):n in r?Q(r,n,o):Q(o,n)},set(t,e,n){if(e in r){return\\"value\\"in V(r,e)?X(r,e,n):X(r,e,n,o)}return X(o,e,n)},has:(t,n)=>!!(e||\\"eval\\"===n||n in r||n in o||n in globalThis),getPrototypeOf:()=>null}}(t,r,c.endowments,{sloppyGlobalsMode:i}),s=tt(ft,p),y=Tt(t,function(t,o={}){const r=z(t),e=z(o),n=e.filter(t=>ht(t)&&At(o,t));return[...r.filter(o=>!e.includes(o)&&ht(o)&&At(t,o)),...n]}(r,c.endowments)),l=K(y,s.proxy,[]);let u;p.useUnsafeEvaluator=!0;try{return K(l,r,[c.src])}catch(t){throw u=t,t}finally{!0===p.useUnsafeEvaluator&&(Pt(\\"handler did not revoke useUnsafeEvaluator\\",u),s.revoke())}}const Ot=(t,o,r={})=>{const e=e=>\\"string\\"!=typeof e?e:vt(t,e,o,{},r);return W(e,{toString:{value:()=>\\"function eval() { [native code] }\\",writable:!1,enumerable:!1,configurable:!0}}),bt(gt(e)!==Function,\\"eval constructor is Function\\"),bt(gt(e)!==t.intrinsics.Function,\\"eval contructions is %Function%\\"),e};function Ut(t,o,r={}){const e=function(e){const n=`${ct(arguments)||\\"\\"}`,a=`${it(arguments,\\",\\")}`;new t.intrinsics.Function(a,n);const i=`(function anonymous(${a}\\\\n) {\\\\n${n}\\\\n})`;return vt(t,i,o,{},r)};return W(e,{prototype:{value:t.intrinsics.Function.prototype,writable:!1,enumerable:!1,configurable:!1},toString:{value:()=>\\"function Function() { [native code] }\\",writable:!1,enumerable:!1,configurable:!0}}),bt(Y(Function)===Function.prototype),bt(Y(e)===Function.prototype),bt(gt(e)!==Function),bt(gt(e)!==t.intrinsics.Function),e}const xt=[\\"eval\\",\\"isFinite\\",\\"isNaN\\",\\"parseFloat\\",\\"parseInt\\",\\"decodeURI\\",\\"decodeURIComponent\\",\\"encodeURI\\",\\"encodeURIComponent\\",\\"Array\\",\\"ArrayBuffer\\",\\"Boolean\\",\\"DataView\\",\\"Date\\",\\"Error\\",\\"EvalError\\",\\"Float32Array\\",\\"Float64Array\\",\\"Function\\",\\"Int8Array\\",\\"Int16Array\\",\\"Int32Array\\",\\"Map\\",\\"Number\\",\\"Object\\",\\"Promise\\",\\"Proxy\\",\\"RangeError\\",\\"ReferenceError\\",\\"RegExp\\",\\"Set\\",\\"String\\",\\"Symbol\\",\\"SyntaxError\\",\\"TypeError\\",\\"Uint8Array\\",\\"Uint8ClampedArray\\",\\"Uint16Array\\",\\"Uint32Array\\",\\"URIError\\",\\"WeakMap\\",\\"WeakSet\\",\\"JSON\\",\\"Math\\",\\"Reflect\\",\\"escape\\",\\"unescape\\",\\"globalThis\\",\\"Compartment\\",\\"harden\\"];const{getOwnPropertyDescriptor:Rt}=Object,Ct=[\\"eval\\",\\"isFinite\\",\\"isNaN\\",\\"parseFloat\\",\\"parseInt\\",\\"decodeURI\\",\\"decodeURIComponent\\",\\"encodeURI\\",\\"encodeURIComponent\\",\\"Array\\",\\"ArrayBuffer\\",\\"Boolean\\",\\"DataView\\",\\"Date\\",\\"Error\\",\\"EvalError\\",\\"Float32Array\\",\\"Float64Array\\",\\"Function\\",\\"Int8Array\\",\\"Int16Array\\",\\"Int32Array\\",\\"Map\\",\\"Number\\",\\"Object\\",\\"Promise\\",\\"Proxy\\",\\"RangeError\\",\\"ReferenceError\\",\\"RegExp\\",\\"Set\\",\\"String\\",\\"Symbol\\",\\"SyntaxError\\",\\"TypeError\\",\\"Uint8Array\\",\\"Uint8ClampedArray\\",\\"Uint16Array\\",\\"Uint32Array\\",\\"URIError\\",\\"WeakMap\\",\\"WeakSet\\",\\"JSON\\",\\"Math\\",\\"Reflect\\",\\"escape\\",\\"unescape\\",\\"globalThis\\",\\"Compartment\\",\\"harden\\"];let Mt;function jt(){if(Mt)return Mt;const t=function(){const t={__proto__:null};for(const o of Ct){const r=Rt(globalThis,o);if(r){if(\\"get\\"in r||\\"set\\"in r)throw new TypeError(`Unexpected accessor on global property: ${o}`);t[o]=r.value}}return t}();return Mt={__proto__:null,intrinsics:t},L(Mt)}const Gt=new WeakMap;class kt{constructor(t,o,r={}){const{transforms:e=[]}=r,n=[...e],a=function(t,{globalTransforms:o}){const r={},e={Infinity:{value:1/0,enumerable:!1},NaN:{value:NaN,enumerable:!1},undefined:{value:void 0,enumerable:!1}};for(const n of xt){if(!at(t.intrinsics,n))continue;let a;switch(n){case\\"eval\\":a=Ot(t,r,{globalTransforms:o});break;case\\"Function\\":a=Ut(t,r,{globalTransforms:o});break;case\\"globalThis\\":a=r;break;default:a=t.intrinsics[n]}e[n]={value:a,configurable:!0,writable:!0,enumerable:!1}}return W(r,e),bt(r.eval!==t.intrinsics.eval,\\"eval on global object\\"),bt(r.Function!==t.intrinsics.Function,\\"Function on global object\\"),r}(jt(),{globalTransforms:n});B(a,t),Gt.set(this,{globalTransforms:n,globalObject:a})}get global(){return Gt.get(this).globalObject}evaluate(t,o={}){if(\\"string\\"!=typeof t)throw new TypeError(\\"first argument of evaluate() must be a string\\");const{endowments:r={},transforms:e=[],sloppyGlobalsMode:n=!1}=o,a=[...e],{globalTransforms:i,globalObject:c}=Gt.get(this);return vt(jt(),t,c,r,{globalTransforms:i,localTransforms:a,sloppyGlobalsMode:n})}toString(){return\\"[object Compartment]\\"}static toString(){return\\"function Compartment() { [shim code] }\\"}}let Nt;function $t(t,o){if(!t)throw new TypeError(o)}\\"object\\"!=typeof globalThis&&(Object.prototype.__defineGetter__(\\"__magic__\\",(function(){return this})),__magic__.globalThis=__magic__,delete Object.prototype.__magic__),t.lockdown=function(t={}){const{noTameDate:o=!1,noTameError:r=!1,noTameMath:e=!1,noTameRegExp:n=!1,registerOnly:a=!1,...i}=t,c=Object.keys(i);$t(0===c.length,`lockdown(): non supported option ${c.join(\\", \\")}`);const p={noTameDate:o,noTameError:r,noTameMath:e,noTameRegExp:n,registerOnly:a};if(Nt)return Object.keys(p).forEach(t=>{$t(p[t]===Nt[t],`lockdown(): cannot re-invoke with different option ${t}`)}),!1;Nt=p,function(){try{(0,Function.prototype.constructor)(\\"return 1\\")}catch(t){return}const{defineProperties:t,getPrototypeOf:o,setPrototypeOf:r}=Object;function e(e,n){let a;try{a=(0,eval)(n)}catch(t){if(t instanceof SyntaxError)return;throw t}const i=o(a),c=function(){throw new TypeError(\\"Not available\\")};t(c,{name:{value:e,writable:!1,enumerable:!1,configurable:!0},toString:{value:()=>`function ${e}() { [native code] }`,writable:!1,enumerable:!1,configurable:!0}}),t(i,{constructor:{value:c}}),t(c,{prototype:{value:i}}),c!==Function.prototype.constructor&&r(c,Function.prototype.constructor)}e(\\"Function\\",\\"(function(){})\\"),e(\\"GeneratorFunction\\",\\"(function*(){})\\"),e(\\"AsyncFunction\\",\\"(async function(){})\\"),e(\\"AsyncGeneratorFunction\\",\\"(async function*(){})\\")}(),o||function(){const t={now:()=>NaN};Date.now=t.now;const o={toLocaleString:()=>NaN};Date.prototype.toLocaleString=o.toLocaleString;const r=Date,e=function(){return void 0===new.target?\\"Invalid Date\\":arguments.length>0?Reflect.construct(r,arguments,new.target):Reflect.construct(r,[NaN],new.target)},n=v(r);T(e,n);const a=v(r.prototype);a.constructor.value=e,T(e.prototype,a),globalThis.Date=e;const i={toLocaleString(){throw new TypeError(\\"Object.prototype.toLocaleString is disabled\\")}};Object.prototype.toLocaleString=i.toLocaleString}(),r||function(){if(delete Error.captureStackTrace,O(Error,\\"captureStackTrace\\"))throw Error(\\"Cannot remove Error.captureStackTrace\\");if(delete Error.stackTraceLimit,O(Error,\\"stackTraceLimit\\"))throw Error(\\"Cannot remove Error.stackTraceLimit\\")}(),e||function(){const t={random(){throw TypeError(\\"Math.random() is disabled\\")}};Math.random=t.random}(),n||function(){delete RegExp.prototype.compile;const t=RegExp,o=function(){return Reflect.construct(t,arguments,new.target)},r=R(t,Symbol.species);U(o,Symbol.species,r);const e=x(t.prototype);e.constructor.value=o,U(o.prototype,e),globalThis.RegExp=o}();const s=function(t,o={}){const{freeze:r,getOwnPropertyDescriptors:e,getPrototypeOf:n}=Object,{ownKeys:a}=Reflect;let{fringeSet:i}=o;if(i){if(\\"function\\"!=typeof i.add||\\"function\\"!=typeof i.has)throw new TypeError(\\"options.fringeSet must have add() and has() methods\\");if(t)for(const o of t)i.add(o)}else i=new WeakSet(t);const c=o&&o.naivePrepareObject,{harden:p}={harden(t){const o=new Set,p=new Map,s=new WeakMap;function y(t,r){if(Object(t)!==t)return;const e=typeof t;if(\\"object\\"!==e&&\\"function\\"!==e)throw new TypeError(`Unexpected typeof: ${e}`);i.has(t)||o.has(t)||(o.add(t),s.set(t,r))}function l(t){c&&c(t),r(t);const o=n(t),i=e(t),l=s.get(t)||\\"unknown\\";null===o||p.has(o)||(p.set(o,l),s.set(o,`${l}.__proto__`)),a(i).forEach(t=>{const o=`${l}.${String(t)}`,r=i[t];\\"value\\"in r?y(r.value,`${o}`):(y(r.get,`${o}(get)`),y(r.set,`${o}(set)`))})}return y(t),o.forEach(l),p.forEach((t,r)=>{if(!o.has(r)&&!i.has(r)){let o;try{o=`prototype ${r} of ${t} is not already in the fringeSet`}catch(e){o=\\"a prototype of something is not already in the fringeset (and .toString failed)\\";try{console.log(o),console.log(\\"the prototype:\\",r),console.log(\\"of something:\\",t)}catch(t){}}throw new TypeError(o)}}),o.forEach(i.add,i),t}};return p}();Object.defineProperties(globalThis,{harden:{value:s,configurable:!0,writable:!0,enumerable:!1},Compartment:{value:kt,configurable:!0,writable:!0,enumerable:!1}});const y=l();F(y),function(){try{(0,Object.prototype.__lookupGetter__)(\\"x\\")}catch(t){return}const{defineProperty:t,defineProperties:o,getOwnPropertyDescriptor:r,getPrototypeOf:e,prototype:n}=Object;function a(t){if(null==t)throw new TypeError(\\"can\'t convert undefined or null to object\\");return Object(t)}function i(t){return\\"symbol\\"==typeof t?t:`${t}`}function c(t,o){if(\\"function\\"!=typeof t)throw TypeError(`invalid ${o} usage`);return t}o(n,{__defineGetter__:{value:function(o,r){const e=a(this);t(e,o,{get:c(r,\\"getter\\"),enumerable:!0,configurable:!0})}},__defineSetter__:{value:function(o,r){const e=a(this);t(e,o,{set:c(r,\\"setter\\"),enumerable:!0,configurable:!0})}},__lookupGetter__:{value:function(t){let o,n=a(this);for(t=i(t);n&&!(o=r(n,t));)n=e(n);return o&&o.get}},__lookupSetter__:{value:function(t){let o,n=a(this);for(t=i(t);n&&!(o=r(n,t));)n=e(n);return o&&o.set}}})}();const u=function(t){const o={};function r(t,r,e,n){if(\\"value\\"in n&&n.configurable){const{value:a}=n;o[t]=a,j(r,{[e]:{get:function(){return a},set:function(o){if(r===this)throw new TypeError(`Cannot assign to read only property \'${e}\' of \'${t}\'`);hasOwnProperty.call(this,e)?this[e]=o:j(this,{[e]:{value:o,writable:!0,enumerable:n.enumerable,configurable:n.configurable}})},enumerable:n.enumerable,configurable:n.configurable}})}}function e(t,o,e){const n=k(o,e);n&&r(t,o,e,n)}function n(t,o){const e=N(o);e&&$(e).forEach(n=>r(t,o,n,e[n]))}return function t(o,r,a){for(const i of G(a)){const c=k(r,i);if(!c||c.get||c.set)continue;const p=`${o}.${i}`,s=a[i];if(!0===s)e(p,r,i);else if(\\"*\\"===s)n(p,c.value);else{if(!D(s))throw new TypeError(`Unexpected override enablement plan ${p}`);t(p,c.value,s)}}}(\\"root\\",t,M),o}(y);return s(y,a),s(u,a),!0},Object.defineProperty(t,\\"__esModule\\",{value:!0})}));\\n"')},function(t,e){t.exports={makeDeterministic:function(){const t=(t,e)=>{if(t===e)return 0;if(void 0===t)return 1;if(void 0===e)return-1;const n=null===t?"null":t.toString(),r=null===e?"null":e.toString();return n<r?-1:n>r?1:0},e=Array.prototype.sort;Array.prototype.sort=function(n=t){const r=new Map;return this.forEach((t,e)=>r.set(t,e)),e.call(this,(t,e)=>{const o=n(t,e);return 0!==o?o:r.get(t)-r.get(e)})},delete String.prototype.localeCompare;const n=Function.prototype.toString;Function.prototype.toString=function(){const t=n.call(this),e=t.match(/^([a-zA-Z0-9_$]+)\s*\(/);return e&&"function"!==e[1]?"function "+t:t}},nonDeterministicIntrinsics:["Date","Math","eval","XMLHttpRequest","FileReader","WebSocket","setTimeout","setInterval"]}},function(t,e){t.exports=n(38)}])},function(t,e){t.exports=require("vm")},function(t,e,n){const r=n(3),{R:o,P:i}=n(1),{B:s}=n(5),c=n(20),{_r:a,br:u,mr:h,Pr:f,Or:l,Er:p,Sr:y,xr:d,jr:g}=n(15),w="Verify";t.exports=async function(t,e,b,_){r.tt(w,"Verify",e.hash);const m=a(t);!function(t,e,r){const Unbound=n(9);function a(t){const e=r.indexOf(t);return o(e>=0),e}const u=(new c).Jo().Wo(a),h=e.cre.map(t=>u.Lo(t));i(t.Ge.length===e.cre.length,"Invalid locks");for(let e=0;e<h.length;e++){const n=new Unbound(h[e]),r=t.Ge[e],o=t.ar.get(r);s(()=>{r.owner=n}),o.sn.owner=n}}(t,b,m),u(t);const P=await h(t),O=f(P),E=l(t,m),S=p(t,O,E,m),v=y(t,S);JSON.stringify(S)!==JSON.stringify(b)&&function(t,e){throw r.Ce(w,"Expected payload:",JSON.stringify(t,0,3)),r.Ce(w,"Actual payload:",JSON.stringify(e,0,3)),new Error("Payload mismatch\n\nHint: See logs")}(b,S);for(let t=0;t<S.in;t++){const n=e.inputs[t],r=v.inputs[t],o=n.prevTxId.toString("hex"),s=r.prevTxId.toString("hex");i(o===s,"Txid mismatch on input "+t),i(n.outputIndex===r.outputIndex,"Vout mismatch on input "+t)}for(let t=1;t<=S.out.length;t++){const n=e.outputs[t],r=v.outputs[t],o=n.script.toString("hex"),s=r.script.toString("hex");i(o===s,"Script mismatch on output "+t),i(n.satoshis===r.satoshis,"Satoshis mismatch on output "+t)}const A=e.hash;d(t,A),await g(t,P,A)}},function(t,e,n){const r=n(3),o=n(20),i=n(4),{P:s,j:c,R:a}=n(1),{StateError}=n(12);t.exports=function(t,e,u){switch(r.tt("Execute","Executing",t,JSON.stringify(e)),t){case"DEPLOY":return function(t,e){const Code=n(0);s(t instanceof Array&&t.length%2==0,"Invalid deploy data");const r=t.length/2,a=[];for(let t=0;t<r;t++)a.push(new Code);const u=(new o).Jo().Wo(t=>{const n=e[t]||a[t-e.length];return s(n,"Invalid local jig reference: "+t),n}).Lo(t);for(let t=0;t<r;t++){const e=u[2*t+0],n=u[2*t+1],[r]=i.Ne(e,n.deps);Object.keys(n).forEach(t=>{c(r,t,n[t])});const o=a[t],s=!1,[h]=Code.Gt(o,r,s);Code.Ut(o).q(h,s)}const h=n(8).nt;a.forEach(t=>h.hn(t)),Code.Ft(...a)}(e,u);case"DESTROY":return function(t,e){const r=(new o).Jo().Wo(t=>e[t]).Lo(t),Code=n(0),Jig=n(2);s(r instanceof Code||r instanceof Jig,"Invalid destroy target"),r.destroy()}(e,u);case"AUTH":return function(t,e){const r=(new o).Jo().Wo(t=>e[t]).Lo(t),Code=n(0),Jig=n(2);s(r instanceof Code||r instanceof Jig,"Invalid auth target"),r.auth()}(e,u);case"UPGRADE":return function(t,e){const Code=n(0),r=(new o).Jo().Wo(t=>e[t]).Lo(t);a(Array.isArray(r)),a(3===r.length),a(r[0]instanceof Code),a("string"==typeof r[1]);const[s,u,h]=r,[f]=i.Ne(u,h.deps);Object.keys(h).forEach(t=>{c(f,t,h[t])});const[l]=Code.Gt(s,f),p=!1;s.upgrade(l,p)}(e,u);case"CALL":return function(t,e){const Code=n(0),Jig=n(2),r=(new o).Jo().Wo(t=>e[t]).Lo(t);a(3===r.length),a(r[0]instanceof Code||r[0]instanceof Jig),a("string"==typeof r[1]),a(Array.isArray(r[2]));const[i,s,c]=r;i[s](...c)}(e,u);case"NEW":return function(t,e){const Code=n(0),r=(new o).Jo().Wo(t=>e[t]).Lo(t);a(2===r.length),a(r[0]instanceof Code),a(Array.isArray(r[1]));const[i,s]=r;new i(...s)}(e,u);default:throw new StateError("Unknown opcode: "+t)}}},function(t,e,n){const r=n(7),o=n(8),i=n(15),s=n(16),c=n(3),{R:a,g:u}=n(1),{Xn:h}=n(14),f="Transaction";class l{constructor(t){this.Ei=new o,this.Ei.Ze=!1,this.tn=null,this.qi=null,t&&this.update(t)}update(t){if(c.kt(f,"Update"),this.qi)throw new Error("Already publishing");const e=o.nt;try{o.nt=this.Ei,o.nt.Qe();const n=t();if(n instanceof Promise)throw new Error("Transaction cannot be async");return o.nt.Xe(),n}catch(t){throw o.nt.it(),t}finally{o.nt=e}}async publish(){if(c.kt(f,"Publish"),this.qi)return this.qi;const t=this.Ei.tn();return t?(this.qi=i(t),this.qi):void 0}rollback(){if(c.kt(f,"Rollback"),this.qi)throw new Error("Already publishing");this.Ei.it()}static async import(t){c.kt(f,"Import");const e=new r.Transaction(t),n=h(e),o=u(),i=await s(e,n,o,!1,null,undefined),a=new l;return a.Ei=i.Ei,a}async export(t={}){if(c.kt(f,"Export"),this.qi)throw new Error("Already publishing");const e=this.Ei.tn();if(!e)return;a(!e.tr.length);const{wr:r,br:o,_r:i,mr:s,Pr:u,Or:h,Er:l,vr:p,Sr:y,Ar:d,Ir:g}=n(15);await r(e),o(e);const w=i(e),b=u(await s(e)),_=h(e,w),m=l(e,b,_,w),P=y(e,m);return(await p.nr(async()=>{const n=t.sign?await d(P,e):P;return t.sign?await g(n,e):n})).toString("hex")}}t.exports=l},function(t,e,n){const{Address:r,Script:o,Transaction:i}=n(7),{Ht:s,h:c}=n(1),{UnimplementedError,RequestError}=n(12),{Ur:a}=n(17),{Cache:u}=n(28),h=n(3),f=n(29),l="RemoteBlockchain";class p{async Yi(t){throw new UnimplementedError}async Zi(t){throw new UnimplementedError}async Qi(t,e){throw new UnimplementedError}constructor(t={}){this.network=w(t.network),this.api=function(t){if("string"==typeof t)return t;throw new Error("Unsupported api: "+t)}(t.api),this.timeout=function(t){switch(typeof t){case"number":if(Number.isNaN(t)||t<0)throw new Error("Invalid timeout: "+t);return t;case"undefined":return 1e4;default:throw new Error("Invalid timeout: "+t)}}(t.timeout),this.cache=function(t){if(t instanceof u)return t;if(void 0===t)return new Map;throw new Error("Unsupported cache: "+t)}(t.cache),this.bsvNetwork=s(this.network),this.Xi=new Map,this.ts=[],this.es=1e4,this.ns(t.lastBlockchain)}async broadcast(t){const e=new i(t),n=e.hash;if(t=e.toString("hex"),h.kt(l,"Broadcast",n),0===e.inputs.length)throw new Error("tx has no inputs");if(0===e.outputs.length)throw new Error("tx has no outputs");if(!0!==e.verify())throw new Error(e.verify());await this.Yi(t);const r=[];if(!await this.cache.get("time://"+n)){const t=this.cache.set("time://"+n,Date.now());t instanceof Promise&&t.catch(t=>{}),r.push(t)}for(const t of e.inputs){const e=`${t.prevTxId.toString("hex")}_o${t.outputIndex}`;r.push(this.cache.set("spend://"+e,n))}r.push(this.cache.set("tx://"+n,t)),await Promise.all(r),this.ts.filter(t=>Date.now()-t.time<this.es),e.time=Date.now(),this.ts.push(e)}async fetch(t){h.kt(l,"Fetch",t);const e=await this.cache.get("tx://"+t);if(e)return e;const{rawtx:n}=await this.rs(t);return n}async utxos(t){if(h.kt(l,"Utxos",t.toString()),"string"==typeof t)try{t=o.fromAddress(t)}catch(e){t=new o(t)}else if(t instanceof r)t=o.fromAddress(t);else if(!(t instanceof o))throw new Error("Invalid script: "+c(t));const e=a(t),n=this.Xi.get(e);if(n)return new Promise((t,e)=>n.push({resolve:t,reject:e}));this.Xi.set(e,[]);try{const n=await this.Qi(e,t.toString("hex"));if(!Array.isArray(n))throw new Error(`Received invalid utxos for ${t}\n\n: Type: ${typeof n}\n\nNetwork: ${this.network}`);const r=this.os(n),o=this.ss(r,t);return this.Xi.get(e).forEach(t=>t.resolve(o)),o}catch(t){throw this.Xi.get(e).forEach(e=>e.reject(t)),t}finally{this.Xi.delete(e)}}async time(t){h.kt(l,"Time",t);const e=await this.cache.get("time://"+t);if(e)return e;const{time:n}=await this.rs(t);return n}async spends(t,e){h.kt(l,"Spends",t,e);const n=await this.cache.get(`spend://${t}_o${e}`);if(n)return n;const{spends:r}=await this.rs(t);return r[e]}async rs(t){const e=this.Xi.get(t);if(e)return new Promise((t,n)=>e.push({resolve:t,reject:n}));this.Xi.set(t,[]);try{const{rawtx:e,time:n,spends:r}=await this.Zi(t),o=[];if(o.push(this.cache.set("tx://"+t,e)),!await this.cache.get("time://"+t)){const e=this.cache.set("time://"+t,Date.now());e instanceof Promise&&e.catch(t=>{}),o.push(e)}r.forEach((e,n)=>{e&&o.push(this.cache.set(`spend://${t}_o${n}`,e))});const s=new i(e);for(const e of s.inputs){const n=`${e.prevTxId.toString("hex")}_o${e.outputIndex}`;o.push(this.cache.set("spend://"+n,t))}await Promise.all(o);const c={rawtx:e,time:n,spends:r};return this.Xi.get(t).forEach(t=>t.resolve(c)),c}catch(e){throw this.Xi.get(t).forEach(t=>t.reject(e)),e}finally{this.Xi.delete(t)}}ns(t){t&&this.network===t.network&&(this.cache=t.cache,this.ts=t.ts)}os(t){const e=new Set;return t.filter(t=>{const n=`${t.txid}_o${t.vout}`;return e.has(n)?(h.$e(l,"Duplicate utxo returned from server:",n),!1):(e.add(n),!0)})}ss(t,e){return this.ts.filter(t=>Date.now()-t.time<this.es),this.ts.forEach(n=>{n.outputs.forEach((r,o)=>{r.script.equals(e)&&!t.some(t=>t.txid===n.hash&&t.vout===o)&&t.push({txid:n.hash,vout:o,script:r.script,satoshis:r.satoshis})})}),this.ts.forEach(e=>{t=t.filter(t=>!e.inputs.some(e=>((t,e)=>t.prevTxId.toString("hex")===e.txid&&t.outputIndex===e.vout)(e,t)))}),t}}class y extends p{constructor(t){if(t.network=w(t.network),"main"!==t.network&&"test"!==t.network)throw new Error("Run Blockchain Server only supports mainnet and testnet");t.api="run",super(t)}async Yi(t){const e=`https://api.run.network/v1/${this.network}/tx`;await f.Ui(e,{rawtx:t},this.timeout)}async Zi(t){const e=`https://api.run.network/v1/${this.network}/tx/${t}`,n=await f.wn(e,this.timeout);return{rawtx:n.hex,time:n.time,spends:n.vout.map(t=>t.spentTxId)}}async Qi(t,e){const n=`https://api.run.network/v1/${this.network}/utxos/${t}`;return await f.wn(n,this.timeout)}}class d extends p{constructor(t){if(t.network=w(t.network),"main"!==t.network)throw new Error("MatterCloud API only supports mainnet");t.api="mattercloud",super(t)}async spends(t,e){throw h.tt(l,"Spends",t,e),new UnimplementedError("MatterCloud API does not support spends")}async Yi(t){const e="https://merchantapi.mattercloud.net/mapi/tx"+this.cs,n=await f.Ui(e,{rawtx:t},this.timeout),r=JSON.parse(n.payload);if("failure"===r.returnResult)throw new Error(r.resultDescription)}async Zi(t){const e=`https://api.mattercloud.net/api/v3/${this.network}/tx/${t}${this.cs}`;try{const t=await f.wn(e,this.timeout);return{rawtx:t.rawtx,time:t.time,spends:[]}}catch(t){throw t instanceof RequestError&&404===t.status?new Error("No such mempool or blockchain transaction"):t}}async Qi(t,e){const n=`https://api.mattercloud.net/api/v3/${this.network}/scripthash/${t}/utxo${this.cs}`;return(await f.wn(n,this.timeout)).map(t=>Object.assign({},t,{script:e}))}get cs(){return this.apiKey?"?api_key="+this.apiKey:""}}class g extends p{constructor(t){if(t.network=w(t.network),"main"!==t.network&&"test"!==t.network&&"stn"!==t.network)throw new Error("WhatsOnChain API only supports mainnet, testnet, and STN");t.api="whatsonchain",super(t)}async spends(t,e){throw h.tt(l,"Spends",t,e),new UnimplementedError("WhatsOnChain API does not support spends")}async Yi(t){const e=`https://api.whatsonchain.com/v1/bsv/${this.network}/tx/raw`;await f.Ui(e,{txhex:t},this.timeout,this.as)}async Zi(t){const e=`https://api.whatsonchain.com/v1/bsv/${this.network}/tx/hash/${t}`,n=`https://api.whatsonchain.com/v1/bsv/${this.network}/tx/${t}/hex`;try{const[t,r]=await Promise.all([f.wn(e,this.timeout,this.as),f.wn(n,this.timeout,this.as)]),{time:o}=t;return{rawtx:r,time:o,spends:[]}}catch(t){throw t instanceof RequestError&&404===t.status?new Error("No such mempool or blockchain transaction"):t}}async Qi(t,e){if("stn"===this.network)return h.$e(l,"Utxos are not available on STN"),[];const n=`https://api.whatsonchain.com/v1/bsv/${this.network}/script/${t}/unspent`;return(await f.wn(n,this.timeout,this.as)).map(t=>({txid:t.tx_hash,vout:t.tx_pos,satoshis:t.value,script:e}))}get as(){return this.apiKey?{"woc-api-key":this.apiKey}:{}}}function w(t){if(void 0===t)return"main";if("main"===t||"test"===t||"stn"===t)return t;throw new Error("Unsupported network: "+t)}p.create=(t={})=>{switch(typeof t.api){case"string":switch(t.api){case"run":return new y(t);case"bitindex":case"mattercloud":return new d(t);case"whatsonchain":return new g(t)}break;case"undefined":return"stn"===t.network?new g(t):new y(t)}throw new Error("Invalid blockchain API: "+t.api)},t.exports={BlockchainServer:y,MatterCloud:d,WhatsOnChain:g,RemoteBlockchain:p}},function(t,e){t.exports=require("http")},function(t,e){t.exports=require("https")},function(t,e){t.exports=require("zlib")},function(t,e,n){const r=n(3),{h:o}=n(1),{mn:i}=n(10),s="LocalCache";class c{constructor(t={}){this.us=new Map,this.hs=0,this.fs=1e3*a(t.maxSizeMB)*1e3}get maxSizeMB(){return this.fs/1e3/1e3}set maxSizeMB(t){this.fs=1e3*a(t)*1e3,this.ls()}async get(t){r.tt(s,"Get",t);const e=this.us.has(t),n=this.us.get(t);if(e)return this.us.delete(t),this.us.set(t,n),n}async set(t,e){r.tt(s,"Set",t,"to",JSON.stringify(e,0,3));const n=this.us.has(t),o=this.us.get(t);if(n&&!i(e,o)){throw new Error(`Attempt to set different values for the same key: ${t}\n\n${"This is an internal Run bug. Please report it to the library developers."}`)}this.us.delete(t),this.us.set(t,e),n||(this.hs+=c.ps(t),this.hs+=c.ps(e),this.ls())}clear(){r.tt(s,"Clear"),this.us.clear(),this.hs=0}ls(){for(;this.hs>this.fs;){const t=this.us.keys().next().value,e=this.us.get(t);this.us.delete(t),this.hs-=c.ps(t),this.hs-=c.ps(e)}}static ps(t){switch(typeof t){case"undefined":throw new Error("Cannot cache undefined");case"boolean":return 5;case"number":if(Number.isFinite(t))return 9;throw new Error("Cannot cache number: "+o(t));case"string":return 2*t.length+1;case"object":{if(!t)return 5;const e=Object.keys(t);let n=1+4*e.length;return e.forEach(e=>{n+=c.ps(e),n+=c.ps(t[e])}),n}case"function":throw new Error("Cannot cache function: "+o(t));case"symbol":throw new Error("Cannot cache symbol: "+o(t))}}}function a(t){if(void 0===t)return 10;if("number"==typeof t&&!Number.isNaN(t)&&t>=0)return t;throw new Error("Invalid maxSizeMB: "+o(t))}t.exports=c},function(t,e,n){const{PrivateKey:r,Script:o,Transaction:i}=n(7),{Ht:s,h:c}=n(1),a=n(3),{Nr:u}=n(17),StandardLock=n(27);t.exports=class{constructor(t={}){if(this.blockchain=t.blockchain,void 0!==t.privkey&&"string"!=typeof t.privkey&&!(t.privkey instanceof r))throw new Error("Invalid private key: "+c(t.privkey));const e=this.blockchain&&s(this.blockchain.network);if(e&&t.privkey&&t.privkey instanceof r&&t.privkey.network.name!==e)throw new Error("Private key network mismatch");try{this.bsvPrivateKey=new r(t.privkey,e)}catch(e){throw new Error(`Invalid private key: ${c(t.privkey)}\n\n${e}`)}if(t.privkey&&this.bsvPrivateKey.toString()!==t.privkey.toString())throw new Error("Invalid private key: "+c(t.privkey));this.bsvPublicKey=this.bsvPrivateKey.publicKey,this.bsvAddress=this.bsvPublicKey.toAddress(),this.privkey=this.bsvPrivateKey.toString(),this.pubkey=this.bsvPublicKey.toString(),this.address=this.bsvAddress.toString()}async sign(t,e,n){const r=new i(t);a.kt("LocalOwner","Sign"),e.forEach((t,e)=>{t&&(r.inputs[e].output=new i.Output({satoshis:t.satoshis,script:new o(t.script)}))});for(let t=0;t<r.inputs.length;t++){const i=n[t]instanceof StandardLock,s=r.inputs[t].output&&r.inputs[t].output.script.isPublicKeyHashOut()&&r.inputs[t].output.script.toAddress().toString()===this.address;if(i||s){const n=u(r,t,e[t].script,e[t].satoshis,this.bsvPrivateKey),i=o.fromASM(`${n} ${this.pubkey}`);r.inputs[t].setScript(i)}if(n[t]&&"GroupLock"===n[t].constructor.name&&n[t].pubkeys.includes(this.pubkey)&&r.inputs[t].script.chunks.length<=n[t].m){const n=u(r,t,e[t].script,e[t].satoshis,this.bsvPrivateKey);let i=null;i=r.inputs[t].script.toBuffer().length?o.fromASM(`${r.inputs[t].script.toASM()} ${n}`):o.fromASM("OP_0 "+n),r.inputs[t].setScript(i)}}return r.toString("hex")}owner(){return this.address}}},function(t,e,n){const r=n(7),{PrivateKey:o,Script:i,Transaction:s}=r,{Ht:c,h:a}=n(1),u=n(3),{Nr:h}=n(17),f="LocalPurse";function l(t){switch(typeof t){case"number":if(!Number.isInteger(t))throw new Error("splits must be an integer: "+t);if(t<=0)throw new Error("splits must be at least 1: "+t);return t;case"undefined":return 10;default:throw new Error("Invalid splits: "+t)}}function p(t){switch(typeof t){case"number":if(!Number.isFinite(t))throw new Error("feePerKb must be finite: "+t);if(t<0)throw new Error("feePerKb must be non-negative: "+t);return t;case"undefined":return 500;default:throw new Error("Invalid feePerKb: "+t)}}function y(t,e){const n=new s(t);if(!n.outputs.length)return!1;if(n.outputs[0].script.chunks.length<6)return!1;const r=n.outputs[0].script.chunks;if("run"!==r[2].buf.toString("utf8"))return!1;const o=r[5].buf.toString("utf8");try{const t=JSON.parse(o);return e>=1&&e<=t.out.length}catch(t){return!1}}t.exports=class{constructor(t={}){this.blockchain=function(t){switch(typeof t){case"undefined":throw new Error("blockchain is required");case"object":if(t&&t.network)return t}throw new Error("Invalid blockchain: "+a(t))}(t.blockchain),this.ys=l(t.splits),this.ds=p(t.feePerKb),this.bsvPrivateKey=new o(t.privkey,c(this.blockchain.network)),this.bsvAddress=this.bsvPrivateKey.toAddress(),this.bsvScript=i.fromAddress(this.bsvAddress),this.privkey=this.bsvPrivateKey.toString(),this.address=this.bsvAddress.toString(),this.script=this.bsvScript.toHex()}get splits(){return this.ys}set splits(t){this.ys=l(t)}get feePerKb(){return this.ds}set feePerKb(t){this.ds=p(t)}async pay(t,e){const n=new s(t);u.kt(f,"Pay"),n.feePerKb(this.feePerKb);const o=this.feePerKb/1e3;e.forEach((t,e)=>{t&&(n.inputs[e].output=new s.Output({satoshis:t.satoshis,script:new i(t.script)}))}),n.inputs.forEach(t=>{t.script.toBuffer().length||t.setScript(r.deps.Buffer.alloc(500))});const c=0===n.outputs.length?546:0,a=n._getInputAmount(),l=n._getOutputAmount();if(a-l-c>=n.toBuffer().length*o){u.tt(f,"Transaction already paid for. Skipping.");const t=Math.ceil((34+n.toBuffer().length)*o);return a-l>546+t&&(n._fee=t,n.change(this.bsvAddress)),n.toString("hex")}let p=await this.blockchain.utxos(this.script);if(p=function(t){for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}(p),!p.length){const t=`Hint: Have you funded the purse address ${this.address}?`;throw new Error("Not enough funds\n\n"+t)}const d=n.inputs.length;let g=n.toBuffer().length*o,w=g+l-a,b=0,_=1;g+=34*o,w+=34*o,w+=546;for(const t of p){if(y(await this.blockchain.fetch(t.txid),t.vout))continue;n.from(t),w-=t.satoshis,b++,g+=149*o,w+=149*o;const e=this.splits-p.length+b-_;for(let t=0;t<e;t++)g+=34*o,w+=34*o,w+=546,_++;if(w<0)break}if(g=Math.ceil(g),w=Math.ceil(w),w>0){throw new Error("Not enough funds\n\n"+`Required ${w} more satoshis`)}const m=-w-546*_,P=Math.ceil(m/_);for(let t=0;t<_;t++)t===_-1?(n._fee=g,n.change(this.bsvAddress)):n.to(this.bsvAddress,P);for(let t=d;t<n.inputs.length;t++){const e=n.inputs[t].output,r=h(n,t,e.script,e.satoshis,this.bsvPrivateKey),o=this.bsvPrivateKey.publicKey.toString(),s=i.fromASM(`${r} ${o}`);n.inputs[t].setScript(s)}const O=n._getInputAmount()-a-(n._getOutputAmount()-l);return u.tt(f,"Paid about",O,"satoshis"),n.toString("hex")}async balance(){return(await this.utxos()).reduce((t,e)=>t+e.satoshis,0)}async utxos(){const t=await this.blockchain.utxos(this.script),e=await Promise.all(t.map(t=>this.blockchain.fetch(t.txid)));return t.filter((t,n)=>!y(e[n],t.vout))}}},function(t,e,n){const{h:r}=n(1),{G:o}=n(11),i=n(7),{Script:s}=i,c=n(3);t.exports=class{constructor(t){this.lock=o(t),this.script=new s(i.deps.Buffer.from(this.lock.script()))}async sign(t,e,n){return c.$e("Viewer","Viewer cannot sign ",r(this.lock)),t}owner(){return this.lock}}},function(t,e,n){const r=n(7),{Address:o,Script:i,Transaction:s}=r,c=n(3),{Ur:a}=n(17),{h:u}=n(1),{sha256:h}=r.crypto.Hash,f="Mockchain";t.exports=class{constructor(){this.network="mock",this.gs=new Map,this.ws=new Map,this.bs=new Map,this._s=new Map,this.ms=new Map,this.Ps=new Map,this.Os=25}async broadcast(t){const e=new s(t),n=e.hash;if(c.kt(f,"Broadcast",n),this.gs.has(n))return void c.$e(f,"Already have transaction",n);if(e.inputs.forEach((t,e)=>{const n=`${t.prevTxId.toString("hex")}_o${t.outputIndex}`,r=this._s.get(n);if(!r){const t=this.bs.get(n),e=this.Ps.has(t);throw new Error(e?"txn-mempool-conflict":"Missing inputs")}t.output=new s.Output(r)}),0===e.inputs.length)throw new Error("tx has no inputs");if(0===e.outputs.length)throw new Error("tx has no outputs");if(e.getFee()<e.toBuffer().length*s.FEE_PER_KB/1e3)throw new Error("insufficient priority");if(!0!==e.verify())throw new Error(e.verify());if(!0!==e.isFullySigned())throw new Error("mandatory-script-verify-flag-failed");for(let t=0;t<e.inputs.length;t++)if(!e.isValidSignature({inputIndex:t}))throw new Error("mandatory-script-verify-flag-failed: _i"+t);const o=e.inputs.map(t=>t.prevTxId.toString("hex")).map(t=>this.Ps.get(t)+1).reduce((t,e)=>Math.max(t,e),0);if(o>this.Os){throw new Error("too-long-mempool-chain\n\n"+"Hint: Use run.blockchain.block() to produce blocks on the mockchain.")}this.gs.set(n,t),this.ws.set(n,Date.now()),this.Ps.set(n,o),e.inputs.forEach((t,e)=>{const o=t.prevTxId.toString("hex"),i=`${o}_o${t.outputIndex}`,s=this.gs.get(o),c=new r.Transaction(s).outputs[t.outputIndex],a=h(c.script.toBuffer()).reverse().toString("hex");this._s.delete(i),this.ms.get(a).delete(i),this.bs.set(i,n)}),e.outputs.forEach((t,e)=>{const r=`${n}_o${e}`;this.bs.set(r,null);const o={txid:n,vout:e,script:t.script.toHex(),satoshis:t.satoshis};this._s.set(r,o);const i=h(t.script.toBuffer()).reverse().toString("hex"),s=this.ms.get(i)||new Set;s.add(r),this.ms.set(i,s)})}async fetch(t){c.kt(f,"Fetch",t);const e=this.gs.get(t);if(!e)throw new Error("No such mempool or blockchain transaction: "+t);return e}async utxos(t){if(c.kt(f,"Utxos",t.toString()),"string"==typeof t)try{t=i.fromAddress(t)}catch(e){t=new i(t)}else if(t instanceof o)t=i.fromAddress(t);else if(!(t instanceof i))throw new Error("Invalid script: "+u(t));const e=a(t),n=this.ms.get(e);return n?Array.from(n).map(t=>this._s.get(t)):[]}async time(t){c.tt(f,"Time",t);const e=this.ws.get(t);if(!e)throw new Error("No such mempool or blockchain transaction: "+t);return e}async spends(t,e){c.kt(f,"Spends",t,e);const n=`${t}_o${e}`;if(!this.bs.has(n))throw new Error("location not found: "+n);return this.bs.get(n)}fund(t,e){c.kt(f,"Fund",t.toString(),"with",e);const n=Math.random().toString(),r=(new s).addData(n).to(new o(t,"testnet"),e),a=r.hash,u=r.toString("hex");c.tt(f,"Broadcast",a),this.gs.set(a,u),this.ws.set(a,Date.now()),this.Ps.set(a,0);const l={txid:a,vout:1,script:r.outputs[1].script.toHex(),satoshis:r.outputs[1].satoshis},p=a+"_o1";this._s.set(p,l);const y=i.fromAddress(t),d=h(y.toBuffer()).reverse().toString("hex"),g=this.ms.get(d)||new Set;return g.add(p),this.ms.set(d,g),a}block(){c.tt(f,"Block"),this.Ps.clear()}}},function(t,e,n){const r=n(7),o=n(29),{h:i}=n(1);t.exports=class{constructor(t){let e=null;try{e=new r.HDPublicKey(t)}catch(e){throw new Error("Invalid API key: "+i(t))}this.network="mainnet"===e.network.name||"livenet"===e.network.name?"main":"test",this.apiKey=t,this.timeout=5e3}async pay(t,e){const n={rawtx:t,parents:e,key:this.apiKey},r=`https://api.run.network/v1/${this.network}/pay`;return(await o.Ui(r,n,this.timeout)).rawtx}}},function(t,e){function expect(t){let e=!1;const n=t=>{if("object"!=typeof t||!t)return t;try{return JSON.stringify(t)}catch(e){return t.toString()}};function r(r,o,i){if(e?r:!r)throw new Error(i||`expected value${e?" not":""} to be ${o} but was ${n(t)}`)}return{get not(){return e=!e,this},toBe:(e,o)=>r(t===e,""+n(e),o),toEqual:(e,o)=>r(function t(e,n){return typeof e==typeof n&&("object"==typeof e&&"object"==typeof n?null===e&&null===n||null!==e&&null!==n&&Object.keys(e).length===Object.keys(n).length&&Object.keys(e).every(r=>t(e[r],n[r])):e===n)}(t,e),"equal to "+n(e),o),toBeInstanceOf:(e,n)=>r(t&&t instanceof e,"an instance of "+e.name,n),toBeDefined:e=>r(void 0!==t,"defined",e),toBeNull:e=>r(null===t,"null",e),toBeNumber:e=>r("number"==typeof t,"a number",e),toBeInteger:e=>r(Number.isInteger(t),"an integer",e),toBeLessThan:(e,n)=>r(t<e&&"number"==typeof t&&"number"==typeof e,"less than "+e,n),toBeLessThanOrEqualTo:(e,n)=>r(t<=e&&"number"==typeof t&&"number"==typeof e,"less than or equal to "+e,n),toBeGreaterThan:(e,n)=>r(t>e&&"number"==typeof t&&"number"==typeof e,"greater than "+e,n),toBeGreaterThanOrEqualTo:(e,n)=>r(t>=e&&"number"==typeof t&&"number"==typeof e,"greater than or equal to "+e,n),toBeBoolean:e=>r("boolean"==typeof t,"a boolean",e),toBeString:e=>r("string"==typeof t,"a string",e),toBeObject:e=>r(t&&"object"==typeof t,"an object",e),toBeArray:e=>r(Array.isArray(t),"an array",e),toBeClass:e=>r("function"==typeof t&&t.toString().startsWith("class"),"a class",e),toBeFunction:e=>r("function"==typeof t&&!t.toString().startsWith("class"),"a function",e)}}expect.originMainnet="b6cd82f20242845ebef6867e05fd048c7763edf966cc3f8bc236a9e221843ce0_o3",expect.locationMainnet="b6cd82f20242845ebef6867e05fd048c7763edf966cc3f8bc236a9e221843ce0_o3",expect.ownerMainnet="13B8kvB8i2ka8JUKQYa3B1x33AZx5n7cXw",expect.originTestnet="6d626438e7a4fdbad1855b6656bb1abf74d0e2e500cc46b47ee79083838b429f_o3",expect.locationTestnet="6d626438e7a4fdbad1855b6656bb1abf74d0e2e500cc46b47ee79083838b429f_o3",expect.ownerTestnet="mzHqorB2BvtguytBnC65v325cTH9b6qSgb",t.exports=expect},function(t,e,n){const asm=n(34),hex=n(30);class GroupLock{constructor(t,e){this.pubkeys=t,this.m=void 0===e?this.pubkeys.length:e}script(){if(!Array.isArray(this.pubkeys))throw new Error("pubkeys not an array");if(this.pubkeys.length<1)throw new Error("pubkeys must have at least one entry");if(this.pubkeys.length>16)throw new Error("No more than 16 pubkeys allowed");const t=new Set;for(const e of this.pubkeys)t.add(e);if(t.size!==this.pubkeys.length)throw new Error("pubkeys contains duplicates");this.pubkeys.forEach(t=>hex(t));if("number"!=typeof this.m||!Number.isInteger(this.m)||this.m<1)throw new Error("m must be a non-negative integer");if(this.m>this.pubkeys.length)throw new Error("m must be <= the number of pubkeys");return asm(`OP_${this.m} ${this.pubkeys.join(" ")} OP_${this.pubkeys.length} OP_CHECKMULTISIG`)}domain(){return 1+74*this.m}}GroupLock.deps={asm,hex},GroupLock.originMainnet="b6cd82f20242845ebef6867e05fd048c7763edf966cc3f8bc236a9e221843ce0_o4",GroupLock.locationMainnet="b6cd82f20242845ebef6867e05fd048c7763edf966cc3f8bc236a9e221843ce0_o4",GroupLock.ownerMainnet="13B8kvB8i2ka8JUKQYa3B1x33AZx5n7cXw",GroupLock.originTestnet="6d626438e7a4fdbad1855b6656bb1abf74d0e2e500cc46b47ee79083838b429f_o4",GroupLock.locationTestnet="6d626438e7a4fdbad1855b6656bb1abf74d0e2e500cc46b47ee79083838b429f_o4",GroupLock.ownerTestnet="mzHqorB2BvtguytBnC65v325cTH9b6qSgb",t.exports=GroupLock},function(t,e,n){const Jig=n(2),Code=n(0);class Token extends Jig{init(...t){if(Object.getPrototypeOf(this.constructor)===Jig)throw new Error("Token must be extended");if(caller===this.constructor)return this.Es(caller.mintAmount),void(this.amount=caller.mintAmount);if(caller&&caller.constructor===this.constructor)return this.Es(caller.sendAmount),this.amount=caller.sendAmount,void(this.owner=caller.sendOwner);if(!Array.isArray(t)||t.length<2)throw new Error("Invalid tokens to combine");if(t.some(t=>t.constructor!==this.constructor))throw new Error("Cannot combine different token classes");if(t.some(e=>(e=>t.reduce((t,n)=>n===e?t+1:t,0))(e)>1))throw new Error("Cannot combine duplicate tokens");this.amount=0,t.forEach(t=>{this.amount+=t.amount,t.destroy()}),this.Es(this.amount)}static mint(t){this.mintAmount=t;const e=new this;return delete this.mintAmount,this.supply+=t,e}destroy(){super.destroy(),this.amount=0}send(t,e=this.amount){if(this.Es(e),e>this.amount)throw new Error("Not enough funds");this.sendAmount=e,this.sendOwner=t;const n=new this.constructor;return delete this.sendAmount,delete this.sendOwner,this.amount===e?this.destroy():this.amount-=e,n}Es(t){if("number"!=typeof t)throw new Error("amount is not a number");if(!Number.isInteger(t))throw new Error("amount must be an integer");if(t<=0)throw new Error("amount must be positive");if(t>Number.MAX_SAFE_INTEGER)throw new Error("amount too large")}}Token.sealed=!1,Token.decimals=0,Token.icon={emoji:null},Token.symbol=null,Token.supply=0,t.exports=Code.Ot(Token)}]);