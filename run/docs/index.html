
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>

    <script src="javascripts/bsv.browser.min.js"></script>
    <script src="javascripts/run.browser.min.js"></script>

    <style>
      .emoji {
        width: 14px
      }
    </style>
  </head>

  <body class="index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="Logo" />
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
          </li>
          <li>
            <a href="#getting-started" class="toc-h1 toc-link" data-title="Getting Started">Getting Started</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#getting-started-installation" class="toc-h2 toc-link" data-title="Installation">Installation</a>
                  </li>
                  <li>
                    <a href="#getting-started-setup" class="toc-h2 toc-link" data-title="Setup">Setup</a>
                  </li>
                  <li>
                    <a href="#getting-started-creating-jigs" class="toc-h2 toc-link" data-title="Creating Jigs">Creating Jigs</a>
                  </li>
                  <li>
                    <a href="#getting-started-loading-jigs" class="toc-h2 toc-link" data-title="Loading Jigs">Loading Jigs</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#jigs" class="toc-h1 toc-link" data-title="Jigs">Jigs</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#jigs-creating" class="toc-h2 toc-link" data-title="Creating">Creating</a>
                  </li>
                  <li>
                    <a href="#jigs-updating" class="toc-h2 toc-link" data-title="Updating">Updating</a>
                  </li>
                  <li>
                    <a href="#jigs-sending" class="toc-h2 toc-link" data-title="Sending">Sending</a>
                  </li>
                  <li>
                    <a href="#jigs-syncing" class="toc-h2 toc-link" data-title="Syncing">Syncing</a>
                  </li>
                  <li>
                    <a href="#jigs-interactivity" class="toc-h2 toc-link" data-title="Interactivity">Interactivity</a>
                  </li>
                  <li>
                    <a href="#jigs-extending" class="toc-h2 toc-link" data-title="Extending">Extending</a>
                  </li>
                  <li>
                    <a href="#jigs-backing" class="toc-h2 toc-link" data-title="Backing">Backing</a>
                  </li>
                  <li>
                    <a href="#jigs-parameter-validation" class="toc-h2 toc-link" data-title="Parameter Validation">Parameter Validation</a>
                  </li>
                  <li>
                    <a href="#jigs-downloading-classes" class="toc-h2 toc-link" data-title="Downloading Classes">Downloading Classes</a>
                  </li>
                  <li>
                    <a href="#jigs-fungible-tokens" class="toc-h2 toc-link" data-title="Fungible Tokens">Fungible Tokens</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#advanced-usage" class="toc-h1 toc-link" data-title="Advanced Usage">Advanced Usage</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#advanced-usage-caller" class="toc-h2 toc-link" data-title="Caller">Caller</a>
                  </li>
                  <li>
                    <a href="#advanced-usage-private-properties" class="toc-h2 toc-link" data-title="Private Properties">Private Properties</a>
                  </li>
                  <li>
                    <a href="#advanced-usage-static-properties" class="toc-h2 toc-link" data-title="Static Properties">Static Properties</a>
                  </li>
                  <li>
                    <a href="#advanced-usage-code-presets" class="toc-h2 toc-link" data-title="Code Presets">Code Presets</a>
                  </li>
                  <li>
                    <a href="#advanced-usage-batch-transactions" class="toc-h2 toc-link" data-title="Batch Transactions">Batch Transactions</a>
                  </li>
                  <li>
                    <a href="#advanced-usage-arbitrary-code" class="toc-h2 toc-link" data-title="Arbitrary Code">Arbitrary Code</a>
                  </li>
                  <li>
                    <a href="#advanced-usage-berries" class="toc-h2 toc-link" data-title="Berries">Berries</a>
                  </li>
                  <li>
                    <a href="#advanced-usage-locks" class="toc-h2 toc-link" data-title="Locks">Locks</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#tips-and-tricks" class="toc-h1 toc-link" data-title="Tips and Tricks">Tips and Tricks</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#tips-and-tricks-using-run-on-a-server" class="toc-h2 toc-link" data-title="Using Run on a Server">Using Run on a Server</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#tips-and-tricks-using-run-on-a-server-increase-cache-limits" class="toc-h3 toc-link" data-title="Increase Cache Limits">Increase Cache Limits</a>
                          </li>
                          <li>
                            <a href="#tips-and-tricks-using-run-on-a-server-persist-state" class="toc-h3 toc-link" data-title="Persist State">Persist State</a>
                          </li>
                          <li>
                            <a href="#tips-and-tricks-using-run-on-a-server-avoid-race-conditions" class="toc-h3 toc-link" data-title="Avoid Race Conditions">Avoid Race Conditions</a>
                          </li>
                          <li>
                            <a href="#tips-and-tricks-using-run-on-a-server-load-only-safe-code" class="toc-h3 toc-link" data-title="Load Only Safe Code">Load Only Safe Code</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#tips-and-tricks-limiting-supply" class="toc-h2 toc-link" data-title="Limiting Supply">Limiting Supply</a>
                  </li>
                  <li>
                    <a href="#tips-and-tricks-dynamic-whitelists" class="toc-h2 toc-link" data-title="Dynamic Whitelists">Dynamic Whitelists</a>
                  </li>
                  <li>
                    <a href="#tips-and-tricks-upgrading-jigs" class="toc-h2 toc-link" data-title="Upgrading Jigs">Upgrading Jigs</a>
                  </li>
                  <li>
                    <a href="#tips-and-tricks-atomic-swaps" class="toc-h2 toc-link" data-title="Atomic Swaps">Atomic Swaps</a>
                  </li>
                  <li>
                    <a href="#tips-and-tricks-debugging" class="toc-h2 toc-link" data-title="Debugging">Debugging</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#tips-and-tricks-debugging-writing-unit-tests" class="toc-h3 toc-link" data-title="Writing Unit Tests">Writing Unit Tests</a>
                          </li>
                          <li>
                            <a href="#tips-and-tricks-debugging-too-long-mempool-chain" class="toc-h3 toc-link" data-title="too-long-mempool-chain">too-long-mempool-chain</a>
                          </li>
                          <li>
                            <a href="#tips-and-tricks-debugging-getting-help" class="toc-h3 toc-link" data-title="Getting Help">Getting Help</a>
                          </li>
                      </ul>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#how-it-works" class="toc-h1 toc-link" data-title="How It Works">How It Works</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#how-it-works-overview" class="toc-h2 toc-link" data-title="Overview">Overview</a>
                  </li>
                  <li>
                    <a href="#how-it-works-transaction-format" class="toc-h2 toc-link" data-title="Transaction Format">Transaction Format</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#how-it-works-transaction-format-op_return-protocol" class="toc-h3 toc-link" data-title="op_return protocol">op_return protocol</a>
                          </li>
                          <li>
                            <a href="#how-it-works-transaction-format-json-payload" class="toc-h3 toc-link" data-title="json payload">json payload</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#how-it-works-inputs-and-outputs" class="toc-h2 toc-link" data-title="Inputs and Outputs">Inputs and Outputs</a>
                  </li>
                  <li>
                    <a href="#how-it-works-javascript-serialization" class="toc-h2 toc-link" data-title="JavaScript Serialization">JavaScript Serialization</a>
                  </li>
                  <li>
                    <a href="#how-it-works-privacy" class="toc-h2 toc-link" data-title="Privacy">Privacy</a>
                  </li>
                  <li>
                    <a href="#how-it-works-security" class="toc-h2 toc-link" data-title="Security">Security</a>
                  </li>
                  <li>
                    <a href="#how-it-works-signing-rules" class="toc-h2 toc-link" data-title="Signing Rules">Signing Rules</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#api-reference" class="toc-h1 toc-link" data-title="API Reference">API Reference</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#api-reference-run" class="toc-h2 toc-link" data-title="Run">Run</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-run-constructor-options" class="toc-h3 toc-link" data-title="constructor(options)">constructor(options)</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-load-location-berryclass" class="toc-h3 toc-link" data-title="load(location, BerryClass)">load(location, BerryClass)</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-deploy-code" class="toc-h3 toc-link" data-title="deploy(code)">deploy(code)</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-sync" class="toc-h3 toc-link" data-title="sync()">sync()</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-owner" class="toc-h3 toc-link" data-title="owner">owner</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-purse" class="toc-h3 toc-link" data-title="purse">purse</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-blockchain" class="toc-h3 toc-link" data-title="blockchain">blockchain</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-inventory-jigs" class="toc-h3 toc-link" data-title="inventory.jigs">inventory.jigs</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-inventory-code" class="toc-h3 toc-link" data-title="inventory.code">inventory.code</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-transaction" class="toc-h3 toc-link" data-title="transaction">transaction</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-app" class="toc-h3 toc-link" data-title="app">app</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-activate" class="toc-h3 toc-link" data-title="activate()">activate()</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-static" class="toc-h3 toc-link" data-title="static">static</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-jig" class="toc-h2 toc-link" data-title="Jig">Jig</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-jig-init" class="toc-h3 toc-link" data-title="init()">init()</a>
                          </li>
                          <li>
                            <a href="#api-reference-jig-sync" class="toc-h3 toc-link" data-title="sync()">sync()</a>
                          </li>
                          <li>
                            <a href="#api-reference-jig-origin" class="toc-h3 toc-link" data-title="origin">origin</a>
                          </li>
                          <li>
                            <a href="#api-reference-jig-location" class="toc-h3 toc-link" data-title="location">location</a>
                          </li>
                          <li>
                            <a href="#api-reference-jig-owner" class="toc-h3 toc-link" data-title="owner">owner</a>
                          </li>
                          <li>
                            <a href="#api-reference-jig-satoshis" class="toc-h3 toc-link" data-title="satoshis">satoshis</a>
                          </li>
                          <li>
                            <a href="#api-reference-jig-static-deps" class="toc-h3 toc-link" data-title="static deps">static deps</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-berry" class="toc-h2 toc-link" data-title="Berry">Berry</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-berry-location" class="toc-h3 toc-link" data-title="location">location</a>
                          </li>
                          <li>
                            <a href="#api-reference-berry-static-pluck-location-fetch-pluck" class="toc-h3 toc-link" data-title="static pluck(location, fetch, pluck)">static pluck(location, fetch, pluck)</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-token" class="toc-h2 toc-link" data-title="Token">Token</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-token-constructor-amount" class="toc-h3 toc-link" data-title="constructor(amount)">constructor(amount)</a>
                          </li>
                          <li>
                            <a href="#api-reference-token-send-to-amount" class="toc-h3 toc-link" data-title="send(to, amount)">send(to, amount)</a>
                          </li>
                          <li>
                            <a href="#api-reference-token-amount" class="toc-h3 toc-link" data-title="amount">amount</a>
                          </li>
                          <li>
                            <a href="#api-reference-token-value" class="toc-h3 toc-link" data-title="value">value</a>
                          </li>
                          <li>
                            <a href="#api-reference-token-static-combine-tokens" class="toc-h3 toc-link" data-title="static combine(...tokens)">static combine(...tokens)</a>
                          </li>
                          <li>
                            <a href="#api-reference-token-static-decimals" class="toc-h3 toc-link" data-title="static decimals">static decimals</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-transaction" class="toc-h2 toc-link" data-title="Transaction">Transaction</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-transaction-begin" class="toc-h3 toc-link" data-title="begin()">begin()</a>
                          </li>
                          <li>
                            <a href="#api-reference-transaction-end" class="toc-h3 toc-link" data-title="end()">end()</a>
                          </li>
                          <li>
                            <a href="#api-reference-transaction-export" class="toc-h3 toc-link" data-title="export()">export()</a>
                          </li>
                          <li>
                            <a href="#api-reference-transaction-import" class="toc-h3 toc-link" data-title="import()">import()</a>
                          </li>
                          <li>
                            <a href="#api-reference-transaction-rollback" class="toc-h3 toc-link" data-title="rollback()">rollback()</a>
                          </li>
                          <li>
                            <a href="#api-reference-transaction-pay" class="toc-h3 toc-link" data-title="pay()">pay()</a>
                          </li>
                          <li>
                            <a href="#api-reference-transaction-sign" class="toc-h3 toc-link" data-title="sign()">sign()</a>
                          </li>
                          <li>
                            <a href="#api-reference-transaction-actions" class="toc-h3 toc-link" data-title="actions">actions</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-modules" class="toc-h2 toc-link" data-title="Modules">Modules</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-modules-blockchainapi" class="toc-h3 toc-link" data-title="BlockchainApi">BlockchainApi</a>
                          </li>
                          <li>
                            <a href="#api-reference-modules-localowner" class="toc-h3 toc-link" data-title="LocalOwner">LocalOwner</a>
                          </li>
                          <li>
                            <a href="#api-reference-modules-localpurse" class="toc-h3 toc-link" data-title="LocalPurse">LocalPurse</a>
                          </li>
                          <li>
                            <a href="#api-reference-modules-mockchain" class="toc-h3 toc-link" data-title="Mockchain">Mockchain</a>
                          </li>
                          <li>
                            <a href="#api-reference-modules-payserver" class="toc-h3 toc-link" data-title="PayServer">PayServer</a>
                          </li>
                          <li>
                            <a href="#api-reference-modules-statecache" class="toc-h3 toc-link" data-title="StateCache">StateCache</a>
                          </li>
                          <li>
                            <a href="#api-reference-modules-viewer" class="toc-h3 toc-link" data-title="Viewer">Viewer</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-extras" class="toc-h2 toc-link" data-title="Extras">Extras</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-extras-asm" class="toc-h3 toc-link" data-title="asm">asm</a>
                          </li>
                          <li>
                            <a href="#api-reference-extras-expect" class="toc-h3 toc-link" data-title="expect">expect</a>
                          </li>
                          <li>
                            <a href="#api-reference-extras-grouplock" class="toc-h3 toc-link" data-title="GroupLock">GroupLock</a>
                          </li>
                          <li>
                            <a href="#api-reference-extras-standardlock" class="toc-h3 toc-link" data-title="StandardLock">StandardLock</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-apis" class="toc-h2 toc-link" data-title="APIs">APIs</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-apis-blockchain" class="toc-h3 toc-link" data-title="Blockchain">Blockchain</a>
                          </li>
                          <li>
                            <a href="#api-reference-apis-lock" class="toc-h3 toc-link" data-title="Lock">Lock</a>
                          </li>
                          <li>
                            <a href="#api-reference-apis-logger" class="toc-h3 toc-link" data-title="Logger">Logger</a>
                          </li>
                          <li>
                            <a href="#api-reference-apis-owner" class="toc-h3 toc-link" data-title="Owner">Owner</a>
                          </li>
                          <li>
                            <a href="#api-reference-apis-purse" class="toc-h3 toc-link" data-title="Purse">Purse</a>
                          </li>
                          <li>
                            <a href="#api-reference-apis-state" class="toc-h3 toc-link" data-title="State">State</a>
                          </li>
                      </ul>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#tools" class="toc-h1 toc-link" data-title="Tools">Tools</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#tools-explorer" class="toc-h2 toc-link" data-title="Explorer">Explorer</a>
                  </li>
                  <li>
                    <a href="#tools-deploy" class="toc-h2 toc-link" data-title="Deploy">Deploy</a>
                  </li>
              </ul>
          </li>
      </ul>
        <ul class="toc-footer">
            <li>version 0.5.35</li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p>Run is a platform to build apps and tokens on Bitcoin. Developers create applications using interactive objects, called jigs. Jigs allow you to build almost anything you can dream up: tokens, contracts, interfaces, elections, games, digital pets, and more — all run on Bitcoin.</p>

<p>Run supports full object-oriented programming and arbitrary code today. It is secure and performant for real applications. These docs will help you get started!</p>
<h1 id='getting-started'>Getting Started</h1><h2 id='getting-started-installation'>Installation</h2>
<blockquote>
<p>Load both <code>bsv</code> and Run in the browser</p>
</blockquote>
<pre class="highlight html tab-html"><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"bsv.browser.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"run.browser.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre>
<blockquote>
<p>Load Run in Node.js</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">Run</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./dist/run.node.min'</span><span class="p">)</span>
</code></pre>
<p>If you&#39;re new to Run, let the <a href="https://run.network">tutorial series</a> guide your journey to get acquainted. You can write code without installing anything. The web browser Console will be your playground.</p>

<p>The details written here in the Docs have example code in the sidebar on the right-hand side. Anything you read in paragraphs, you can preview in-action over there. ⇥</p>

<p>Run works everywhere including all major browsers, on desktop and mobile, as well as Node.js 10+ on <a href="#advanced-usage-using-run-on-a-server">servers</a>. Run is written in JavaScript ES6 and uses the <a href="https://github.com/moneybutton/bsv"><strong>bsv</strong> library</a> to build and sign transactions. To get started:</p>

<ul>
<li>For a webpage: Add <code>bsv.browser.min.js</code> and <code>run.browser.min.js</code> to the <code>&lt;head&gt;</code> tag.</li>
<li>For Node.js: Execute <code>npm install bsv</code> to install <strong>bsv</strong>, then import <code>run.node.min.js</code>.</li>
</ul>

<p>And that&#39;s it. All your code and jigs will be saved on-chain and Run will use public APIs to interact with the Bitcoin network. You don&#39;t need to deploy any servers with Run. All the logic works client-side.</p>
<h2 id='getting-started-setup'>Setup</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">network</span><span class="p">:</span> <span class="s1">'mock'</span> <span class="p">})</span>
</code></pre>
<p>The Run instance manages your communication with the Bitcoin network. The default network is <code>main</code> (Mainnet), but for development and testing, we recommend <code>mock</code>. Mock is an in-memory simulation blockchain that does not require funds to use. We like to call it the <em>mockchain</em>. For more configuration options, see <a href="#api-reference-run">API Reference: Run</a>.</p>
<h2 id='getting-started-creating-jigs'>Creating Jigs</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">SimpleStore</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">set</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">jig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimpleStore</span><span class="p">()</span>

<span class="nx">jig</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'Satoshi Nakamoto'</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">jig</span><span class="p">.</span><span class="nx">owner</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">jig</span><span class="p">.</span><span class="nx">location</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">jig</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
</code></pre>
<p>Let&#39;s begin with a basic jig that stores a value in a variable. Create a jig called <code>SimpleStore</code>. By extending from <code>Jig</code>, the instances of your class will automatically sync to the blockchain. Every jig has an <code>owner</code>. Any code may read jigs but only its <code>owner</code> can update it. The <code>owner</code> is typically a Bitcoin address, and the private key is required to update it.</p>

<p>In addition to <code>owner</code>, every jig has a <code>location</code>. A jig&#39;s <code>location</code> is the pairing of a Bitcoin transaction ID and an output index, and it represents a particular state in time of an object or class on Bitcoin. When you check the <code>location</code> property of a jig, you get its current location. If you wish to get the location where the jig was first deployed, that is called its <code>origin</code>. The <code>origin</code> is unique and will not change, however <code>location</code> changes with every update. After a method call, your jig will have a new <code>location</code> pointing to a Bitcoin transaction containing the last method call.</p>
<h2 id='getting-started-loading-jigs'>Loading Jigs</h2>
<blockquote>
<p>Loading all jigs</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>

<span class="kr">const</span> <span class="nx">simpleStore</span> <span class="o">=</span> <span class="nx">run</span><span class="p">.</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">jigs</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="k">instanceof</span> <span class="nx">SimpleStore</span><span class="p">)</span>

<span class="nx">simpleStore</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
</code></pre>
<blockquote>
<p>Loading a specific jig</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">specificJig</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">simpleStore</span><span class="p">.</span><span class="nx">location</span><span class="p">)</span>

<span class="nx">specificJig</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'abc'</span><span class="p">)</span>
</code></pre>
<p>The simplest way to load your jigs is to call <code>run.sync()</code> and then access <code>run.inventory.jigs</code>. <code>run.sync()</code> will find and load all objects owned by <code>run.owner</code> and place them in the <code>jigs</code> array. Once loaded, you may call methods and use them normally. Alternatively, you may wish to load a particular jig or load a jig from a historical location or previous state. To do either, pass the <code>location</code> of the jig you wish to load into <code>run.load()</code>.</p>

<p>If you&#39;ve loaded a historical location so that your jig is in a previous state, you&#39;ll need to first catch up to the latest state before you&#39;ll be allowed to make a method call. <code>sync()</code> will handily fast-forward a jig to its latest state on the blockchain <em>without</em> triggering a Bitcoin transaction. In the example on the sidebar, if <code>specificJig</code> was in a historical state, you would call <code>specificJig.sync()</code> and then call <code>specificJig.set(&#39;abc&#39;)</code>. When you accidentally try to update a jig without the jig being in its latest state, Run will safely abort before publishing a Bitcoin transaction and inform you with an error. In that case, you&#39;ll just need to add the preceding <code>sync()</code> call and execute your code again. The best practice is to write code in such a way that jigs are always up-to-date in their latest state. Run manages the heavy lifting for you.</p>

<p><code>sync()</code> also acts as a debugging tool since it surfaces any errors your jigs have. If you notice your app acting funny, a well-placed preceding <code>specificJig.sync()</code> can help you uncover the error. You may also call <code>sync()</code> on the Run instance, like this: <code>run.sync()</code>. That&#39;ll help you search out any errors from your entire app in <em>all</em> of the jigs you own.</p>
<h1 id='jigs'>Jigs</h1>
<p>Jigs are interactive objects on Bitcoin. You define a jig with a JavaScript class and that class determines exactly what the jig can do. Every instance of a jig is unique. Each one has an owner and only that owner can update the jig. How is that secured? Bitcoin! Let&#39;s explore how you create a jig.</p>
<h2 id='jigs-creating'>Creating</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Post</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span> 
    <span class="nx">init</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">message</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">new</span> <span class="nx">Post</span><span class="p">(</span><span class="s1">'Hello, world'</span><span class="p">)</span>
</code></pre>
<p>Let&#39;s create a new jig called <code>Post</code> that represents content on a message board. In JavaScript, your constructor is called <code>constructor</code> but for jigs, this method is called <code>init</code>. Think of them the same way. If <code>init</code> throws an exception, the jig will never be created, just like constructors. You create jigs by calling <code>new</code> as you would with normal JavaScript objects and they get deployed onto the Bitcoin network. Pretty cool.</p>
<h2 id='jigs-updating'>Updating</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">EditablePost</span> <span class="kr">extends</span> <span class="nx">Post</span> <span class="p">{</span>
    <span class="nx">edit</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">message</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">editablePost</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EditablePost</span><span class="p">(</span><span class="s1">'Hello, world'</span><span class="p">)</span>

<span class="nx">editablePost</span><span class="p">.</span><span class="nx">edit</span><span class="p">(</span><span class="s1">'Hello, BitCoin'</span><span class="p">)</span>
</code></pre>
<p>Jigs are updated by calling methods. In fact, that is the only way to update jigs, because if users could assign properties directly, then classes would become irrelevant. When you call a method, Run publishes a Bitcoin transaction with data in an <code>op_return</code> that includes the method name and its arguments. The state may be recomputed simply by playing back every update one-by-one. For more information about how it works, see <a href="#how-it-works">How It Works</a>.</p>
<h2 id='jigs-sending'>Sending</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Dragon</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">send</span><span class="p">(</span><span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">owner</span> <span class="o">=</span> <span class="nx">to</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">new</span> <span class="nx">Dragon</span><span class="p">().</span><span class="nx">send</span><span class="p">(</span><span class="nx">address</span><span class="p">)</span>
</code></pre>
<p>Jigs may be sent to someone else by changing the <code>owner</code> property of a jig. Simply set the owner to the new owner, which may be a Bitcoin address, public key, or custom <a href="#advanced-usage-locks">Lock</a>. The new owner will be able to update the jig.</p>
<h2 id='jigs-syncing'>Syncing</h2>
<blockquote>
<p>Wait for updates to complete</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">LoyaltyCard</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
    <span class="nx">init</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">stamps</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">}</span>
    <span class="nx">stamp</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">stamps</span> <span class="o">+=</span><span class="mi">1</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">card</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">LoyaltyCard</span><span class="p">()</span>
<span class="nx">await</span> <span class="nx">card</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>

<span class="nx">card</span><span class="p">.</span><span class="nx">stamp</span><span class="p">()</span>
<span class="nx">await</span> <span class="nx">card</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>
</code></pre>
<blockquote>
<p>Sync a jig from its origin to its latest state</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">card2</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">card</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
<span class="nx">card2</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>
</code></pre>
<p>Run is asynchronous. When you create or update jigs, Run creates Bitcoin transactions for you in the background and broadcasts them to the network. As with any network request, the request may sometimes fail. Your connection may go down or a node on the network may reject your transaction for various reasons. Also, your jigs may be behind the latest state on the network. </p>

<p>Run updates your jig&#39;s state with each method call you make. However, it does <em>not</em> continuously update your jigs. Because if it did, as a developer you&#39;d feel like you were on shifting sand. Instead, you&#39;ve got a reliable and steady state for each jig that you&#39;re working with. </p>

<p>While only the <code>owner</code> can update a jig, depending on the app you&#39;ve built and actions of the owner of the jig, you might need to catch up a jig to its latest state because it could have been modified outside of your app.</p>

<p>Every jig has <code>sync()</code> available to ensure your local state is the same as that on the network. Calling <code>jig.sync()</code> returns a promise that resolves after:</p>

<ol>
<li>All pending local transactions have been published successfully, and </li>
<li>The jig has been caught up with any new transactions from the network.</li>
</ol>

<p>Any errors in validation or network requests will cause the promise to be rejected. </p>

<p>For a development prototype or hackathon project, you won&#39;t need to call <code>sync()</code> very much. Run will happily execute method calls on jigs in their latest state. Unless you notice a problem, you don&#39;t need to worry about <code>sync()</code>. However, in a production app, the best practice is to call <code>sync()</code> after every method call to ensure that you catch errors early and handle them gracefully. Calling <code>sync()</code> will force any error to show up at that particular line in the code.</p>
<h2 id='jigs-interactivity'>Interactivity</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Event</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">createTicket</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">new</span> <span class="nx">Ticket</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">Ticket</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">event</span> <span class="o">=</span> <span class="nx">event</span> <span class="p">}</span>
<span class="p">}</span>

<span class="nx">Event</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">Ticket</span> <span class="p">}</span>
</code></pre>
<p>Jigs may create other jigs. Calling <code>new</code> to construct a jig within another jig&#39;s methods run will create a new output in the transaction. Sometimes you will create new jigs that are of the same class, but many times you will want to create jigs that are of a different class. Because by default Jig code runs in a sandbox without access to other code, you use the <code>Jig.deps</code> property to specify class dependencies.</p>

<p>Jigs may store other jigs as properties too. Think of these as standard JavaScript object references that you may read or write. However, if stored jigs are updated, then their owners must also sign the Bitcoin transaction that updates their state. For more information on spending rules, see the section titled <a href="#how-it-works">How It Works</a>.</p>
<h2 id='jigs-extending'>Extending</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">EditablePost</span> <span class="kr">extends</span> <span class="nx">Post</span> <span class="p">{</span>
  <span class="nx">edit</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">message</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Jig classes may be extended from other jig classes to add or alter behavior. This is a great way to build off of established jigs and even support modding communities. Class <code>super</code> calls work as expected, and there is no need to specify parents as dependencies because Run  will automatically detect them.</p>
<h2 id='jigs-backing'>Backing</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Tip</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">pubkey</span><span class="p">,</span> <span class="nx">amount</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">message</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">owner</span> <span class="o">=</span> <span class="nx">pubkey</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">satoshis</span> <span class="o">=</span> <span class="nx">amount</span>
  <span class="p">}</span>

  <span class="nx">withdraw</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">satoshis</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">new</span> <span class="nx">Tip</span><span class="p">(</span><span class="s1">'I like your videos'</span><span class="p">,</span> <span class="nx">pubkey</span><span class="p">,</span> <span class="mi">100000</span><span class="p">)</span>
</code></pre>
<p>Jigs may be backed by Bitcoins. When a jig is backed, it means that the output associated with that jig has a non-dust value in it. Backed jigs let users send money between each other and provide a baseline value for items. To back a jig, set the <code>satoshis</code> property to any non-negative number. Your purse will automatically deposit that amount into the jig. When the <code>satoshis</code> property is later decreased, those Bitcoins will be withdrawn to the jig owner&#39;s purse.</p>

<p>It is important to remember that these are <em>backed</em> jigs and not smart contracts. The jig&#39;s owner may always melt the satoshis out of the jig and in doing so destroy the jig.</p>

<aside class="notice">
<b>Note:</b> All bitcoin outputs must have an amount at least the dust limit, currently 546 satoshis, to be accepted by the network. Run will choose the greater of the `satoshis` property and this dust limit when building outputs.
</aside>
<h2 id='jigs-parameter-validation'>Parameter Validation</h2>
<blockquote>
<p>Attaching an item</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Hat</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span> <span class="p">}</span>

<span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">wear</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">item</span><span class="p">).</span><span class="nx">toBeInstanceOf</span><span class="p">(</span><span class="nx">Hat</span><span class="p">)</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">item</span> <span class="o">=</span> <span class="nx">item</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">Person</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">Hat</span><span class="p">,</span> <span class="na">expect</span><span class="p">:</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">expect</span> <span class="p">}</span>
</code></pre>
<p>Because JavaScript is dynamically typed, Jigs should always validate their parameters. Of course you could write checks and throw Errors yourself, but to make life easy, Run provides the <code>expect</code> helper function. <code>expect</code> is like the assertions you might use in a Jest or Chai unit testing. It lets you to check if a jig is a certain class, if a number is greater than another number, and many other conditions. To get started, add <code>expect</code> as a dependency to your jig as seen to the right. Then, check out the full <a href="#api-reference-extras-expect">expect</a> documention to see what else you can do.</p>

<p>Sometimes you may wish to check if a class is part of a changing set. For example, a game may have a list of item classes that may change over time. For that, see the <a href="#tips-and-tricks-dynamic-whitelists">Dynamic Whitelists</a> section.</p>

<aside class="warning">
<b>Warning:</b> Using `instanceof` today is not safe because anyone may extend a class and change its behavior. However, in the future, by default, only class authors will be able to extend classes, so you may plan for this security today. There will also be a way to allow any user to extend from classes.
</aside>
<h2 id='jigs-downloading-classes'>Downloading Classes</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Data</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Data</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>

<span class="c1">// The location of the Data class is stored in Data.location</span>
</code></pre>
<blockquote>
<p>Load the Data class from another instance</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">Data</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s1">'&lt;class-location-goes-here&gt;'</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Data</span><span class="p">(</span><span class="s1">'abc'</span><span class="p">)</span>
</code></pre>
<p>You may wish to download existing code that has already been deployed, for example, to create more instances of a particular class. The <code>run.load</code> method, in addition to loading jigs, is also able to download, install and sandbox code from the blockchain.</p>
<h2 id='jigs-fungible-tokens'>Fungible Tokens</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">USDCoin</span> <span class="kr">extends</span> <span class="nx">Token</span> <span class="p">{</span> <span class="p">}</span>
<span class="nx">USDCoin</span><span class="p">.</span><span class="nx">backingBank</span> <span class="o">=</span> <span class="s1">'HSBC'</span>
<span class="nx">USDCoin</span><span class="p">.</span><span class="nx">bankAccount</span> <span class="o">=</span> <span class="s1">'12345'</span>

<span class="c1">// Mint a new coin. Only USDCoin.owner may do this</span>
<span class="kr">const</span> <span class="nx">mintedCoin</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">USDCoin</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">mintedCoin</span><span class="p">.</span><span class="nx">amount</span><span class="p">)</span> <span class="c1">// 100</span>

<span class="c1">// Send part of a coin to someone else and keep the change</span>
<span class="kr">const</span> <span class="nx">changeCoin</span> <span class="o">=</span> <span class="nx">coinToSend</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">pubkey</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="c1">// Combine two tokens together</span>
<span class="kr">const</span> <span class="nx">combinedCoin</span> <span class="o">=</span> <span class="nx">USDCoin</span><span class="p">.</span><span class="nx">combine</span><span class="p">(</span><span class="nx">coin1</span><span class="p">,</span> <span class="nx">coin2</span><span class="p">)</span>
</code></pre>
<p>It is possible to create fungible tokens similar to ERC-20 with Run. Run provides a base <code>Token</code> class for this purpose. However unlike ERC-20 where multiple users interact through a single contract, in Run each user owns their own tokens. It is closer to Bitcoin UTXOs or SLP tokens. To create a new kind of token, simply extend the <code>Token</code> class with the name of your token. Then you can mint new tokens just by creating new instances. Only you will be able to mint new tokens, but coins you mint may be sent to others.</p>

<p>See <a href="#api-reference-extras-token"><code>API Reference: Token</code></a> for more details.</p>
<h1 id='advanced-usage'>Advanced Usage</h1><h2 id='advanced-usage-caller'>Caller</h2>
<blockquote>
<p>Storing the parent jig</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Child</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="nx">caller</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>Enforcing a method may only be called by certain classes</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Database</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">rootUser</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">rootUser</span> <span class="o">=</span> <span class="nx">rootUser</span>
  <span class="p">}</span>

  <span class="nx">deleteAll</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">caller</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">rootUser</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'only the root user may delete the database'</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">deleteDatabase</span><span class="p">(</span><span class="nx">database</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">database</span><span class="p">.</span><span class="nx">deleteAll</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Within Jig code, there is a special <code>caller</code> variable that is available. This variable is the jig that called this jig&#39;s methods and <code>null</code> if the jig&#39;s method was invoked from application code.</p>

<p>You can use <code>caller</code> to keep track of where a jig came from by storing the parent jig inside of a child jig. You can also enforce that a child jig is created by a specific parent, or enforce that certain methods can only be called by certain jigs.</p>
<h2 id='advanced-usage-private-properties'>Private Properties</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Dragon</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_numberOfCrashLandings</span> <span class="o">=</span> <span class="mi">88</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">InsurancePolicy</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">dragon</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Throws an error !</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">dragon</span><span class="p">.</span><span class="nx">_numberOfCrashLandings</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">chargeMoreMoney</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Jigs may contain private variables and private methods. Private properties are available only to that jig, and by using them, you can better control the interface that users and other jigs interact with. Simply prefix your properties with an understore to hide them. Run enforces this for you too!</p>

<p>Private variables may only be read inside a jig from one of its methods. If another kind of class attempts to read a private variable, Run will throw an error. Private variables may however be read externally in non-jig code, for example in the web Console. You can use that ability to help you debug and check the values of private properties while you&#39;re developing your app.</p>

<p>Private methods are similar. They may only be called as helper methods from within the same jig or by another jig of the same class. However, unlike private variables, you cannot call a private method externally in the web Console. If you think about, that makes sense, because calling a private method externally would execute code with unintended consequences. Run keeps you safe.</p>

<aside class="warning">
<b>Warning:</b> Private properties are not encrypted. They are an <em>access control</em> feature, not a user privacy feature.
</aside>
<h2 id='advanced-usage-static-properties'>Static Properties</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">DigitalPet</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span> <span class="p">}</span>

<span class="nx">DigitalPet</span><span class="p">.</span><span class="nx">author</span> <span class="o">=</span> <span class="s1">'Maximus'</span>
<span class="nx">DigitalPet</span><span class="p">.</span><span class="nx">license</span> <span class="o">=</span> <span class="s1">'MIT'</span>
<span class="nx">DigitalPet</span><span class="p">.</span><span class="nx">icon</span> <span class="o">=</span> <span class="p">{</span> <span class="na">emoji</span><span class="p">:</span> <span class="s1">'🐉'</span> <span class="p">}</span>

<span class="nx">run</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">DigitalPet</span><span class="p">)</span>
</code></pre>
<p>Classes and functions may have static properties as metadata. These properties are stored on-chain with the code definition itself when the code is uploaded. Any later downloads of that code will have these properties set. Class properties may be any kind of data that Run can <a href="#how-it-works-javascript-serialization">serialize</a>, including basic data types, jigs, and other classes or functions. Here are some recommended conventions:</p>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>author</code></td>
<td>string</td>
<td>Name of the class&#39;s creator</td>
</tr>
<tr>
<td><code>license</code></td>
<td>string</td>
<td>License for the code</td>
</tr>
<tr>
<td><code>icon</code></td>
<td>object { emoji: string }</td>
<td>Icon to identify the class in block explorers. The <code>emoji</code> property should be a single emoji character.</td>
</tr>
<tr>
<td><code>deps</code></td>
<td>object</td>
<td>Dependencies that are loaded as globals into the code sandbox.</td>
</tr>
</tbody></table>

<p>When code is deployed, Run will set the <code>origin</code>, <code>location</code>, and <code>owner</code> properties on the class.</p>
<h2 id='advanced-usage-code-presets'>Code Presets</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Dragon</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">set</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Use the deploy tool to deploy the Dragon class and generate these presets</span>

<span class="nx">Dragon</span><span class="p">.</span><span class="nx">originMainnet</span> <span class="o">=</span> <span class="s1">'bee45c75c37a289517f33ebfa051601c9610ccc56fbddfbabc44413db5b0bc1b_o1'</span>
<span class="nx">Dragon</span><span class="p">.</span><span class="nx">locationMainnet</span> <span class="o">=</span> <span class="s1">'bee45c75c37a289517f33ebfa051601c9610ccc56fbddfbabc44413db5b0bc1b_o1'</span>
<span class="nx">Dragon</span><span class="p">.</span><span class="nx">ownerMainnet</span> <span class="o">=</span> <span class="s1">'13amCautaFqwbWV6MoC86xrh96W4fXGfDV'</span>
</code></pre>
<p>When you wish to create an instance of a jig from a class you&#39;ve already deployed, you have two options. Either you can load the class from the blockchain via <code>run.load</code> and then create an instance, or you can create an instance from a local class that has <em>presets</em> applied. When a local class has presets, Run doesn&#39;t have to download the code from the blockchain. Presets are a great way to share jig classes in NPM libraries too.</p>

<p>You can use the <a href="#api-reference-deploy-tool">deploy tool</a> to generate presets. However, you can also create them manally. To do this, upload your code to each Bitcoin network you wish to support using <code>run.deploy</code> in a script. Then set the following static properties on the class itself before using or distributing it. Run will detect these presets and automatically use the origins and locations on the appropriate network.</p>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>originMainnet</code></td>
<td>string</td>
<td>Mainnet origin for the uploaded class</td>
</tr>
<tr>
<td><code>originTestnet</code></td>
<td>string</td>
<td>Testnet origin for the uploaded class</td>
</tr>
<tr>
<td><code>originSTN</code></td>
<td>string</td>
<td>STN origin for the uploaded class</td>
</tr>
<tr>
<td><code>originMocknet</code></td>
<td>string</td>
<td>Mocknet origin for the uploaded class</td>
</tr>
<tr>
<td><code>locationMainnet</code></td>
<td>string</td>
<td>Mainnet location for the uploaded class</td>
</tr>
<tr>
<td><code>locationTestnet</code></td>
<td>string</td>
<td>Testnet location for the uploaded class</td>
</tr>
<tr>
<td><code>locationSTN</code></td>
<td>string</td>
<td>STN location for the uploaded class</td>
</tr>
<tr>
<td><code>locationMocknet</code></td>
<td>string</td>
<td>Mocknet location for the uploaded class</td>
</tr>
<tr>
<td><code>ownerMainnet</code></td>
<td>string or Lock</td>
<td>Optional mainnet owner for the uploaded class</td>
</tr>
<tr>
<td><code>ownerTestnet</code></td>
<td>string or Lock</td>
<td>Optional testnet owner for the uploaded class</td>
</tr>
<tr>
<td><code>ownerSTN</code></td>
<td>string or Lock</td>
<td>Optional STN owner for the uploaded class</td>
</tr>
<tr>
<td><code>ownerMocknet</code></td>
<td>string or Lock</td>
<td>Optional mocknet owner for the uploaded class</td>
</tr>
</tbody></table>

<aside class="warning">
<b>Warning:</b> Run assumes that the class code matches the code that is stored on the blockchain. Only use class libraries from people you trust.
</aside>
<h2 id='advanced-usage-batch-transactions'>Batch Transactions</h2><pre class="highlight javascript tab-javascript"><code><span class="k">try</span> <span class="p">{</span>
  <span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">begin</span><span class="p">()</span>
  <span class="kr">const</span> <span class="nx">jig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CustomJig</span><span class="p">()</span>
  <span class="nx">jig</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">to</span><span class="p">)</span>
<span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
  <span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>
<p>Multiple actions may be batched together into a single atomic Bitcoin transaction. In addition to making these actions all-or-nothing, batching also reduces fees. Any number of updates may be batched together from different jigs. Call <code>run.transaction.begin()</code> before performing updates and <code>run.transaction.end()</code> after. These may also be nested, and when the final <code>end()</code> is called, the transaction will be published on-chain.</p>
<h2 id='advanced-usage-arbitrary-code'>Arbitrary Code</h2>
<blockquote>
<p>Loading a helper class</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Preconditions</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">checkArgument</span><span class="p">(</span><span class="nx">check</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">check</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">()</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">PositiveNumber</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">checkArgument</span><span class="p">(</span><span class="nx">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">PositiveNumber</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="na">$</span><span class="p">:</span> <span class="nx">Preconditions</span> <span class="p">}</span>
</code></pre>
<p>Run supports deploying and loading any arbitrary code from the blockchain, not just jigs. You can deploy helpers functions, helper classes, server code, views, and more. To do this, simply call <code>run.deploy()</code> with your function or class. It will be given a location that you can load later. You will also find it in your inventory: <code>run.inventory.code</code>.</p>

<p>One difference between arbitrary classes and jig classes is that instances of arbitrary classes, called <em>arbitrary objects</em>, do not sync their state with the blockchain. If they are passed into jigs, they are passed by value. This can be very useful for passing data but it should not be treated the same as jigs whose state is guaranteed and recorded from its method calls.</p>

<p>One popular use of arbitrary code is to write helper libraries like big integer math or cryptographic hashing. Another use case is to upgrade behavior of Jig classes. See <a href="#advanced-usage-upgrading-jigs">Upgrading Jigs</a> for more details.</p>

<aside class="notice">
<b>Note:</b> Unlike Jigs, arguments that are passed into arbitrary code functions may expose your global scope. Be careful.
</aside>
<h2 id='advanced-usage-berries'>Berries</h2>
<blockquote>
<p>Load a metanet node</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">txid</span> <span class="o">=</span> <span class="s1">'2f24d7edb8de0ef534d8e0bc2413eddda451b4accc481519a1647d7af79d8e88'</span>
<span class="kr">const</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">txid</span><span class="p">,</span> <span class="nx">MetanetNode</span><span class="p">)</span>
</code></pre>
<blockquote>
<p>Define the MetanetNode Berry</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">MetanetNode</span> <span class="kr">extends</span> <span class="nx">Berry</span> <span class="p">{</span>
  <span class="c1">// Its constructor can only be called by its pluck function. Run guarantees this.</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">pnode</span><span class="p">,</span> <span class="nx">parent</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">pnode</span> <span class="o">=</span> <span class="nx">pnode</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="nx">parent</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">data</span>
  <span class="p">}</span>

  <span class="c1">// Run calls this pluck function when you call run.load with a Berry class.</span>
  <span class="kr">static</span> <span class="nx">async</span> <span class="nx">pluck</span><span class="p">(</span><span class="nx">location</span><span class="p">,</span> <span class="nx">fetch</span><span class="p">,</span> <span class="nx">pluck</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">txo</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">location</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">txo</span><span class="p">.</span><span class="nx">out</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s1</span> <span class="o">===</span> <span class="s1">'meta'</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">pnode</span> <span class="o">=</span> <span class="nx">txo</span><span class="p">.</span><span class="nx">out</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s2</span>
      <span class="kr">const</span> <span class="nx">txidParent</span> <span class="o">=</span> <span class="nx">txo</span><span class="p">.</span><span class="nx">out</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s3</span>
      <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">txo</span><span class="p">.</span><span class="nx">out</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s4</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">data</span> <span class="o">===</span> <span class="s1">'METANET_ROOT'</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">MetanetNode</span><span class="p">(</span><span class="nx">pnode</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">parentNode</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">pluck</span><span class="p">(</span><span class="nx">txidParent</span><span class="p">)</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">MetanetNode</span><span class="p">(</span><span class="nx">pnode</span><span class="p">,</span> <span class="nx">parentNode</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Third-party protocols, like Twetch, B, and Metanet, may be used within Run with Berries. Berries are JavaScript objects representing arbitrary data on the blockchain. If you can write code to parse an OP_RETURN, you can create Berries. Berries are more than data though. They are objects. They can have methods, their types can be checked, they can be passed into jigs, stored as properties, cached, and more.</p>

<p>To load berries for an existing Berry protocol, simply call <code>run.load</code> and pass in the Berry protocol as the second parameter. Run will be shipping with several built-in Berry protocols in the near future.</p>

<p>To define a new Berry protocol, simply extend from the <a href="#api-reference-berry">Berry</a> class and implement the static <code>pluck</code> method. Run calls your <code>pluck</code> method to load data at that location into a JavaScript object. Run provides transaction data in the <a href="https://github.com/interplanaria/txo">txo format</a> from Planaria to easily parse <code>op_return</code> data. Berry classes get deployed on-chain too making them fully deterministic.</p>

<p>Once loaded, berries have locations that are extended to include both their protocol location and data location in the form: `<berry_class_location>://<berry_data_location>. This is a unique identifier and allows them to be cached in the state cache.</p>

<aside class="notice">
<b>Note:</b> If this seems complex, don't worry! We expect most users will not have to write their own berries, and like plugins, there will be many berry protocols to choose from in the future. Stay tuned.
</aside>
<h2 id='advanced-usage-locks'>Locks</h2>
<blockquote>
<p>Send a token to a P2PK output script</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">PubkeyLock</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">pubkey</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">pubkey</span> <span class="o">=</span> <span class="nx">pubkey</span> <span class="p">}</span>
  <span class="nx">script</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">asm</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">pubkey</span><span class="p">}</span><span class="s2"> OP_CHECKSIG`</span><span class="p">)</span> <span class="p">}</span>
  <span class="nx">domain</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">74</span> <span class="p">}</span>
<span class="p">}</span>

<span class="nx">PubkeyLock</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">asm</span> <span class="p">}</span>

<span class="nx">token</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">PubkeyLock</span><span class="p">(</span><span class="nx">pubkey</span><span class="p">))</span>
</code></pre>
<blockquote>
<p>A provably unspendable lock</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Unspendable</span> <span class="p">{</span>
  <span class="nx">script</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">asm</span><span class="p">(</span><span class="s1">'OP_RETURN'</span><span class="p">)</span> <span class="p">}</span>
  <span class="nx">domain</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">0</span> <span class="p">}</span>
<span class="p">}</span>

<span class="nx">Unspendable</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">asm</span> <span class="p">}</span>
</code></pre>
<p>The default owner for a jig is a Bitcoin address. This is a great default, but sometimes you&#39;ll want more advanced ownership. For example, you may want a group to own a jig, so that no one party has exclusive control. Or you may wish for a jig to be provably owned by nobody. Both of these and more are possible with <em>locks</em>.</p>

<p>A <em>lock</em> is an object that produces a Bitcoin output script. You can set one as the <code>owner</code> on your jigs. Run ships with a <a href="#api-reference-extras-grouplock">GroupLock</a> for multi-sig ownership, and you may also create your own locks by implementing the <a href="#api-reference-apis-lock">Lock API</a>. Your class will have two methods: <code>script()</code> and <code>domain()</code>. After implementing these methods, simply set the owner of a jig to an instance of your lock, and Run will produce an output with your script.</p>

<p>You&#39;ll probably also want to unlock your jigs to update them. To do that, create a corresponding key by implementing the <a href="#api-reference-apis-owner">Owner API</a>. Your implemenentation of <code>Owner</code> will need to implement to methods: <code>sign()</code> and <code>owner()</code>.</p>

<p><code>Locks</code> are deterministic, typed, and run in a sandbox environment. This means they can be safely used inside jigs. But this also means they can&#39;t use the <code>bsv</code> library or similar external code. Run provides an <a href="#api-reference-extras-asm">asm</a> helper function to fill the gap when building custom scripts inside Lock classes.</p>

<aside class="notice">
<b>Note:</b> If this seems complex, don't worry! There will be many types of locks to choose from in the future, and most users won't need to write their own. Stay tuned.
</aside>
<h1 id='tips-and-tricks'>Tips and Tricks</h1><h2 id='tips-and-tricks-using-run-on-a-server'>Using Run on a Server</h2>
<p>You may choose to use Run in a server environment. For example, you may:</p>

<ul>
<li>Index user jigs to allow searching in your app</li>
<li>Take actions automatically as in a game server</li>
<li>Gather statistics about your user&#39;s behaviors</li>
<li>Administrative tasks like managing a blacklist</li>
</ul>

<p>The architecture you choose will depend on your application. You might create a REST service using <code>express</code> that allows users to make requests. Or you might index all jigs using a Planaria crawler. Or you might deploy a serverless function that responds to events. Or perhaps a combination.</p>

<p>No matter the approach, you&#39;ll likely use Node on your servers. Run requires at least version 10 of Node. You can check which version you are using with <code>node --version</code>. If you are using Google Functions, be sure to set <code>{ &quot;engine&quot;: 10 }</code> in your <code>package.json</code>, because it defaults to Node 8.</p>

<p>Here are a few more tips:</p>
<h3 id='tips-and-tricks-using-run-on-a-server-increase-cache-limits'>Increase Cache Limits</h3>
<blockquote>
<p>Increase the mainnet blockchain cache size</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">()</span>

<span class="nx">run</span><span class="p">.</span><span class="nx">blockchain</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="mi">1000000</span>
</code></pre>
<p>The <code>BlockchainApi</code> caches transactions it fetches in memory. By default, it will cache 10,000 transactions. This is reasonable for clients, but on a server you should increase this limit by changing <code>run.blockchain.cache.size</code>.</p>

<blockquote>
<p>Increase the state cache size</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">run</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">sizeMB</span> <span class="o">=</span> <span class="mi">1000</span>
</code></pre>
<p>The <code>StateCache</code> also caches jig state. By default, it caches 10MB of data in memory. This can be increased by setting <code>run.state.cache.sizeMB</code>. Alternatively, you also choose to <a href="#advanced-usage-using-run-on-a-server-persist-state">persist state</a> on disk rather than in memory.</p>

<p>After increasing these limits, you may also need to increase Node&#39;s memory limits. If you launch your server by starting node manually, you can increase its memory via: <code>node --max-old-space-size=8192</code>.</p>
<h3 id='tips-and-tricks-using-run-on-a-server-persist-state'>Persist State</h3>
<blockquote>
<p>Save state into a Firestore collection</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Firestore</span> <span class="p">{</span>
  <span class="nx">async</span> <span class="nx">get</span><span class="p">(</span><span class="nx">location</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">entry</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'state'</span><span class="p">).</span><span class="nx">doc</span><span class="p">(</span><span class="nx">location</span><span class="p">).</span><span class="nx">get</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">exists</span><span class="p">)</span> <span class="k">return</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">data</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="nx">async</span> <span class="nx">set</span><span class="p">(</span><span class="nx">location</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'state'</span><span class="p">).</span><span class="nx">doc</span><span class="p">(</span><span class="nx">location</span><span class="p">).</span><span class="nx">set</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">state</span><span class="p">:</span> <span class="k">new</span> <span class="nx">Firestore</span><span class="p">()</span> <span class="p">})</span>
</code></pre>
<p>It is a good idea to persist your state in a database so your backend never needs to load the same jig twice. It is even more important when using multiple servers because you can share this database. Simply implement the <a href="#api-reference-apis-state">State</a> API.</p>

<p>Run will automatically call <code>get</code> on your <code>State</code> implementation when locations are requested, and <code>set</code> when the state is calculated. State will never change for a given location. Just implement these two methods to load and save state into your preferred key-value database: Redis, Firestore, DynamoDB, etc.</p>

<p>To the right is an example of persisting in Google Firestore.</p>
<h3 id='tips-and-tricks-using-run-on-a-server-avoid-race-conditions'>Avoid Race Conditions</h3>
<p>If you are seeing server errors about <code>Missing inputs</code> or <code>txn-mempool-conflict</code>, it is likely that you have encountered a race condition. Two pieces of code are likely attempting to update the same jig at the same time, and are attemping to spend the same Bitcoin outputs. The network can only accept one. To solve this, here are a few recommendations:</p>

<p><strong>Load jigs once at the start</strong>: If you have jigs you are reused across many request handlers, then load those jigs once upon starting your server, rather than loading them each time they are used. This will let Run track the output as a single object, and successive updates on that object will be correctly enqueued.</p>

<p><strong>Separate server, separate purses</strong>: Every Run instance has its own internal update queue, so it is unlikely that the purse will be double-spent on a single server. But on multiple servers, if a purse key is shared, then it is very likely that double-spend errors will occur. To avoid this, use different purse keys on different servers.</p>

<p><strong>Sync after every update</strong>: Call <code>await jig.sync()</code> on jigs after you call a method to be sure that the updates were applied before continuing on.</p>

<p><strong>Serialize risky updates</strong>: If a request handler makes updates to multiple jigs, and these updates can conflict if interleaved across multiple users, then consider serializing these updates. The most reliable approach is to bundle all jig updates together in a <a href="#advanced-usage-batch-transactions">batch</a>, so that the operation is all-or-nothing. An alternative is to put updates into a task queue like <code>p-limit</code>.</p>

<p><strong>Add retry logic</strong>: If the above changes do not fix a race condition, consider adding retry logic.</p>
<h3 id='tips-and-tricks-using-run-on-a-server-load-only-safe-code'>Load Only Safe Code</h3>
<p>Arbitrary code has the potential for infinite loops and infinite memory attacks that can take down your server. Avoid running code that you do not trust. Only load jigs that you expect are safe, and avoid executing arbitrary code without an admin&#39;s approval. And do not call <code>run.sync()</code>, because that will load UTXOs you receive from others. In the future, we will have tooling to handle these attacks and run arbitrary code, similar to how the Bitcoin SV node has a fast-path and a slow-path, but for now it is best to be safe.</p>
<h2 id='tips-and-tricks-limiting-supply'>Limiting Supply</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Weapon</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">owner</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">caller</span><span class="p">).</span><span class="nx">toBeInstanceOf</span><span class="p">(</span><span class="nx">GameItems</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">owner</span> <span class="o">=</span> <span class="nx">owner</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">GameItems</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">weaponCount</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="p">}</span>

  <span class="nx">createWeapon</span><span class="p">(</span><span class="nx">owner</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">owner</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">GameItems</span><span class="p">.</span><span class="nx">owner</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="k">this</span><span class="p">.</span><span class="nx">weaponCount</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'too many weapons'</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Weapon</span><span class="p">(</span><span class="nx">owner</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">GameItems</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">Weapon</span><span class="p">,</span> <span class="nx">expect</span> <span class="p">}</span>
<span class="nx">Weapon</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">GameItems</span><span class="p">,</span> <span class="nx">expect</span> <span class="p">}</span>
</code></pre>
<p>The supply of a jig class may be limited through the use of a <em>minter</em>. The <em>minter</em> is a separate jig that regulates the number of <em>mintee</em> jigs produced. In the example on the right, the <code>GameItems</code> jig is the <em>minter</em> and is owned by the game. The <code>Weapon</code> jig is the <em>mintee</em> and is owned by a player. The <code>Weapon</code> class enforces that it can only be created by <code>GameItems</code>, and the <code>GameItems</code> class limits the supply of <code>Weapon</code>.</p>

<p>In <code>Weapon.init</code>, we check that the weapon is being created by a <code>GameItems</code> instance using the <a href="#advanced-usage-caller">caller</a> special property. <code>caller</code> is the jig that called the current method being executed. If a player tried to create a <code>Weapon</code> instance independent of <code>GameItems</code>, Run would throw an error because the <code>caller</code> property would be <code>null</code>.</p>

<p>In <code>GameItems</code>, we check that there are no more than 10 items created by the game in <code>createWeapon(owner)</code>. This limits the supply. However, we also have to check that <code>GameItems</code> is only able to be created by the game company. This is to prevent users from creating their own <code>GameItems</code> classes to mint their own weapons.</p>
<h2 id='tips-and-tricks-dynamic-whitelists'>Dynamic Whitelists</h2>
<blockquote>
<p>A dynamic whitelist to support new tokens over time</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">TokenWhitelist</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokens</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Set</span><span class="p">()</span> <span class="p">}</span>
  <span class="nx">add</span><span class="p">(</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokens</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">T</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">whitelist</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TokenWhitelist</span><span class="p">()</span>

<span class="kr">class</span> <span class="nx">Account</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">deposits</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Set</span><span class="p">()</span> <span class="p">}</span>

  <span class="nx">deposit</span><span class="p">(</span><span class="nx">token</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">token</span><span class="p">.</span><span class="nx">owner</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">owner</span><span class="p">)</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">Account</span><span class="p">.</span><span class="nx">whitelist</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">token</span><span class="p">.</span><span class="nx">constructor</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">deposits</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">token</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">Account</span><span class="p">.</span><span class="nx">whitelist</span> <span class="o">=</span> <span class="nx">whitelist</span> 
</code></pre>
<p>Often times an app will want to allow third-party developers to create new kinds of content. That content should freely interact with existing content once it is approved. For this, it&#39;s useful to have a dynamic whitelist of approved classes that jigs can check against. Jigs may store classes and functions like as any other data, and jigs may also be passed code as arguments into their methods. Combining these features, we can create a whitelist. </p>

<p>For example, an exchange may allow users to permissionally exchange any tokens approved on their site. To do this, we can approvers create whitelists. The owners of these whitelists will often be the apps themselves. See the example to the right 🠮</p>

<p>Similarly, as an app developer, you may want to revoke access to jigs you&#39;ve issued for security. One way to do this is for every revokable token to create a separate token owned by the party who can revoke it. Every action taken inside the token should check if it is revoked, and if so, throw an error.</p>
<h2 id='tips-and-tricks-upgrading-jigs'>Upgrading Jigs</h2>
<blockquote>
<p>Method 1: Reissuing Jigs</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">OriginalJig</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">f</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">3</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">UpgradedJig</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span> 
  <span class="nx">init</span><span class="p">(</span><span class="nx">original</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">original</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">!==</span> <span class="nx">OriginalJig</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'unexpected jig'</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">original</span> <span class="o">=</span> <span class="nx">original</span>
  <span class="p">}</span>
  <span class="nx">f</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">4</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>Method 2: Replacing Behavior</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Weapon</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">setAttackBehavior</span><span class="p">(</span><span class="nx">attackFunction</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">attackFunction</span> <span class="o">=</span> <span class="nx">attackFunction</span>
  <span class="p">}</span>

  <span class="nx">attack</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">attackFunction</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">weapon</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Weapon</span><span class="p">()</span>

<span class="kd">function</span> <span class="nx">attackPlayer</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">player</span><span class="p">.</span><span class="nx">doDamage</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">weapon</span><span class="p">.</span><span class="nx">setAttackBehavior</span><span class="p">(</span><span class="nx">attackPlayer</span><span class="p">)</span>
<span class="nx">weapon</span><span class="p">.</span><span class="nx">attack</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span>
</code></pre>
<p>By default, jig classes are not upgradable. However, you may simulate upgradability by creating a new jig that wraps the old one and adds the new behavior. You may also simulate upgradability by storing behavior in classes. These are both demonstrated on the right. There will be additional ways to upgrade classes in the future.</p>
<h2 id='tips-and-tricks-atomic-swaps'>Atomic Swaps</h2>
<blockquote>
<p>Atomically swapping two items with different owners</p>

<p>Machine 1</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">myWeapon</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">weaponLocation</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">theirArmor</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">armorLocation</span><span class="p">)</span>

<span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">begin</span><span class="p">()</span>

<span class="kr">const</span> <span class="nx">me</span> <span class="o">=</span> <span class="nx">myWeapon</span><span class="p">.</span><span class="nx">owner</span>
<span class="nx">myWeapon</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">theirArmor</span><span class="p">.</span><span class="nx">owner</span><span class="p">)</span>
<span class="nx">theirArmor</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">me</span><span class="p">)</span>

<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">pay</span><span class="p">()</span>
<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">sign</span><span class="p">()</span>

<span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="kr">export</span><span class="p">()</span>
</code></pre>
<blockquote>
<p>Machine 2</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="kr">import</span><span class="p">(</span><span class="nx">tx</span><span class="p">)</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// TODO: Inspect the transaction to be sure it atomically swaps</span>
<span class="p">}</span>
<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">sign</span><span class="p">()</span>

<span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
</code></pre>
<p>Run supports atomically updating jigs with different owners using the Transaction API. One application for this is atomic swaps, where two jigs owned by different users are exchanged in a single transaction.</p>

<p>The general process for an atomic swap is first for one user to start a Run transaction by calling <code>run.transaction.begin()</code>. Then, this user performs all updates, including calling methods on jigs they don&#39;t own. Run allows this user to build the transaction although they won&#39;t be able to add all of the signatures. Finally, this first user pays for the transaction and sign their jigs. The transaction is complete, and must now be handed to other parties for them to add their signatures. To do that, the first user calls <code>run.transaction.export()</code> to get the bsv transaction and sends it to the other parties via a separate channel.</p>

<p>The other party then calls <code>run.transaction.import()</code> to load the transaction they received. They may then want to check what the transaction does by inspecting <code>run.transaction.actions</code>. If they approve, then they may call <code>run.transaction.sign()</code> to add signatuers for their jigs. This process may continue for additional parties. When all signatures are collected, the last user calls <code>run.transaction.end()</code> to broadcast the transaction to the Bitcoin network.</p>

<p>The Transaction API may also be used to simulate state channels and propose changes to other jigs. See the <a href="#api-reference-transaction">Transaction API</a> for more information.</p>
<h2 id='tips-and-tricks-debugging'>Debugging</h2>
<p>Sometimes you will be faced with errors you don&#39;t understand. Don&#39;t fret! Here are some tips:</p>

<ul>
<li>Grab the latest Run SDK from <a href="https://www.runonbitcoin.com">runonbitcoin.com</a></li>
<li>Redeploy any jigs from older versions of Run</li>
<li>Use Node 10+ or a modern web browser like Chrome, Firefox, Edge, or Safari</li>
<li>Use the mockchain to check that it is not a connection or server-side error</li>
<li>Enable Run&#39;s internal logs by passing <code>{ logger: console }</code> into <code>Run</code></li>
<li>Disable sandboxing for your class by adding your class to the <code>Run.sandbox.excludes</code> array. (Note: This is not recommended in production)</li>
</ul>
<h3 id='tips-and-tricks-debugging-writing-unit-tests'>Writing Unit Tests</h3>
<p>It is always a good idea to write unit tests for your jigs. We recommend using a framework like <code>mocha</code> or <code>jest</code>, and running your tests using the mockchain. The mockchain will be faster and will isolate your Jig logic from any network errors.</p>
<h3 id='tips-and-tricks-debugging-too-long-mempool-chain'>too-long-mempool-chain</h3>
<p>If you see a <code>too-long-mempool-chain</code> error, it means that you&#39;ve hit a BSV network limitation. Today, only 25 transactions may be chained together in each Bitcoin block, and because of how Run works, you are likely to hit this in one of two ways:</p>

<ol>
<li>You update a jig 25 times in a ~10 minute block window</li>
<li>You create ~250 separate jigs in a ~10 minute block window using the same purse</li>
</ol>

<p>For #1, our best advice is to see if you can rearchitect your Jigs to avoid this case. We will provide a built-in solution in the future to avoid this limit.</p>

<p>For #2, we recommend switching between purses. Run automatically splits your UTXOs into 10 pieces, so you usually will be able to make over 200 transactions per block for each purse. You can increase this limit by setting <code>run.purse.splits = 100</code>.</p>
<h3 id='tips-and-tricks-debugging-getting-help'>Getting Help</h3>
<p>Please reach out to @niv in the BSV slack channels. We are happy to help you debug and fix any issues you encounter. If you can, see if you can reproduce the issue in the browser using <code>getting_started.html</code>.</p>
<h1 id='how-it-works'>How It Works</h1><h2 id='how-it-works-overview'>Overview</h2>
<p>A jig is a JavaScript object that Run syncs with the blockchain. All of its code and method calls are stored on-chain in <code>op_return</code> outputs, enabling its state to be reconstructed by loading the code and replaying every method call. Every jig is paired with a Bitcoin output and only the owner of that output can make changes to the jig. All updates taken together form a transaction chain that enables consensus through user verification. This design is similar to other UTXO-based token systems because miners don&#39;t verify what is published. If anyone publishes an incorrect update however, it not only destroys the jig but also leaves an immutable record.</p>
<h2 id='how-it-works-transaction-format'>Transaction Format</h2>
<blockquote>
<p>Sample code for a transaction</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Dragon</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span> <span class="p">}</span>

<span class="kr">const</span> <span class="nx">dragon</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dragon</span><span class="p">()</span>
</code></pre>
<p>The Run protocol for storing jigs and code is in development but will be well-documented, stable, and open in the future. Here is an example Bitcoin transaction.</p>

<table><thead>
<tr>
<th>Inputs</th>
<th>Outputs</th>
</tr>
</thead><tbody>
<tr>
<td>1. payment</td>
<td>1. op-return</td>
</tr>
<tr>
<td></td>
<td>2. p2pkh: Dragon Class</td>
</tr>
<tr>
<td></td>
<td>3. p2pkh: dragon jig instance</td>
</tr>
<tr>
<td></td>
<td>4. change output for payment</td>
</tr>
</tbody></table>
<h3 id='how-it-works-transaction-format-op_return-protocol'>op_return protocol</h3>
<p>The following script is used for the first output of all Run transactions: </p>

<p><code>[op_false] [op_return] &#39;run&#39; 0x00 &#39;&lt;app-id&gt;&#39; &#39;&lt;json-payload&gt;&#39; [debug-info]</code></p>

<ul>
<li>Each data field starts with an op_push specifying its length.</li>
<li>The second push data is the protocol version.</li>
<li>The app-id field enables applications to identify their Run transactions.</li>
<li>Strings are UTF-8 encoded.</li>
<li><code>[op_false] [op_return]</code> is standard on Bitcoin SV since the Quasar hard fork.</li>
<li>The JSON payload is currently encrypted. This encryption will be removed before launch.</li>
</ul>
<h3 id='how-it-works-transaction-format-json-payload'>json payload</h3>
<p><code>{</code></p>

<p><code>actions: [{ def: &quot;_o1&quot;, method: &quot;init&quot;, args: [], owner: &quot;&lt;pubkey&gt;&quot; }]</code>,</p>

<p><code>defs: [{ code: &quot;class Dragon extends Jig { }&quot;, owner: &quot;&lt;pubkey&gt;&quot; }],</code></p>

<p><code>jigs: 1</code></p>

<p><code>}</code></p>
<h2 id='how-it-works-inputs-and-outputs'>Inputs and Outputs</h2>
<p>Within a jig transaction, the inputs are the jigs which were updated from the transaction, and the outputs are the updated or newly created jigs. There may also be class and payment inputs and outputs. The jig or class for each output is determined by evaluating the updates in the <code>op_return</code>, and the resulting order is roughly the class outputs followed by the jig outputs in their order they were updated.</p>
<h2 id='how-it-works-javascript-serialization'>JavaScript Serialization</h2>
<blockquote>
<p>Pass an arbitrary object in by value</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">creationDate</span><span class="p">,</span> <span class="nx">profilePicture</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">creationDate</span> <span class="o">=</span> <span class="nx">creationDate</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">profilePicture</span> <span class="o">=</span> <span class="nx">profilePicture</span>
    <span class="p">}</span>

    <span class="nx">valid</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">SocialGroup</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">members</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">}</span>

    <span class="nx">add</span><span class="p">(</span><span class="nx">person</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">person</span><span class="p">).</span><span class="nx">toBeInstanceOf</span><span class="p">(</span><span class="nx">Person</span><span class="p">)</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">person</span><span class="p">.</span><span class="nx">valid</span><span class="p">()).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">members</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">person</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">SocialGroup</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">Person</span><span class="p">,</span> <span class="nx">expect</span> <span class="p">}</span>

<span class="kr">const</span> <span class="nx">group</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SocialGroup</span><span class="p">()</span>

<span class="nx">group</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="s1">'Li'</span><span class="p">,</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span> <span class="kc">null</span><span class="p">))</span>
</code></pre>
<p>Every state of a jig, every argument to a method, and every static property of a class, must be serialized so that it can be restored later. Run uses a custom serialization format that is similar to JSON. The details are not important for these docs, but it is important to know that only the following data types are supported:</p>

<ul>
<li>Numbers</li>
<li>Strings</li>
<li>Booleans</li>
<li>Objects (Basic and Arbitrary)</li>
<li>Null and Undefined</li>
<li>Arrays</li>
<li>Uint8Arrays</li>
<li>Maps</li>
<li>Sets</li>
<li>Jigs</li>
<li>Classes</li>
<li>Functions</li>
<li>Berries</li>
</ul>

<p><em>Arbitrary objects</em> are also supported. You may think of these as JavaScript objects that are <em>not</em> jigs. Whereas jigs have a blockchain locations and owner, and Run enforces that their state progresses from their method calls, arbitrary objects are much simpler. Arbitrary objects are stored by-value in their current state. In effect, they are data blobs with methods. The only protection is that Run <em>will</em> guarantee that methods of the class are not overriden by object properties, allowing you to call methods and getters securely called on the object.</p>

<p>All JavaScript IEEE 754 numbers types are supported, including Infinity, NaN, and -0. Auxiliary properties may be safely set on Sets, Maps, and Arrays, including any of the above types. Circular references are OK. </p>

<p>Symbols are not serializable and will not be supported. Other JavaScript objects that are not currently supported include Date, WeakMap, Promise, Error, Float32Array, and BigInt.</p>
<h2 id='how-it-works-privacy'>Privacy</h2>
<p>All jigs and jig code are stored on-chain and are open for everyone to read. This enables anyone to reconstruct the state of any jig. Privacy is achieved similar to Bitcoin UTXOs. For maximum privacy, public keys should not be re-used. In the future, we will introduce <em>private jigs</em> that are visible only to the current owners, but by their nature, they will not work as well with explorers, analytics and other services.</p>
<h2 id='how-it-works-security'>Security</h2>
<p>Every jig&#39;s code is sandboxed so that it does not have access to the global state which includes your funds. That provides security and also determinism when replaying a jig&#39;s history. A jig should evaluate the same in every environment. Run uses <a href="https://github.com/Agoric/ses-shim">Agoric SES</a> library, the gold standard in secure JavaScript evalution, combined with the <code>vm</code> library in node and hidden <code>iframes</code> in the browser. Despite this, it is recommended you avoid running untrusted code, because there are stil vulnerabilities at this time.</p>

<p>Because of this sandboxing, Jigs must specify their dependencies manually by setting the <code>deps</code> property on the class. Upon creating an instance of that jig, Run will load each dependency into its own sandbox and link them together.</p>

<p>Run also protects you from performing updates on your jigs that will not be validated by others. For example, Run will throw an error if you try to change a property on a jig directly rather than call a method, or if you attempt to set a function as a property on a jig. Only top-level method calls may change a jig&#39;s state which is also enforced by Run.</p>
<h2 id='how-it-works-signing-rules'>Signing Rules</h2>
<p>The rules to determine which jigs must be spent in a Bitcoin transaction and therefore which owners are required to sign off are the following:</p>

<ol>
<li>If a method reads jigs and does not change state, then no spends are required.</li>
<li>If there are any changes to a jig&#39;s state, then all jigs written are spent.</li>
<li>If a jig changes any other jig&#39;s state or creates a new jig, then it is spent.</li>
</ol>

<p>Jigs that are only read but not written do not require their owners to sign off. They are called references, and recorded by their location for future replay. Read references must plausibly be in their latest state when read. Reads of immutable properties however are not counted as reads by Run. Reads are only counted if the property is <em>mutable state</em> because <em>immutable state</em> would be the same for every <code>location</code> in the past.</p>
<h1 id='api-reference'>API Reference</h1><h2 id='api-reference-run'>Run</h2>
<p><code>class Run { ... }</code></p>

<p>The Run class is the main coordinator between the user&#39;s application and the blockchain. You always create a Run instance when you use Run. This objects will create and sign transactions, load jigs and code, connect to Bitcoin Bitcion network, securely sandbox code, keep an inventory of jigs, keep a cache for fast loads, and more.</p>
<h3 id='api-reference-run-constructor-options'>constructor(options)</h3>
<blockquote>
<p>Create a Run instance on Mocknet. The purse will be auto-funded.</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">network</span><span class="p">:</span> <span class="s1">'mock'</span> <span class="p">})</span>
</code></pre>
<blockquote>
<p>Create a run instance on Testnet</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="c1">// Create a run instance on testnet</span>
<span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span>
  <span class="na">network</span><span class="p">:</span> <span class="s1">'test'</span><span class="p">,</span>
  <span class="na">owner</span><span class="p">:</span> <span class="s1">'cTMHbJULREfbsUFsuJLMrNbJ7VrASgWeYfFF6EgJMy49ARnNed3d'</span><span class="p">,</span>
  <span class="na">purse</span><span class="p">:</span> <span class="s1">'cQP1h2zumWrCr2zxciuNeho61QUGtQ4zBKWFauk7WEhFb8kvjRTh'</span>
<span class="p">})</span>
</code></pre>
<p><code>constructor(options: object): Run</code></p>

<p>You usually create a <code>Run</code> instance with a private key, but you may also pass a public key, an address or a custom class as the owner. If you set the <code>owner</code> property to a private key, then new Jigs and classes may be created using it. However, if you set <code>owner</code> to a public key or address, then the Run instance will be in read-only mode and you won&#39;t be able to create new objects.</p>

<p>The <code>owner</code> is different from the <code>purse</code>. The purse also has a private key but whereas the owner is used to update jigs, the purse is used to pay for transactions. It is recommended that these be separate keys so that the bitcoin outputs are distinct. That helps both for performance and reducing the risk of another wallet not being aware that certain outputs were for jigs and accidentally destroying them.</p>

<p>Creating a new <code>Run</code> instance will automatically activate it. See <code>run.activate()</code> for more information.</p>
<h4 id='api-reference-run-constructor-options-options'>Options</h4>
<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code>network</code></td>
<td>string</td>
<td>Bitcoin network, either <code>main</code>, <code>test</code>, <code>stn</code>, or <code>mock</code>.</td>
<td><code>main</code></td>
</tr>
<tr>
<td><code>api</code></td>
<td>string</td>
<td>One of &#39;run&#39;, &#39;mattercloud&#39;, or &#39;whatsonchain&#39;</td>
<td>&#39;run&#39;</td>
</tr>
<tr>
<td><code>apiKey</code></td>
<td>string</td>
<td>Blockchain API key. Currently, only MatterCloud supports this option.</td>
<td>undefined</td>
</tr>
<tr>
<td><code>owner</code></td>
<td>string or <code>Owner</code></td>
<td>Private key, public key, address, or <a href="#advanced-usage-locks">custom lock</a> used to own jigs and sign transactions</td>
<td>Randomly generated <code>LocalOwner</code></td>
</tr>
<tr>
<td><code>purse</code></td>
<td>string or <code>Purse</code></td>
<td>Private key or <code>Purse</code> API used to pay for transactions. On the mock network, the purse will be funded automatically. For other networks, the user must fund the purse.</td>
<td>Randomly generated <code>LocalPurse</code></td>
</tr>
<tr>
<td><code>wallet</code></td>
<td><code>Owner</code> and <code>Purse</code></td>
<td>A shorthand for a single object that implements both <code>Owner</code> and <code>Purse</code>. If specified, then <code>owner</code> and <code>purse</code> are ignored.</td>
<td>undefined</td>
</tr>
<tr>
<td><code>blockchain</code></td>
<td><code>Blockchain</code></td>
<td>Blockchain implementation for interacting with the Bitcoin network. If specified, then <code>network</code>, <code>api</code>, and <code>apiKey</code> are ignored.</td>
<td>BlockchainApi</td>
</tr>
<tr>
<td><code>state</code></td>
<td><code>State</code></td>
<td>A state API implementation that Run will use instead of the default <code>StateCache</code></td>
<td><code>new StateCache()</code></td>
</tr>
<tr>
<td><code>logger</code></td>
<td><code>Logger</code></td>
<td>Logging object for internal run messages. If <code>logger</code> is null, then nothing will be logged. You may pass <code>console</code> as the logger to log everything.</td>
<td>Logs warnings and errors to the console</td>
</tr>
<tr>
<td><code>app</code></td>
<td>string</td>
<td>Application id to distinguish Run transactions. See <a href="#how-it-works">How It Works</a>.</td>
<td>Empty string</td>
</tr>
</tbody></table>
<h3 id='api-reference-run-load-location-berryclass'>load(location, BerryClass)</h3>
<blockquote>
<p>Load a particular jig</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">ticketLocation</span> <span class="o">=</span> <span class="s1">'afc557ef2970af0b5fb8bc1a70a320af425c7a45ca5d40eac78475109563c5f8_o1'</span>
<span class="kr">const</span> <span class="nx">ticket</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">ticketLocation</span><span class="p">)</span>
</code></pre>
<blockquote>
<p>Load a Jig class</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">classLocation</span> <span class="o">=</span> <span class="s1">'e4a9618d3a187448feeb95ff30f7ec6381a025316cdcae2cdf388ad3de7fab6f_o2'</span>
<span class="kr">const</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">classLocation</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">()</span>
</code></pre>
<p><code>load(location: string, BerryClass: ?function): Promise&lt;object|function&gt;</code></p>

<p>Universal load method to load any kind of resource including jigs, jig classes, arbitrary code, berries, and more. You pass in an on-chain <code>location</code>. The <code>location</code> is a transaction id and output index pair. This string should usually be the jig&#39;s or class&#39;s last known <code>location</code> property. However, it is also possible to load jigs at any state in the past using other <code>location</code>s, although these will be read-only. Downloaded code will be safely sandboxed before being returned.</p>

<p>If you pass a BerryClass, then Run will load the berry at the location using its plucker. If none is specified, then Run loads the blockchain item using its own loader.</p>
<h3 id='api-reference-run-deploy-code'>deploy(code)</h3>
<blockquote>
<p>Upload a BigInteger class to the blockchain</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">BigInteger</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">location</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">BigInteger</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'BigInteger blockchain location'</span><span class="p">,</span> <span class="nx">location</span><span class="p">)</span>
</code></pre>
<p><code>deploy(T: function): Promise&lt;string&gt;</code></p>

<p>Uploads code to the blockchain. Once deployment completes, the class or function will be assigned a <code>location</code> so that it may be downloaded later. It will also be assigned an <code>origin</code> and <code>owner</code>. <code>deploy</code> returns its new location in a promise. If a transaction is in progress via <code>begin</code> however, then this method will return a resolved promise, but it will not contain the location, because the location will not be known until after the transaction is complete. Code uploaded does not necessarily need to be a Jig class — any class or function will work.</p>
<h3 id='api-reference-run-sync'>sync()</h3>
<blockquote>
<p>Wait for all jigs to deploy and classes to upload before continuing</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">MyClass</span> <span class="p">{</span> <span class="p">}</span>
<span class="nx">run</span><span class="p">.</span><span class="nx">upload</span><span class="p">(</span><span class="nx">MyClass</span><span class="p">)</span>

<span class="kr">class</span> <span class="nx">MyObject</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span> <span class="p">}</span>
<span class="kr">const</span> <span class="nx">jig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyObject</span><span class="p">()</span>

<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'jig origin'</span><span class="p">,</span> <span class="nx">jig</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'class origin'</span><span class="p">,</span> <span class="nx">MyClass</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">run</span><span class="p">.</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">jigs</span><span class="p">)</span> <span class="c1">// [jig]</span>
</code></pre>
<p><code>sync(): Promise&lt;void&gt;</code></p>

<p>Returns a promise that completes when all pending transactions are published and the owner&#39;s jigs and code are updated. After this completes, all jigs and classes will be assigned <code>location</code>s.</p>

<aside class="notice">
<b>Note:</b> If a pending transaction fails to publish, that transaction and all subsequent transactions are reverted and the Promise is rejected.
</aside>
<h3 id='api-reference-run-owner'>owner</h3>
<p><code>owner: Owner</code></p>

<p>The owner object used to update jigs and approve transactions. See the <a href="#api-reference-apis-owner">Owner</a> API.</p>
<h3 id='api-reference-run-purse'>purse</h3>
<p><code>purse: Purse</code></p>

<p>The purse used to pay for transactions. In the current version of Run, you should not change the purse after the Run instance is loaded.</p>
<h3 id='api-reference-run-blockchain'>blockchain</h3>
<blockquote>
<p>Download a transaction from the blockchain</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">txid</span> <span class="o">=</span> <span class="s1">'afc557ef2970af0b5fb8bc1a70a320af425c7a45ca5d40eac78475109563c5f8'</span>
<span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">blockchain</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">txid</span><span class="p">)</span>
</code></pre>
<p><code>blockchain: Blockchain</code></p>

<p>Blockchain API to access the bitcoin network. See the <a href="#api-reference-apis-blockchain">Blockchain</a> API.</p>
<h3 id='api-reference-run-inventory-jigs'>inventory.jigs</h3>
<blockquote>
<p>Load all jigs that are tickets</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="c1">// Update the owner's jigs</span>
<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>

<span class="c1">// Find the ticket</span>
<span class="kr">const</span> <span class="nx">ticketClassOrigin</span> <span class="o">=</span> <span class="s1">'e4a9618d3a187448feeb95ff30f7ec6381a025316cdcae2cdf388ad3de7fab6f_o1'</span>
<span class="kr">const</span> <span class="nx">ticket</span> <span class="o">=</span> <span class="nx">run</span><span class="p">.</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">jigs</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">jig</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">origin</span> <span class="o">===</span> <span class="nx">ticketClassOrigin</span><span class="p">)</span>
</code></pre>
<p><code>jigs: Array&lt;Jig&gt;</code></p>

<p>Returns an array of all jigs owned by the Run owner. This array is cached. To update it, call <code>run.sync()</code>.</p>
<h3 id='api-reference-run-inventory-code'>inventory.code</h3>
<blockquote>
<p>Load the user&#39;s jig classes and instantiates the first one</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="c1">// Update the owner's code</span>
<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>

<span class="c1">// Find a particular class</span>
<span class="kr">const</span> <span class="nx">MyJigClass</span> <span class="o">=</span> <span class="nx">run</span><span class="p">.</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">code</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">code</span> <span class="o">=&gt;</span> <span class="nx">code</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">'MyJigClass'</span><span class="p">)</span>
</code></pre>
<p><code>code: Array&lt;function&gt;</code></p>

<p>An array of all jig classes and other code owned by the Run owner. This array is cached. To update it, call <code>run.sync()</code>.</p>
<h3 id='api-reference-run-transaction'>transaction</h3>
<p><code>transaction: Transaction</code></p>

<p>The transaction API used to build, inspect, import, and export Run bitcoin transactions. See the <a href="#api-reference-transaction">Transaction</a> API.</p>
<h3 id='api-reference-run-app'>app</h3>
<p><code>app: string</code></p>

<p>An application ID to distinguish Run transactions. Application developers may wish to set this in <code>Run</code>&#39;s constructor in order to find their specific transactions in third-party tools and analytics, like <a href="https://trends.cash">trends.cash</a> or <a href="https://www.whatsonchain.com">WhatsOnChain</a>. This string will be UTF-8 encoded and stored in the 5th chunk of the <code>op_return</code> script. For more details about the protocol, see <a href="#how-it-works">How It Works</a>.</p>

<aside class="warning">
<b>Warning:</b> Anyone may set the <code>app</code> string to anything, so it is not a secure way to find only your app's transactions.
</aside>
<h3 id='api-reference-run-activate'>activate()</h3>
<p><code>activate()</code></p>

<p>Sets this instance to <code>Run.instance</code>, the active <code>Run</code> instance. All jig instantiations, updates, and class deployments will occur on the active run instance. The owner of that instance will sign transactions and its blockchain and purse are the ones which will be used. <code>activate()</code> will also assign <code>bsv.Networks.defaultNetwork</code> to be the active Run&#39;s network configuration. </p>
<h3 id='api-reference-run-static'>static</h3>
<p>Static properties on the Run class itself.</p>
<h4 id='api-reference-run-static-configure-env-network'>configure(env, network)</h4>
<blockquote>
<p>Configure Run from the command line</p>
</blockquote>
<pre class="highlight plaintext"><code>Run.configure(process.env)
</code></pre>
<p><code>static configure(env: object, network: ?string)</code></p>

<p>Configures Run&#39;s defaults with the provided environment object. This is typically <code>process.env</code>. This provides an easy way for apps to setup dynamically Run from the shell. When a Run is instantiated, it will use these settings.</p>

<p>The network parameter is optional. If specified, it overrides the value in the environment variables. Run will pick the <code>PURSE</code> and <code>OWNER</code> keys for that specific network.</p>
<h5 id='api-reference-run-static-configure-env-network-environment-variables'>Environment variables</h5>
<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Possible Values</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><strong>APP</strong></td>
<td>App string provided to Run</td>
<td>your app string</td>
<td><code>&#39;&#39;</code></td>
</tr>
<tr>
<td><strong>LOGGER</strong></td>
<td>Whether to log internal messages to the console</td>
<td><code>true</code>, <code>false</code></td>
<td><code>false</code></td>
</tr>
<tr>
<td><strong>NETWORK</strong></td>
<td>Network string</td>
<td><code>mock</code>, <code>main</code>, <code>test</code>, <code>stn</code></td>
<td><code>mock</code></td>
</tr>
<tr>
<td><strong>PURSE</strong></td>
<td>Purse key used</td>
<td>your string privkey</td>
<td><code>undefined</code></td>
</tr>
<tr>
<td><strong>PURSE_[network]</strong></td>
<td>Purse key used on a specific network</td>
<td>your string privkey</td>
<td><code>undefined</code></td>
</tr>
<tr>
<td><strong>OWNER</strong></td>
<td>Owner key used</td>
<td>your string privkey</td>
<td><code>undefined</code></td>
</tr>
<tr>
<td><strong>OWNER_[network]</strong></td>
<td>Owner key used on a specific network</td>
<td>your string privkey</td>
<td><code>undefined</code></td>
</tr>
<tr>
<td><strong>API</strong></td>
<td>Blockchain API when using mainnet or testnet</td>
<td><code>run</code>, <code>mattercloud</code>, <code>whatsonchain</code></td>
<td><code>run</code></td>
</tr>
<tr>
<td><strong>APIKEY</strong></td>
<td>API key for the blockchain API</td>
<td>your string api key</td>
<td><code>undefined</code></td>
</tr>
<tr>
<td><strong>APIKEY_[api]</strong></td>
<td>API key used with a specific API</td>
<td>your string api key</td>
<td><code>undefined</code></td>
</tr>
</tbody></table>
<h4 id='api-reference-run-static-instance'>instance</h4>
<p><code>static instance: Run</code></p>

<p>The currently active <code>Run</code> instance. All jig instantiations, updates, and class deployments will occur on the active run instance. The owner of that instance will sign transactions and its blockchain and purse are the ones which will be used. You may change the active Run instance either by calling <code>run.activate()</code> or by creating a new <code>Run</code> instance.</p>
<h4 id='api-reference-run-static-version'>version</h4>
<p><code>static version: string</code></p>

<p>Version of the Run library</p>
<h4 id='api-reference-run-static-jig'>Jig</h4>
<blockquote>
<p>Create a custom jig that extends the Jig base class</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">MyObject</span> <span class="kr">extends</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">Jig</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre>
<p><code>static Jig: Jig</code></p>

<p><code>Jig</code> class that is common for all <code>Run</code> instances. It is set as <code>Jig</code> at the global scope. You must extend from this base class to create a jig. See <a href="#api-reference-jig">Jig</a>.</p>
<h4 id='api-reference-run-static-berry'>Berry</h4>
<p><code>static Berry: Berry</code></p>

<p><code>Berry</code> class used to define custom protocols. See <a href="#api-reference-berry">Berry</a>.</p>
<h4 id='api-reference-run-static-token'>Token</h4>
<p><code>static Token: Token</code></p>

<p><code>Token</code> class that is common for all <code>Run</code> instances. It is set as <code>Token</code> at the global scope. See <a href="#api-reference-token">Token</a>.</p>
<h4 id='api-reference-run-static-asm'>asm</h4>
<p><code>static asm: function</code></p>

<p><code>asm</code> function that may be used to generate Bitcoin scripts easily for custom owners within jigs. See <a href="#api-reference-extras-asm">asm</a>.</p>
<h4 id='api-reference-run-static-blockchainapi'>BlockchainApi</h4>
<p><code>static BlockchainApi: BlockchainApi</code></p>

<p>A REST API to connect to the Bitcoin network. See <a href="#api-reference-modules-blockchainapi">BlockchainApi</a>.</p>
<h4 id='api-reference-run-static-expect'>expect</h4>
<p><code>static expect: expect</code></p>

<p><code>expect</code> function that may be used as a dependency in Jigs to check parameters. It is is global for all <code>Run</code> instances. See <a href="#api-reference-extras-expect">expect</a>.</p>
<h4 id='api-reference-run-static-grouplock'>GroupLock</h4>
<p><code>static GroupLock: GroupLock</code></p>

<p>A lock for jigs used owned by multiple users. See <a href="#api-reference-extras-grouplock">GroupLock</a>.</p>
<h4 id='api-reference-run-static-localowner'>LocalOwner</h4>
<p><code>static LocalOwner: LocalOwner</code></p>

<p>See <a href="#api-reference-modules-localowner">LocalOwner</a>.</p>
<h4 id='api-reference-run-static-localpurse'>LocalPurse</h4>
<p><code>static LocalPurse: LocalPurse</code></p>

<p>See <a href="#api-reference-modules-localpurse">LocalPurse</a>.</p>
<h4 id='api-reference-run-static-mockchain'>Mockchain</h4>
<p><code>static Mockchain: Mockchain</code></p>

<p>See <a href="#api-reference-modules-mockchain">Mockchain</a>.</p>
<h4 id='api-reference-run-static-payserver'>PayServer</h4>
<p><code>static PayServer: PayServer</code></p>

<p>See <a href="#api-reference-modules-payserver">PayServer</a>.</p>
<h4 id='api-reference-run-static-standardlock'>StandardLock</h4>
<p><code>static StandardLock: StandardLock</code></p>

<p>A P2PKH lock used for jigs when their owners are address or public key strings. See <a href="#api-reference-extras-standardlock">StandardLock</a>.</p>
<h4 id='api-reference-run-static-statecache'>StateCache</h4>
<p><code>static StateCache: StateCache</code></p>

<p>See <a href="#api-reference-modules-statecache">StateCache</a>.</p>
<h4 id='api-reference-run-static-viewer'>Viewer</h4>
<p><code>static Viewer: Viewer</code></p>

<p>See <a href="#api-reference-modules-viewer">Viewer</a>.</p>
<h4 id='api-reference-run-static-apis'>apis</h4>
<p><code>static apis: object</code></p>

<p>An object that contains all plug-in APIs that a user may implement. See <a href="#api-reference-apis">APIs</a>.</p>
<h2 id='api-reference-jig'>Jig</h2>
<p><code>class Jig { ... }</code></p>
<h3 id='api-reference-jig-init'>init()</h3>
<blockquote>
<p>Simple jig that takes two parameters in its constructor</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">SimpleStore</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">a</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">b</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimpleStore</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">store</span><span class="p">.</span><span class="nx">b</span><span class="p">)</span> <span class="c1">// prints 2</span>
</code></pre>
<p><code>init(): Jig</code></p>

<p><code>init()</code> is equivalent in jigs to <code>constructor()</code> for regular classes. The user may pass parameters to it and call <code>super.init()</code> to call parent constructors. <code>init()</code> may not be called directly by users because Run will call it automatically when the class is instantiated. Also, jigs are not allowed to have a <code>constructor()</code> method because <code>init()</code> is used instead.</p>
<h3 id='api-reference-jig-sync'>sync()</h3>
<p><code>sync(options: ?object): Promise&lt;void&gt;</code></p>

<p>Synchronizes this jig with the blockchain by waiting for all pending transactions to publish and updating the jig with any new transactions from the network. If you pass <code>{ forward: false }</code>, then only the pending transactions will be published and a new state won&#39;t need download. This may be useful for performance or if the Blockchain API does not support forward syncing, as is the case with WhatsOnChain.</p>
<h3 id='api-reference-jig-origin'>origin</h3>
<blockquote>
<p>Two different tickets have different origins</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Ticket</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span> <span class="p">}</span>
<span class="kr">const</span> <span class="nx">ticket1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Ticket</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">ticket2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Ticket</span><span class="p">()</span>
<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>
<span class="c1">// ticket1.origin !== ticket2.origin</span>
</code></pre>
<p><code>origin: string</code></p>

<p>The unique blockchain location where the jig was initially deployed distinguishing the jig from all others. The format is <code>TXID_oN</code> where <code>TXID</code> is the bitcoin transaction ID where the jig was first deployed. <code>o</code> is shorthand for <em>output</em> and <code>N</code> is the zero-based index for the P2PKH output representing this jig. The origin is set automatically by Run after deploying the jig and it becomes read-only afterward. Jig methods may internally read the origin anytime after it is initially published.</p>
<h3 id='api-reference-jig-location'>location</h3>
<blockquote>
<p>The value of <code>location</code> changes with every update</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Weapon</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">upgrade</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">upgraded</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="k">return</span> <span class="k">this</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">weapon</span> <span class="o">=</span> <span class="nx">await</span> <span class="k">new</span> <span class="nx">Weapon</span><span class="p">().</span><span class="nx">sync</span><span class="p">()</span>
<span class="c1">// weapon.origin === weapon.location</span>
<span class="nx">await</span> <span class="nx">weapon</span><span class="p">.</span><span class="nx">uprade</span><span class="p">().</span><span class="nx">sync</span><span class="p">()</span>
<span class="c1">// weapon.origin !== weapon.location</span>
</code></pre>
<p><code>location: string</code></p>

<p>The blockchain location representing the current state of the jig. This is a P2PKH output and is in the same form as <code>origin</code>. However, unlike <code>origin</code>, <code>location</code> will update with every state change on the jig.</p>

<p>When there is a pending change, reading <code>location</code> will throw an error. This is because the Bitcoin transaction id is not yet known. The user should call <code>sync</code> first to avoid this error. Finally, note that this is a read-only property that Run updates for you, and it may only be read outside of jig methods.</p>
<h3 id='api-reference-jig-owner'>owner</h3>
<blockquote>
<p>Sending a jig to a new owner</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Item</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">send</span><span class="p">(</span><span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">owner</span> <span class="o">=</span> <span class="nx">to</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Item</span><span class="p">()</span>
<span class="nx">item</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">'0261b44db219de925b85e8f26cbfe551e31bf25678b8ff9512bca03aea218e9258'</span><span class="p">)</span>
</code></pre>
<p><code>owner: string|Lock</code></p>

<p>The owner is either a Bitcoin address string, a public key in hex, or a custom <a href="#api-reference-apis-lock">Lock</a> that creates an output script. The jig may change this property to change owners, but it is read-only from outside the jig.</p>
<h3 id='api-reference-jig-satoshis'>satoshis</h3>
<blockquote>
<p>Backing a jig with Bitcoin</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Item</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">back</span><span class="p">(</span><span class="nx">satoshis</span><span class="p">)</span> <span class="p">{</span> 
    <span class="k">this</span><span class="p">.</span><span class="nx">satoshis</span> <span class="o">=</span> <span class="nx">satoshis</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p><code>satoshis: number</code></p>

<p>This number represents the amount of Bitcoin in satoshis that are backing this jig. It may be increased or decreased but it may not be set below zero. Increasing this value will deposit Bitcoin into the output for the jig from the Run purse. Decreasing it will withdraw Bitcoin to the Run purse. It may only be changed from within a Jig. If the satoshi value in the output is less than the value in the jig, the jig is automatically invalidated.</p>
<h3 id='api-reference-jig-static-deps'>static deps</h3>
<p><code>static deps: ?object</code></p>

<p>The jig class dependencies. By default, jigs execute in a secure sandbox that is isolated from other classes. However, these dependencies will be available in the global scope.</p>
<h2 id='api-reference-berry'>Berry</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">TwetchPost</span> <span class="kr">extends</span> <span class="nx">Berry</span> <span class="p">{</span>
    <span class="nx">init</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="nx">text</span>
    <span class="p">}</span>

    <span class="kr">static</span> <span class="nx">async</span> <span class="nx">pluck</span><span class="p">(</span><span class="nx">location</span><span class="p">,</span> <span class="nx">fetch</span><span class="p">,</span> <span class="nx">pluck</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">txo</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">location</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">txo</span><span class="p">.</span><span class="nx">out</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s2</span> <span class="o">===</span> <span class="s1">'19HxigV4QyBv3tHpQVcUEQyq1pzZVdoAut'</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// B protocol</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">TwetchPost</span><span class="p">(</span><span class="nx">txo</span><span class="p">.</span><span class="nx">out</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s3</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p><code>class Berry { ... }</code></p>

<p>Berry base class that custom third-party protocols use. It is loaded using a protocol. Berries are stateless and frozen after they are loaded.</p>
<h3 id='api-reference-berry-location'>location</h3>
<p><code>location: string</code></p>

<p>Berry location. This is automatically set by Run.</p>
<h3 id='api-reference-berry-static-pluck-location-fetch-pluck'>static pluck(location, fetch, pluck)</h3>
<p><code>pluck(location: string, fetch: function, pluck: function)</code></p>

<p>Plucks a berry from the blockchain. The protocol should fetch the transaction using <code>async fetch()</code>. This will return a <code>txo</code> object in Planaria Corp&#39;s <a href="https://medium.com/@_unwriter/txo-2-0-fee049bc6795">txo format</a>. Then it should instantiate a new Berry of the appropriate type with the data fetched. If additional berries are required to build this one, they may be plucked recursively using <code>async pluck()</code></p>
<h2 id='api-reference-token'>Token</h2>
<p><code>class Token extends Jig { ... }</code></p>

<p><code>Token</code> is a jig for fungible tokens similar to ERC-20 or SLP. It may be used for shares, loyalty points, gift cards, and more. Each <code>Token</code> instance defines a numerical amount held by its owner. You extend from <code>Token</code> to define a new kind of token. As the owner of this new token <em>class</em>, only you can mint new token instances. The token instances you mint though may be sent, owned, and even combined together by others.</p>

<p><code>Token</code> supports integer amounts like ERC-20 in its <code>amount</code> field. However, oftentimes you may wish to display the token&#39;s amount with a decimal, like <code>1.50</code>. The <code>static decimals</code> property may be used to declare how the Token&#39;s amount is to be displayed, and the <code>value</code> property returns the amount shifted by the decimal places. In this example, <code>amount</code> would be 150 and <code>decimals</code> would be 2.</p>

<p><code>Token</code> may be accessed via <code>Run.Token</code>.</p>
<h3 id='api-reference-token-constructor-amount'>constructor(amount)</h3>
<blockquote>
<p>Minting a new token</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">MyCustomToken</span> <span class="kr">extends</span> <span class="nx">Token</span> <span class="p">{</span> <span class="p">}</span>

<span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyCustomToken</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</code></pre>
<p><code>init(amount: number): Token</code></p>

<p><code>init()</code> mints a new token with a specified amount. Only the owner of the extended token class is able to call this method.</p>
<h3 id='api-reference-token-send-to-amount'>send(to, amount)</h3><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyCustomToken</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">change</span> <span class="o">=</span> <span class="nx">token</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">pubkey</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">token</span><span class="p">.</span><span class="nx">amount</span><span class="p">)</span> <span class="c1">// 20</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">change</span><span class="p">.</span><span class="nx">amount</span><span class="p">)</span> <span class="c1">// 80</span>
</code></pre>
<p><code>send(to: string, amount: ?number): Token</code></p>

<p>Sends this token to another user. If the <code>amount</code> specified is less than the <code>amount</code> in the token, then a change token will be returned back to the current owner. If the <code>amount</code> is not specified, then the entire token is sent and the return value is <code>null</code>.</p>
<h3 id='api-reference-token-amount'>amount</h3>
<p><code>amount: number</code></p>

<p>The integer value held within this token. The meaning of <code>amount</code> depends on the token.</p>
<h3 id='api-reference-token-value'>value</h3>
<p><code>value: number</code></p>

<p>The amount contained in this token shifted by <code>Token.decimals</code>.</p>
<h3 id='api-reference-token-static-combine-tokens'>static combine(...tokens)</h3>
<blockquote>
<p>Combining three tokens newly minted</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">token1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyCustomToken</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">token2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyCustomToken</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">token3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyCustomToken</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">combined</span> <span class="o">=</span> <span class="nx">MyCustomToken</span><span class="p">.</span><span class="nx">combine</span><span class="p">(</span><span class="nx">token1</span><span class="p">,</span> <span class="nx">token2</span><span class="p">,</span> <span class="nx">token3</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">combine</span><span class="p">.</span><span class="nx">amount</span><span class="p">)</span> <span class="c1">// 60</span>
</code></pre>
<blockquote>
<p>Combining and sending tokens in a single transaction</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">begin</span><span class="p">()</span>

<span class="kr">const</span> <span class="nx">tokens</span> <span class="o">=</span> <span class="nx">run</span><span class="p">.</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">jigs</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">jig</span> <span class="o">=&gt;</span> <span class="nx">jig</span> <span class="k">instanceof</span> <span class="nx">MyCustomToken</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">combined</span> <span class="o">=</span> <span class="nx">MyCustomToken</span><span class="p">.</span><span class="nx">combine</span><span class="p">(...</span><span class="nx">tokens</span><span class="p">)</span>

<span class="nx">combined</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">pubkey</span><span class="p">,</span> <span class="nx">amount</span><span class="p">)</span>

<span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
</code></pre>
<p><code>static combine(...tokens: Token): Token</code></p>

<p><code>combine</code> will merge the multiple tokens into a single token that has the the combined amount. The tokens to combine must all be the same kind and the returned token object will be an instance of that same class too.</p>

<p>Tokens are like Bitcoin outputs. Every time you send some tokens, you split off an amount into a new output. Just like Bitcoins, you may later want to merge them back together. It is often useful to do this right before sending your tokens so that you can send their full amount. The example on the right shows how to combine and send tokens in a single transaction.</p>
<h3 id='api-reference-token-static-decimals'>static decimals</h3><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">USDToken</span> <span class="kr">extends</span> <span class="nx">Token</span> <span class="p">{</span> <span class="p">}</span>

<span class="nx">USDToken</span><span class="p">.</span><span class="nx">decimals</span> <span class="o">=</span> <span class="mi">2</span>

<span class="kr">const</span> <span class="nx">dollars</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">USDToken</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">dollars</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="c1">// 1.00</span>
</code></pre>
<p><code>static decimals: number</code></p>

<p>The number of decimal places to shift the <code>amount</code> when displaying it. <code>Token</code> uses integers by default for precision, just like ERC-20, but often times you will want to specify a decimals value to indicate a unit for display to the user. For example, a US Dollar coin might set decimals to 2 so that the base amount is cents but the display value is dollars. The <code>value</code> property will return <code>amount</code> shifted by this number of decimals.</p>
<h2 id='api-reference-transaction'>Transaction</h2>
<p><code>class Transaction { ... }</code></p>

<p>The Transaction API allows you to manipulate the current Bitcoin transaction being built by Run. This class is instantiated automatically for you with each Run instance, and it is accessible via <code>run.transaction</code>. It allows you to:</p>

<ul>
<li>Batch many jig updates together</li>
<li>Load and inspect transactions</li>
<li>Export transactions for others to co-sign</li>
<li>Sign transactions involving your jigs</li>
<li>Propose atomic swaps and other updates that involve multiple parties</li>
</ul>

<p>Normally, when you are updating a jig that you own, Run will begin a transaction for you automatically. However, you can take control of this process by calling <code>begin</code> yourself. This starts a new transaction, and any updates you perform after <code>begin</code> will not be broadcasted until you call <code>end</code>. Alternatively, you may cancel the updates by calling <code>rollback</code> or export the Bitcoin transaction by calling <code>export</code>.</p>

<p>Other parties may load your exported transaction by calling <code>import</code> and then inspect its contents using <code>actions</code>. If they approve of the updates to their jigs, they may call <code>sign</code> and then <code>end</code> to broadcast the transaction.</p>
<h3 id='api-reference-transaction-begin'>begin()</h3>
<blockquote>
<p>Create a counter and increment it twice in one transaction</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">begin</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">counter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Counter</span><span class="p">()</span>
<span class="nx">counter</span><span class="p">.</span><span class="nx">inc</span><span class="p">()</span>
<span class="nx">counter</span><span class="p">.</span><span class="nx">inc</span><span class="p">()</span>
<span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
</code></pre>
<p><code>begin()</code></p>

<p>Begins a batch transaction. All jig instantiations and updates will be delayed until <code>end</code> is called, at which point a single transaction that combines all previous actions will be published. Using batch transactions will reduce transaction size and per-action cost when there are multiple actions. Transactions may also be nested and only when the final <code>end</code> is called will the transaction be published.</p>

<aside class="notice">
<b>Note:</b> If the transaction fails to post, then all actions in the batch are reverted.
</aside>
<h3 id='api-reference-transaction-end'>end()</h3>
<p><code>end()</code></p>

<p>Ends a previous batch transaction started with <code>begin</code> and adds it to a background queue to submit to the blockchain.</p>
<h3 id='api-reference-transaction-export'>export()</h3>
<p><code>export(): bsv.Transaction</code></p>

<p>Exports the in-progress transaction created via <code>begin()</code> or loaded via `import().</p>
<h3 id='api-reference-transaction-import'>import()</h3>
<p><code>import(tx: bsv.Transaction): Promise&lt;void&gt;</code></p>

<p>Imports a transaction into Run to be updated or broadcasted. If the transaction is not a valid Run transaction, then this method will throw an error.</p>
<h3 id='api-reference-transaction-rollback'>rollback()</h3><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Store</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">set</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Store</span><span class="p">()</span>

<span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">begin</span><span class="p">()</span>

<span class="nx">store</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'Hello, world'</span><span class="p">)</span>

<span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">rollback</span><span class="p">()</span>

<span class="c1">// store.value is undefined again</span>
</code></pre>
<p><code>rollback()</code></p>

<p>Reverts all updates in the current transaction which must be started with <code>begin</code> or loaded with <code>import</code>. Any classes to be deployed will have their origins and locations cleared, and any jigs to be updated will revert to their prior state. Any jigs that are deployed for their first time will be reverted to an invalid state where they may no longer be used. If no transaction is in progress, then this method throws an error. You cannot roll back actions that were not part of a transaction created with <code>begin</code> or <code>import</code>.</p>
<h3 id='api-reference-transaction-pay'>pay()</h3>
<p><code>pay(): Promise&lt;void&gt;</code></p>

<p>Pays for the current transaction. This is performed automatically when <code>end()</code> is called, but if the transaction is exported, then the user must explicitely call <code>pay()</code> before signing the transaction. If any additional updates are made to the transaction, including calling jig methods or deploying new code, then the transaction must be paid for again.</p>
<h3 id='api-reference-transaction-sign'>sign()</h3>
<p><code>sign(): Promise&lt;void&gt;</code></p>

<p>Signs all updates involved in the current transaction using the current Run owner. The transaction should only be signed after all updates are made, and the transaction has been paid for via <code>pay()</code>. After all required signatures are added, then the transaction may be broadcasted, and if the transaction requires signatures from multiple different owners, then it must exported and imported by other parties to be signed. If any additional updates are made to the transaction, including calling jig methods or deploying new code, then the signatures are reset and the transaction must be paid for again and re-signed by all parties.</p>
<h3 id='api-reference-transaction-actions'>actions</h3>
<p><code>actions: Array&lt;{ target: Jig, method: string, args: Array&lt;any&gt; }&gt;</code></p>

<p>The jig updates performed in this transaction.</p>
<h2 id='api-reference-modules'>Modules</h2><h3 id='api-reference-modules-blockchainapi'>BlockchainApi</h3>
<blockquote>
<p>Connect to MatterCloud with a 1 second timeout</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">blockchain</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">BlockchainApi</span><span class="p">({</span>
  <span class="na">api</span><span class="p">:</span> <span class="s1">'mattercloud'</span><span class="p">,</span>
  <span class="na">apiKey</span><span class="p">:</span> <span class="nx">myApiKey</span><span class="p">,</span>
  <span class="na">timeout</span><span class="p">:</span> <span class="mi">1000</span>
<span class="p">})</span>

<span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="nx">blockchain</span> <span class="p">})</span>
</code></pre>
<p><code>class BlockchainApi implements Blockchain { ... }</code></p>

<p>A <a href="#api-reference-apis-blockchain">Blockchain</a> implementation that connects to a remote REST API server. This class supports three blockchain APIs by default: MatterCloud, WhatsOnChain, and Run&#39;s which is the default. When you create a <code>Run</code> instance on mainnet or testnet, Run will automatically create a <code>BlockchainApi</code> for you, but you may wish to create one yourself to customize its settings.</p>

<p><code>BlockchainApi</code> may be accessed via <code>Run.BlockchainApi</code>.</p>
<h4 id='api-reference-modules-blockchainapi-constructor-options'>constructor(options)</h4>
<p><code>constructor(options: object): BlockchainApi</code></p>

<p>Creates a <code>BlockchainApi</code> with the provided configuration.</p>
<h5 id='api-reference-modules-blockchainapi-constructor-options-options'>Options</h5>
<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code>network</code></td>
<td>string</td>
<td>Either main or test</td>
<td>main</td>
</tr>
<tr>
<td><code>api</code></td>
<td>string</td>
<td>One of mattercloud, whatsonchain, or run</td>
<td>run</td>
</tr>
<tr>
<td><code>apiKey</code></td>
<td>string</td>
<td>API key to use. Currently, only MatterCloud API supports this option.</td>
<td>undefined</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td>number</td>
<td>Timeout in milliseconds for network requests</td>
<td>10000</td>
</tr>
</tbody></table>
<h3 id='api-reference-modules-localowner'>LocalOwner</h3>
<p><code>class LocalOwner implements Owner { ... }</code></p>

<p>The default <a href="#api-reference-apis-owner">Owner</a> implementation that uses a local private key to sign transactions. It is able to sign both standard locks (including addresses and public key strings) as well as group locks.</p>

<p><code>LocalOwner</code> may be accessed via <code>Run.LocalOwner</code>.</p>
<h4 id='api-reference-modules-localowner-constructor-options'>constructor(options)</h4>
<p><code>constructor(options: object): LocalOwner</code></p>

<p>Creates a <code>LocalOwner</code> with the provided configuration.</p>
<h5 id='api-reference-modules-localowner-constructor-options-options'>Options</h5>
<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code>privkey</code></td>
<td>string or bsv.PrivateKey</td>
<td>Private key used to own jigs and other resources</td>
<td>Randomly generated</td>
</tr>
<tr>
<td><code>blockchain</code></td>
<td><code>Blockchain</code></td>
<td>Blockchain used to query UTXOs. If none is specified, then the inventory will not be synced.</td>
<td>None</td>
</tr>
</tbody></table>
<h3 id='api-reference-modules-localpurse'>LocalPurse</h3>
<p><code>class LocalPurse implements Purse { ... }</code></p>

<p>The purse that Run uses by default to pay for transactions using a local wallet. This is an implementation of the <code>Purse</code> API.</p>

<p><code>LocalPurse</code> may be accessed via <code>Run.LocalPurse</code>.</p>
<h4 id='api-reference-modules-localpurse-constructor-options'>constructor(options)</h4>
<p><code>constructor(options: object): LocalPurse</code></p>

<p>Creates a <code>LocalPurse</code> with the provided configuration.</p>
<h5 id='api-reference-modules-localpurse-constructor-options-options'>Options</h5>
<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code>privkey</code></td>
<td>string or bsv.PrivateKey</td>
<td>Private key used to own jigs and other resources</td>
<td><strong>Required</strong></td>
</tr>
<tr>
<td><code>blockchain</code></td>
<td><code>Blockchain</code></td>
<td>Blockchain used to query UTXOs</td>
<td><strong>Required</strong></td>
</tr>
<tr>
<td><code>splits</code></td>
<td>number</td>
<td>Number of UTXO splits to reduce mempool chain issues</td>
<td>10</td>
</tr>
<tr>
<td><code>feePerKb</code></td>
<td>number</td>
<td>Transaction fee in satoshis per kilobyte</td>
<td>1000</td>
</tr>
</tbody></table>
<h4 id='api-reference-modules-localpurse-privkey'>privkey</h4>
<p><code>privkey: string</code></p>

<p>Private key used to sign the transaction.</p>
<h4 id='api-reference-modules-localpurse-address'>address</h4>
<p><code>address: string</code></p>

<p>Address used to find UTXOs and receive payments.</p>
<h4 id='api-reference-modules-localpurse-splits'>splits</h4>
<blockquote>
<p>Change the number of purse UTXO splits</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">run</span><span class="p">.</span><span class="nx">purse</span><span class="p">.</span><span class="nx">splits</span> <span class="o">=</span> <span class="mi">100</span>
</code></pre>
<p><code>splits: number</code></p>

<p>The minimum number of UTXOs that the purse must have. If the number of UTXOs is less than this value, then Run will automatically split your UTXOs the next time a Run transaction is generated. The default value for <code>splits</code> is 10.</p>

<p>Increasing this value may avoid the <code>too-long-mempool-chain</code> error. For more information, see <a href="#advanced-usage-debugging-tips">Debugging Tips</a>.</p>
<h4 id='api-reference-modules-localpurse-balance'>balance()</h4>
<blockquote>
<p>Querying the current balance</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Satoshis'</span><span class="p">,</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">purse</span><span class="p">.</span><span class="nx">balance</span><span class="p">())</span>
</code></pre>
<p><code>balance(): Promise&lt;number&gt;</code></p>

<p>Returns a promise that resolves to the current balance in satoshis of this purse. This is the sum of all satoshis in this purse&#39;s unspent outputs.</p>
<h4 id='api-reference-modules-localpurse-utxos'>utxos()</h4>
<blockquote>
<p>Building a transaction using the purse</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">utxos</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">purse</span><span class="p">.</span><span class="nx">utxos</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">bsv</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">().</span><span class="nx">from</span><span class="p">(</span><span class="nx">utxos</span><span class="p">).</span><span class="nx">change</span><span class="p">(</span><span class="nx">run</span><span class="p">.</span><span class="nx">purse</span><span class="p">.</span><span class="nx">address</span><span class="p">).</span><span class="nx">sign</span><span class="p">(</span><span class="nx">run</span><span class="p">.</span><span class="nx">purse</span><span class="p">.</span><span class="nx">privateKey</span><span class="p">)</span>
</code></pre>
<p><code>utxos(): Promise&lt;{txid: string, vout: number, script: bsv.Script, satoshis: number}&gt;</code></p>

<p>Returns a promise that resolves to the current UTXOs of this purse.</p>
<h3 id='api-reference-modules-mockchain'>Mockchain</h3>
<blockquote>
<p>Getting the mockchain from a run instance</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">network</span><span class="p">:</span> <span class="s1">'mock'</span> <span class="p">})</span>

<span class="kr">const</span> <span class="nx">mockchain</span> <span class="o">=</span> <span class="nx">run</span><span class="p">.</span><span class="nx">blockchain</span>
</code></pre>
<blockquote>
<p>Creating a mockchain manually and passing it into <code>Run</code></p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">mockchain</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">Mockchain</span><span class="p">()</span>

<span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">blockchain</span><span class="p">:</span> <span class="nx">mockchain</span> <span class="p">})</span>
</code></pre>
<p><code>class Mockchain implements Blockchain { ... }</code></p>

<p>The <em>mockchain</em> is a local simulation of a blockchain that stored entirely in memory. It accepts and validates real Bitcoin transactions using testnet settings. The mockchain simulates many aspects of a real Bitcoin API, including the 25 chained mempool limit, but everything happens locally.</p>

<p>We recommend using the mockchain during development and unit testing. The mockchain lets you simulate Run without requiring network connectivity and without spending real bitcoins. Note that when the program closes however, all mockchain data is lost, so it is not a substitute for a real network.</p>

<p>The class is accessible via <code>Run.Mockchain</code>, or as an instance in <code>run.blockchain</code> after setting the network to <code>mock</code>.</p>
<h4 id='api-reference-modules-mockchain-constructor'>constructor()</h4>
<p><code>constructor()</code></p>

<p>Creates a new mockchain. There are no parameters.</p>
<h4 id='api-reference-modules-mockchain-fund-address-satoshis'>fund(address, satoshis)</h4>
<p><code>fund(address: string, satoshis: number)</code></p>

<p>Directly funds an address with an amount of satoshis without requiring the spending of any inputs. The Run class will automatically fund the initial purse, but you may fund additional addresses using this method.</p>
<h4 id='api-reference-modules-mockchain-block'>block()</h4>
<p><code>block()</code></p>

<p>Creates a new simulated block. This is useful when the 25 chained mempool limit is hit.</p>
<h3 id='api-reference-modules-payserver'>PayServer</h3>
<blockquote>
<p>Create Run and use the testnet pay server</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">apiKey</span> <span class="o">=</span> <span class="s1">'&lt;your-api-key&gt;'</span>
<span class="kr">const</span> <span class="nx">payServer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">PayServer</span><span class="p">(</span><span class="nx">apiKey</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">network</span><span class="p">:</span> <span class="s1">'test'</span><span class="p">,</span> <span class="na">purse</span><span class="p">:</span> <span class="nx">payServer</span> <span class="p">})</span>
</code></pre>
<p><code>class PayServer implements Purse { ... }</code></p>

<p>A Purse implementation that uses the Run Pay Server to pay for transactions.</p>

<p><code>PayServer</code> may be accessed via <code>Run.PayServer</code>.</p>
<h4 id='api-reference-modules-payserver-constructor-apikey'>constructor(apiKey)</h4>
<p><code>constructor(apiKey: string)</code></p>

<p>Creates the PayServer with a given API key. The API key may be generated via <code>https://api.run.network/v1/test/pay/generate</code>. Only testnet is supported today.</p>
<h3 id='api-reference-modules-statecache'>StateCache</h3>
<p><code>class StateCache implements State { ... }</code></p>

<p>The default implementation of the <code>State</code> API. The <code>Run</code> class will create one automatically if no state class is provided. The <code>StateCache</code> stores jig state data in an LRU cache in local memory. The default size is 10MB.</p>

<p><code>StateCache</code> may be accessed via <code>Run.StateCache</code>.</p>
<h4 id='api-reference-modules-statecache-constructor-options'>constructor(options)</h4>
<p><code>constructor(options: ?object)</code></p>

<p>Creates the state cache. The options object may be used to configure the cache.</p>
<h5 id='api-reference-modules-statecache-constructor-options-options'>Options</h5>
<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code>maxSizeMB</code></td>
<td>number</td>
<td>Max size in megabytes (MB) of the state data stored in memory</td>
<td>10 (10MB)</td>
</tr>
</tbody></table>
<h3 id='api-reference-modules-viewer'>Viewer</h3>
<blockquote>
<p>Load the jigs owned by another user</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">viewer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">Viewer</span><span class="p">(</span><span class="nx">customLock</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">owner</span><span class="p">:</span> <span class="nx">viewer</span> <span class="p">})</span>

<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>

<span class="c1">// run.owner.jigs will contain their jigs</span>
</code></pre>
<p><code>class Viewer implements Owner</code></p>

<p>An Owner implementation for loading another user&#39;s jigs.</p>

<p>These resources will be read-only and this owner will not be able to sign for any updates.</p>

<p><code>Viewer</code> may be accessed via <code>Run.Viewer</code>.</p>
<h4 id='api-reference-modules-viewer-constructor-owner'>constructor(owner)</h4>
<p><code>constructor(owner: string|Lock)</code></p>

<p>Creates a new viewer.</p>
<h2 id='api-reference-extras'>Extras</h2><h3 id='api-reference-extras-asm'>asm</h3>
<blockquote>
<p>Create a custom R-puzzle output script</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">asm</span><span class="p">(</span><span class="s2">`OP_DUP OP_3 OP_SPLIT OP_NIP OP_1 OP_SPLIT OP_SWAP OP_SPLIT OP_DROP OP_HASH160 </span><span class="p">${</span><span class="nx">rhash</span><span class="p">}</span><span class="s2"> OP_EQUALVERIFY OP_OVER OP_CHECKSIGVERIFY OP_CHECKSIG`</span><span class="p">)</span>
</code></pre>
<p><code>function asm(s: string): Uint8Array</code></p>

<p>Converts a Bitcoin script string in ASM notation into a Uint8Array. This code is deterministic and safe to use within Jigs. It is often useful when creating <a href="#advanced-usage-locks">custom owner locks</a>.</p>

<p><code>asm</code> may be accessed via <code>Run.asm</code>.</p>
<h3 id='api-reference-extras-expect'>expect</h3><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Post</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">message</span><span class="p">).</span><span class="nx">toBeString</span><span class="p">()</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">message</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">Post</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="na">expect</span><span class="p">:</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">expect</span> <span class="p">}</span>
</code></pre>
<p><code>function expect(subject) { ... }</code></p>

<p>The <code>expect</code> function is arbitrary code to help you check with parameters in Jigs. It is similar to Jest or Chai assertions. <code>expect</code> takes a single argument, <em>subject</em>, and then lets you execute one of its assertion methods on ithe subject. If the assertion passes, then nothing happens, but if it fails, an Error is thrown.</p>

<p>Each method takes an optional last parameter <em>message</em> that is the error message to throw. If none is specified, then a default error message will be created.</p>

<p><code>expect</code> may be accessed via <code>Run.expect</code>.</p>
<h4 id='api-reference-extras-expect-not'>.not</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">name</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toBeNumber</span><span class="p">()</span>
</code></pre>
<p><code>.not</code></p>

<p>The <code>not</code> property reverses the condition of any methods that follow.</p>
<h4 id='api-reference-extras-expect-tobe'>.toBe()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">power</span> <span class="o">&gt;</span> <span class="mi">9999</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</code></pre>
<p><code>.toBe(value: any, message: ?string)</code></p>

<p>Checks that the <em>subject</em> is equal to the <em>value</em>, using the javascript === operator. This does not, however, deeply compare values of an object, so for deep object comparison we recommend <code>toEqual</code>.</p>
<h4 id='api-reference-extras-expect-toequal'>.toEqual()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">names</span><span class="p">).</span><span class="nx">toBe</span><span class="p">([</span><span class="s1">'Stevie'</span><span class="p">,</span> <span class="s1">'Wonder'</span><span class="p">])</span>
</code></pre>
<p><code>.toEqual(value: any, message: ?string)</code></p>

<p>Deeply compares the <em>subject</em> to a <em>value</em>, which involves recursively traversing through every sub-property of objects to compare whether they are the same primitive values.</p>
<h4 id='api-reference-extras-expect-tobeinstanceof'>.toBeInstanceOf()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">dragon</span><span class="p">).</span><span class="nx">toBeInstanceOf</span><span class="p">(</span><span class="nx">Dragon</span><span class="p">)</span>
</code></pre>
<p><code>.toBeInstanceOf(Class: Class, message: ?string)</code></p>

<p>Checks that an object is an instance of a class or one of its parents.</p>
<h4 id='api-reference-extras-expect-tobedefined'>.toBeDefined()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">message</span><span class="p">).</span><span class="nx">toBeDefined</span><span class="p">()</span>
</code></pre>
<p><code>.toBeDefined(message: ?string)</code></p>

<p>Checks that a <em>value</em> is not undefined.</p>
<h4 id='api-reference-extras-expect-tobenull'>.toBeNull()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">hat</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toBeNull</span><span class="p">()</span>
</code></pre>
<p><code>.toBeNull(message: ?string)</code></p>

<p>Checks that a <em>value</em> is null. Often this is paired with <code>not</code> to check that a value is not null, as seen on the right.</p>
<h4 id='api-reference-extras-expect-tobenumber'>.toBeNumber()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">health</span><span class="p">).</span><span class="nx">toBeNumber</span><span class="p">()</span>
</code></pre>
<p><code>.toBeNumber(message: ?string)</code></p>

<p>Checks that a <em>value</em> is a numerical type. Numbers including all integers, floating point numbers, NaN, and Infinity.</p>
<h4 id='api-reference-extras-expect-tobeinteger'>.toBeInteger()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">amount</span><span class="p">).</span><span class="nx">toBeInteger</span><span class="p">()</span>
</code></pre>
<p><code>.toBeInteger(message: ?string)</code></p>

<p>Checks that a <em>value</em> is an integer number and does not have a decimal point.</p>
<h4 id='api-reference-extras-expect-tobelessthan'>.toBeLessThan()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">damage</span><span class="p">).</span><span class="nx">toBeLessThan</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</code></pre>
<p><code>.toBeLessThan(value: number, message: ?string)</code></p>

<p>Checks that a <em>value</em> is a number less than a particular number.</p>
<h4 id='api-reference-extras-expect-tobelessthanorequalto'>.toBeLessThanOrEqualTo()</h4>
<p><code>.toBeLessThanOrEqualTo(value: number, message: ?string)</code></p>

<p>Checks that a <em>value</em> is a number less than or equal to a particular number.</p>
<h4 id='api-reference-extras-expect-tobegreaterthan'>.toBeGreaterThan()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span><span class="p">).</span><span class="nx">toBeGreaterThan</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre>
<p><code>.toBeGreaterThan(value: number, message: ?string)</code></p>

<p>Checks that a <em>value</em> is a number greater than a particular number.</p>
<h4 id='api-reference-extras-expect-tobegreaterthanorequalto'>.toBeGreaterThanOrEqualTo()</h4>
<p><code>.toBeGreaterThanOrEqualTo(value: number, message: ?string)</code></p>

<p>Checks that a <em>value</em> is a number greater than or equal to a particular number.</p>
<h4 id='api-reference-extras-expect-tobeboolean'>.toBeBoolean()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">weaponsEnabled</span><span class="p">).</span><span class="nx">toBeBoolean</span><span class="p">()</span>
</code></pre>
<p><code>.toBeBoolean(message: ?string)</code></p>

<p>Checks that a <em>value</em> is either true or false.</p>
<h4 id='api-reference-extras-expect-tobestring'>.toBeString()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">name</span><span class="p">).</span><span class="nx">toBeString</span><span class="p">()</span>
</code></pre>
<p><code>.toBeString(message: ?string)</code></p>

<p>Checks that a <em>value</em> is a string. It may still be the empty string however.</p>
<h4 id='api-reference-extras-expect-tobeobject'>.toBeObject()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">properties</span><span class="p">).</span><span class="nx">toBeObject</span><span class="p">()</span>
</code></pre>
<p><code>.toBeObject(message: ?string)</code></p>

<p>Checks that a <em>value</em> is a non-null object or an Array. </p>
<h4 id='api-reference-extras-expect-tobearray'>.toBeArray()</h4><pre class="highlight plaintext"><code>expect(tokens).toBeArray()
</code></pre>
<p><code>.toBeArray(message: ?string)</code></p>

<p>Checks that a <em>value</em> is an array and is not null. It may however be empty.</p>
<h4 id='api-reference-extras-expect-tobeclass'>.toBeClass()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">Dragon</span><span class="p">).</span><span class="nx">toBeClass</span><span class="p">()</span>
</code></pre>
<p><code>.toBeClass(message: ?string)</code></p>

<p>Checks that a type is a class.</p>
<h4 id='api-reference-extras-expect-tobefunction'>.toBeFunction()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">calculateDamage</span><span class="p">).</span><span class="nx">toBeFunction</span><span class="p">()</span>
</code></pre>
<p><code>.toBeFunction(message: ?string)</code></p>

<p>Checks that a type is a function. Classes are not considered functions for this assert.</p>
<h3 id='api-reference-extras-grouplock'>GroupLock</h3>
<blockquote>
<p>Create and then sign a 2-2 multi-sig</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="c1">// Create a token owned by a 2-3 multi-sig</span>
<span class="nx">token</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">GroupLock</span><span class="p">([</span><span class="nx">pubkey1</span><span class="p">,</span> <span class="nx">pubkey2</span><span class="p">,</span> <span class="nx">pubkey3</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1">// Begin a transaction to spend it and sign with key #1</span>
<span class="kr">const</span> <span class="nx">run1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">owner</span><span class="p">:</span> <span class="nx">privkey1</span> <span class="p">})</span>
<span class="nx">run1</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">begin</span><span class="p">()</span>
<span class="nx">token</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">address</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">run1</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">pay</span><span class="p">()</span>
<span class="nx">await</span> <span class="nx">run1</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">sign</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="nx">run1</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="kr">export</span><span class="p">()</span>
<span class="nx">run1</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">rollback</span><span class="p">()</span>

<span class="c1">// On another machine, import the transaction and co-sign with key #2</span>
<span class="kr">const</span> <span class="nx">run2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">owner</span><span class="p">:</span> <span class="nx">privkey2</span> <span class="p">})</span>
<span class="nx">await</span> <span class="nx">run2</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="kr">import</span><span class="p">(</span><span class="nx">tx</span><span class="p">)</span>
<span class="nx">run2</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
</code></pre>
<p><code>class GroupLock implements Lock { ... }</code></p>

<p>A group lock is a m-of-n multi-sig output used to have more than one user own a resource. Combined with the <code>LocalOwner</code> and <code>TransactionAPI</code>, Run is able to sign group locks using its default <code>LocalOwner</code>. See the example to the right.</p>

<p>A <code>GroupLock</code> is as secure as bitcoins themselves. If some parties can update a jig, they can also destroy the jig.</p>

<p><code>GroupLock</code> may be accessed via <code>Run.GroupLock</code>.</p>
<h4 id='api-reference-extras-grouplock-constructor-pubkeys-m'>constructor(pubkeys, m)</h4>
<p><code>constructor(pubkeys: Array&lt;string&gt;, m: number): GroupLock</code></p>

<p>Creates a m-of-n <code>GroupLock</code> for the set of public keys.</p>
<h4 id='api-reference-extras-grouplock-pubkeys-array'>pubkeys: Array<string></h4>
<p>Array of public keys that are partial owners. There can be no more than 16 and they must be hex strings.</p>
<h4 id='api-reference-extras-grouplock-m-number'>m: number</h4>
<p>Number of signatures required to unlock the output. This is the m in m-of-n multi-sig.</p>
<h3 id='api-reference-extras-standardlock'>StandardLock</h3>
<blockquote>
<p>Send a token to a P2PKH address</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">token</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">StandardLock</span><span class="p">(</span><span class="nx">address</span><span class="p">))</span>
</code></pre>
<p><code>class StandardLock implements Lock { ... }</code></p>

<p>The <code>StandardLock</code> is the lock generated by Run when you specify an address or public key string as a resource&#39;s owner. This creates a standard P2PKH output for the jig or code.</p>

<p><code>StandardLock</code> may be accessed via <code>Run.StandardLock</code>.</p>
<h4 id='api-reference-extras-standardlock-constructor-address'>constructor(address)</h4>
<p><code>constructor(address: string): StandardLock</code></p>

<p>Creates a <code>StandardLock</code> for a specific address.</p>
<h4 id='api-reference-extras-standardlock-address'>address</h4>
<p><code>address: string</code></p>

<p>The address string for this lock.</p>
<h2 id='api-reference-apis'>APIs</h2>
<blockquote>
<p>Check if a custom owner implementation will be accepted by Run</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">MyOwner</span> <span class="p">{</span> <span class="cm">/* implementation */</span> <span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">new</span> <span class="nx">MyOwner</span><span class="p">()</span> <span class="k">instanceof</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">Owner</span><span class="p">)</span>
</code></pre>
<p>The APIs described here are interfaces that developers may implement to customize Run. You can think of them as plug-ins. Each API is available via <code>Run.api</code>. Developers may check that their implementation conforms to the interface by using <code>instanceof</code>. You do not have to extend from these base classes for an implementation to be valid.</p>
<h3 id='api-reference-apis-blockchain'>Blockchain</h3>
<p><code>class Blockchain { ... }</code></p>

<p>The interface run uses to communicate with the Bitcoin network. Run ships with two implementations: The <a href="#api-reference-modules-blockchain-api">BlockchainApi</a> and the <a href="#api-reference-modules-mockchain">Mockchain</a>. Developers may implement <code>Blockchain</code> to connect to the Bitcoin network in custom ways.</p>
<h4 id='api-reference-apis-blockchain-network'>network</h4>
<p><code>network: string</code></p>

<p>The general kind of network that Run connects to. One of <code>main</code>, <code>test</code>, <code>stn</code>, or <code>mock</code>.</p>
<h4 id='api-reference-apis-blockchain-broadcast-tx'>broadcast(tx)</h4>
<blockquote>
<p>Create and broadcast a simple transaction</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">bsv</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">().</span><span class="nx">from</span><span class="p">(</span><span class="nx">utxo</span><span class="p">).</span><span class="nx">to</span><span class="p">(</span><span class="nx">address</span><span class="p">,</span> <span class="nx">amount</span><span class="p">).</span><span class="nx">sign</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">blockchain</span><span class="p">.</span><span class="nx">broadcast</span><span class="p">(</span><span class="nx">tx</span><span class="p">)</span>
</code></pre>
<p><code>broadcast(tx: bsv.Transaction): Promise&lt;void&gt;</code></p>

<p>Submits a transaction to the network. A promise is returned that will resolve if the transaction was accepted or rejected with the error if the network did not accept the transaction.</p>

<p>The base class method throws an unimplemented error, so this must be overridden in derived blockchain classes.</p>
<h4 id='api-reference-apis-blockchain-fetch-txid'>fetch(txid)</h4>
<blockquote>
<p>Downloads a transaction from the network</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">txid</span> <span class="o">=</span> <span class="s1">'afc557ef2970af0b5fb8bc1a70a320af425c7a45ca5d40eac78475109563c5f8'</span>
<span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">blockchain</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">txid</span><span class="p">)</span>
</code></pre>
<p><code>fetch(txid: string, force: ?boolean): Promise&lt;bsv.Transaction&gt;</code></p>

<p>Downloads a transaction from the network. A promise is returned that will resolve with the transaction parsed using the <code>bsv</code> library or reject with the error if the transaction could not be returned. The optional <code>force</code> parameter requests that <code>fetch</code> re-query the blockchain and not return a cached copy. The returned transaction should also have additional properties set:</p>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>time</code></td>
<td>number</td>
<td>yes</td>
<td>The time in milliseconds when the transaction was accepted by a miner or included in a block.</td>
</tr>
<tr>
<td><code>blocktime</code></td>
<td>number</td>
<td>no</td>
<td>The time in milliseconds when the transaction was included in a block.</td>
</tr>
<tr>
<td><code>confirmations</code></td>
<td>number</td>
<td>no</td>
<td>The number of block confirmations for this transaction</td>
</tr>
<tr>
<td><code>blockhash</code></td>
<td>string</td>
<td>no</td>
<td>The hash of the block this transaction was included in</td>
</tr>
<tr>
<td><code>blockheight</code></td>
<td>number</td>
<td>no</td>
<td>The height of the block this transaction was included in, or -1 if the transaction is in the mempool.</td>
</tr>
<tr>
<td><code>outputs[i].spentTxId</code></td>
<td>string</td>
<td>no</td>
<td>The transaction id that spends this output, or null if unspent. This is required for forward syncing.</td>
</tr>
<tr>
<td><code>outputs[i].spentIndex</code></td>
<td>number</td>
<td>no</td>
<td>The input index in the transaction that spends this output, or null if unspent.</td>
</tr>
<tr>
<td><code>outputs[i].spentHeight</code></td>
<td>number</td>
<td>no</td>
<td>The block height of the transaction that spends this output, or -1 if the transaction is in the mempool.</td>
</tr>
</tbody></table>

<p>The base class method throws an unimplemented error, so this must be overridden in derived blockchain classes.</p>
<h4 id='api-reference-apis-blockchain-utxos-script'>utxos(script)</h4>
<blockquote>
<p>Downloads the current UTXOs for a given address</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">address</span> <span class="o">=</span> <span class="s1">'mpBU73vq9ajhkXknP1sNGe6wjXH7QtwmWm'</span>
<span class="kr">const</span> <span class="nx">script</span> <span class="o">=</span> <span class="nx">Script</span><span class="p">.</span><span class="nx">fromAddress</span><span class="p">(</span><span class="nx">address</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">utxos</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">blockchain</span><span class="p">.</span><span class="nx">utxos</span><span class="p">(</span><span class="nx">script</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">bsv</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">().</span><span class="nx">from</span><span class="p">(</span><span class="nx">utxos</span><span class="p">).</span><span class="nx">change</span><span class="p">(</span><span class="nx">address</span><span class="p">)</span>
</code></pre>
<p><code>utxos(script: bsv.Script): Promise&lt;Array&lt;{txid: string, vout: number, script: bsv.Script, satoshis: number}&gt;&gt;</code></p>

<p>Returns the unspent outputs for a given address. A promise is returned that will resolve with an array of UTXOs, which may be empty, or reject with an error. Each returned UTXO may be converted to a <code>bsv.Transaction.UnspentOutput</code> by passing into that constructor. The script passed into <code>utxos</code> will have a <code>hash</code> property available. You may use this to get a unique sha256d hash of the script for database or API queries.</p>
<h3 id='api-reference-apis-lock'>Lock</h3>
<blockquote>
<p>Send a token to a P2PK output script</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">PayToPublicKeyLock</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">pubkey</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">pubkey</span> <span class="o">=</span> <span class="nx">pubkey</span> <span class="p">}</span>
  <span class="nx">script</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">asm</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">pubkey</span><span class="p">}</span><span class="s2"> OP_CHECKSIG`</span><span class="p">)</span> <span class="p">}</span>
  <span class="nx">domain</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">74</span> <span class="p">}</span>
<span class="p">}</span>

<span class="nx">PayToPublicKeyLock</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">asm</span> <span class="p">}</span>

<span class="nx">token</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">PayToPublicKeyLock</span><span class="p">(</span><span class="nx">pubkey</span><span class="p">))</span>
</code></pre>
<p><code>class Lock { ... }</code></p>

<p>Locks are custom output scripts that may be assigned as owners to jigs and other resources. They are <a href="#how-it-works-javascript-serialization">arbitrary objects</a>, meaning they are actual typed objects with properties that are used to build an output script. This allows jig code to look for certain kinds of Locks. For example, perhaps a jig must be held by 3 people in a <a href="#api-reference-extras-grouplock">GroupLock</a> to it to be sent.</p>
<h4 id='api-reference-apis-lock-script'>script()</h4>
<p><code>script(): Uint8Array</code></p>

<p>Returns the output script for the current lock as a Uint8Array.</p>

<p>Run will call this method when building your transactions. Run provides the <a href="#api-reference-extras-asm">asm</a> utility function to more easily build these scripts. For best security, this function should always build the script when it&#39;s called and not cache the results.</p>
<h4 id='api-reference-apis-lock-domain'>domain()</h4>
<p><code>domain(): number</code></p>

<p>Returns the maximum size of this lock&#39;s unlocking script in bytes. Run uses this value to improve fee estimation for signatures exist by creating placeholders in unlocking scripts that are of size <code>domain()</code>.</p>

<p>Calculating the <code>domain</code> may depend on properties of the lock and it takes an understanding of Bitcoin script. As a rule of thumb, Bitcoin signatures are at most 74 bytes in script, and public keys when compressed are 34 bytes in script. It is best to err on the conservative side.</p>

<p>This method is named <em>domain</em> because locking scripts are predicate functions and their domains are the possible inputs scripts, whose maximum length is returned by this function.</p>
<h3 id='api-reference-apis-logger'>Logger</h3>
<blockquote>
<p>Write info, warn, and error messages to a file</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">FileLogger</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">stream</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createWriteStream</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="p">{</span> <span class="na">flags</span><span class="p">:</span> <span class="s1">'a'</span> <span class="p">})</span> <span class="p">}</span>

  <span class="nx">info</span><span class="p">(...</span><span class="nx">messages</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'INFO'</span><span class="p">,</span> <span class="p">...</span><span class="nx">messages</span><span class="p">)</span> <span class="p">}</span>
  <span class="nx">warn</span><span class="p">(...</span><span class="nx">messages</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'WARN'</span><span class="p">,</span> <span class="p">...</span><span class="nx">messages</span><span class="p">)</span> <span class="p">}</span>
  <span class="nx">error</span><span class="p">(...</span><span class="nx">messages</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'ERROR'</span><span class="p">,</span> <span class="p">...</span><span class="nx">messages</span><span class="p">)</span> <span class="p">}</span>

  <span class="nx">log</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="p">...</span><span class="nx">messages</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">stream</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">type</span><span class="p">}</span><span class="s2"> </span><span class="p">${</span><span class="nx">messages</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">' '</span><span class="p">)}</span><span class="s2"> \n`</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">logger</span><span class="p">:</span> <span class="k">new</span> <span class="nx">FileLogger</span><span class="p">(</span><span class="s1">'log.txt'</span><span class="p">)</span> <span class="p">})</span>
</code></pre>
<p><code>class Logger { ... }</code></p>

<p>A custom logger API that may be used to intercept Run logs and report them to a more desirable output. By default, Run will log errors and warnings to the console, but you may wish to log them to a custom file, or enable the info and debug logs too. It is not necessary to implement all methods below; whichever methods are implemented, Run will call.</p>
<h4 id='api-reference-apis-logger-info-messages'>info(...messages)</h4>
<p><code>info(...messages)</code></p>

<p>Called when Run is performing a major action, such as loading a jig, or querying a REST API.</p>
<h4 id='api-reference-apis-logger-error-messages'>error(...messages)</h4>
<p><code>error(...messages)</code></p>

<p>Called when Run detects an error. These are recommended for production logs.</p>
<h4 id='api-reference-apis-logger-warn-messages'>warn(...messages)</h4>
<p><code>warn(...messages)</code></p>

<p>Called when Run detects a possible error. These are recommended for production logs.</p>
<h4 id='api-reference-apis-logger-debug-messages'>debug(...messages)</h4>
<p><code>debug(...messages)</code></p>

<p>Called when Run creates debug messages. These will be more verbose than you would typically desire in production logs.</p>
<h3 id='api-reference-apis-owner'>Owner</h3>
<blockquote>
<p>An owner that runs on a REST server</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">RemoteWallet</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="nx">address</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">host</span> <span class="o">=</span> <span class="nx">host</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">address</span> <span class="o">=</span> <span class="nx">address</span>
  <span class="p">}</span>

  <span class="nx">owner</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">address</span> <span class="p">}</span>

  <span class="nx">async</span> <span class="nx">sign</span><span class="p">(</span><span class="nx">txhex</span><span class="p">,</span> <span class="nx">locks</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">method</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="s1">'Content-Type'</span><span class="p">:</span> <span class="s1">'application/json'</span> <span class="p">},</span>
        <span class="na">body</span><span class="p">:</span> <span class="p">{</span> <span class="nx">txhex</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="kr">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="s1">'/sign'</span><span class="p">,</span> <span class="nx">options</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span> <span class="o">=&gt;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">bsv</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p><code>class Owner { ... }</code></p>

<p>An owner of jigs and other resources.</p>

<p>Run calls this API to create new jigs and sign transactions for a user. It is different from the purse which is strictly for paying for transactions. This API supports both local and remote ownership with the <code>async</code> sign method.</p>
<h4 id='api-reference-apis-owner-owner'>owner()</h4>
<p><code>owner(): string|Lock|Array&lt;string|Lock&gt;</code></p>

<p>The owner address, pubkey, or lock, used to assign to new jigs created.</p>

<p>If this is an array, then the first entry is used for new jigs, and the rest are used only to sync the inventory.</p>
<h4 id='api-reference-apis-owner-sign-txhex-locks'>sign(txhex, locks)</h4>
<blockquote>
<p>Sign all resources that are P2PK outputs</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">async</span> <span class="nx">sign</span><span class="p">(</span><span class="nx">txhex</span><span class="p">,</span> <span class="nx">locks</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">bsv</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">(</span><span class="nx">txhex</span><span class="p">)</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">inputs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">locks</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="k">instanceof</span> <span class="nx">PayToPublicKeyLock</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">sig</span> <span class="o">=</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">signature</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">privateKey</span><span class="p">)</span>

      <span class="nx">tx</span><span class="p">.</span><span class="nx">inputs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">setScript</span><span class="p">(</span><span class="nx">sig</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s1">'hex'</span><span class="p">))</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s1">'hex'</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
<p><code>sign(txhex: string, locks: Array&lt;?Lock&gt;): Promise&lt;string&gt;</code></p>

<p>Signs the transaction for the current owner.</p>

<p>The locks array is the same size as the transaction&#39;s inputs, and contains a list of Locks that correspond to each resource&#39;s owner script, or undefined if the input is not a resource. The sign method may use these locks to determine which inputs to sign and how to sign them. If the resource&#39;s owner is an address or public key string, then the lock will be a <a href="#api-reference-extras-standardlock">StandardLock</a></p>

<p>Run adds a <code>signature</code> method to the transaction object that may be used to generate a signature for certain input. See the example on the right.</p>
<h3 id='api-reference-apis-purse'>Purse</h3>
<p><code>class Purse { ... }</code></p>

<p>The interface to pay for transactions and implement purse functionality in Run. The default <code>Purse</code> implementation is <a href="#api-reference-modules-localpurse">LocalPurse</a></p>
<h4 id='api-reference-apis-purse-pay-txhex'>pay(txhex)</h4>
<blockquote>
<p>Pay for a transaction using specific UTXOs</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">PayWithUtxos</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">utxos</span><span class="p">,</span> <span class="nx">privateKey</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">utxos</span> <span class="o">=</span> <span class="nx">utxos</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">privateKey</span> <span class="o">=</span> <span class="nx">privateKey</span>
    <span class="p">}</span>

    <span class="nx">async</span> <span class="nx">pay</span><span class="p">(</span><span class="nx">tx</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">bsv</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">(</span><span class="nx">txhex</span><span class="p">)</span>
        <span class="nx">tx</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">utxos</span><span class="p">)</span>
        <span class="nx">tx</span><span class="p">.</span><span class="nx">change</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">privateKey</span><span class="p">.</span><span class="nx">toAddress</span><span class="p">())</span>
        <span class="nx">tx</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">privateKey</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s1">'hex'</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">purse</span><span class="p">:</span> <span class="k">new</span> <span class="nx">PayWithUtxos</span><span class="p">(</span><span class="nx">utxos</span><span class="p">,</span> <span class="nx">privateKey</span><span class="p">)</span> <span class="p">})</span>
</code></pre>
<p><code>pay(txhex: string): Promise&lt;string&gt;</code></p>

<p>Adds payment inputs and outputs so that a Jig transaction will be accepted by miners. This is an asynchronous call that returns a promise. If an error is thrown, then state of all jigs in the current transaction will be reverted and the transaction will not be broadcasted.</p>

<p>This method may optionally sign the transaction, or it may sign in the <code>sign</code> method if it exists.</p>

<p>A third-party wallet may want to check that there are no non-dust outputs. This may happen if there are backed jigs.</p>
<h4 id='api-reference-apis-purse-broadcast-txhex'>broadcast(txhex)</h4>
<p><code>broadcast(txhex: string): Promise&lt;&gt;</code></p>

<p>A notification for purses when a transaction is about to be broadcast.</p>

<p>This method is optional but will be called for wallets to update their UTXOs. Wallets that choose to broadcast the transaction themselves should be prepared that the transaction might already been broadcasted by Run.</p>
<h3 id='api-reference-apis-state'>State</h3>
<blockquote>
<p>A state implementation that stores jig state in the browser&#39;s local storage</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">LocalStorageCache</span> <span class="p">{</span>
  <span class="nx">async</span> <span class="nx">get</span><span class="p">(</span><span class="nx">loc</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">loc</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">async</span> <span class="nx">set</span><span class="p">(</span><span class="nx">loc</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">loc</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">val</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p><code>class State { ... }</code></p>

<p>The interface for Run&#39;s state cache. The state cache is responsible for storing intermediate jig states so that they do not need to be recomputed from their history each time they are loaded. This API also enables third-party state servers to exist that provide intermediate state for jigs.</p>
<h4 id='api-reference-apis-state-get-location'>get(location)</h4>
<p><code>get(location: string): Promise&lt;?object&gt;</code></p>

<p>Gets the state for a particular location. Run will call this when loading jigs to see if it can short-circuit its loading. If a state exists and is valid, its state object should be returned. The state object is custom and should never be created from scratch. Instead, values should come from previous <code>set</code> calls to the State API. This method is asyncronous to allow for third-party network calls.</p>
<h4 id='api-reference-apis-state-set-location-state'>set(location, state)</h4>
<p><code>set(location: string, state: object): Promise&lt;void&gt;</code></p>

<p>Sets a state for a particular location. Run will call this whenever a new transaction is published and also when a jig is loaded. The State API should store and return the state in future <code>get</code> calls. This method is asyncronous to allow for third-party network calls.</p>
<h1 id='tools'>Tools</h1><h2 id='tools-explorer'>Explorer</h2>
<p>Run ships with an explorer that you may use to view jigs and code. It is an excellent way to test that your objects are working. To give it a go, open <code>getting_started.html</code> and click <strong>Explorer</strong>. Then, paste any location or address into the search box.</p>
<h2 id='tools-deploy'>Deploy</h2>
<blockquote>
<p>Generate keys and deploy code to testnet</p>
</blockquote>
<pre class="highlight plaintext"><code>&gt; ./deploy --test lib/dragon.js 

No purse keys found. Generate new keys? (y/n) y

    Success!

    Your private keys are in this .env file. Please keep it safe.

    /home/yolanda/myproject/.env

Now send some funds to your testnet address

    mims9NN2AEdEQ8ULcTPdgU8TdE34oojky9

    ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄
    █ ▄▄▄▄▄ █▄▀ ▀  ██▄▀▀█ █ ▄▄▄▄▄ █
    █ █   █ █   █▀  ▀▀█▄ ▀█ █   █ █
    █ █▄▄▄█ █▄█▀ ▄▄ ▄██▀  █ █▄▄▄█ █
    █▄▄▄▄▄▄▄█▄█ █ █▄▀▄▀▄█ █▄▄▄▄▄▄▄█
    █▄▄  █▀▄█ █ ▄ ▀▄██▄ ▄ ▄▀█ ▄▄▀ █
    █ ▄ █▄▀▄▄█  ▄▄ ▄█▄█▀▀▀▀ █▄▄█▄▀█
    █▄  ▄█▀▄ █ ▄▀   ▄▀▀▀████▄█▀▄▀▀█
    ██▄▀ █ ▄▄▀ ▀ ██▀▀ █ ▄▀ ▀ █▀▄▄▄█
    █▄▄█▀██▄▀▄▄▀█▄▄▀▀█▄ █ ▄▀ ▄▀▀█▄█
    █▄█▀▀  ▄█ ▄█▀███▄▀▀▄█▄█    ▀█▀█
    ██▄█▄██▄▄▀▄███▀▀▀▀▄ ▄ ▄▄▄   ▀ █
    █ ▄▄▄▄▄ ██▀▀▀▀▀ █▀▄▄█ █▄█ ▀█▄██
    █ █   █ █▀█▄ █▀▀▀▄ █▀ ▄▄  ▄▄▄ █
    █ █▄▄▄█ █   █ ▀▄▀▀▄▄▄█ █ ▀ ▄▀▄█
    █▄▄▄▄▄▄▄█▄▄█▄████▄▄▄▄▄█▄█▄██▄██


    Waiting for funds to be sent...

    Success! Received 3000000 satoshis

Deploying code to test

Dragon.locationTestnet = 'd9f9b15d73298bb807c3b22f62cb1f0b096d2a1c13678a9d29836a6fb538f901_o6'
Dragon.originTestnet = 'd9f9b15d73298bb807c3b22f62cb1f0b096d2a1c13678a9d29836a6fb538f901_o6'
Dragon.ownerTestnet = 'mjs1rSdsm6tGAKdm79cUQ4rYXY1kvho34v'

Success! Presets saved.
</code></pre>
<p>Deploying your jig classes ahead of time is a great best practice. It allows code to be re-used across jigs, and jigs to safely rely on types. For example, an event may only accept tickets that are instances of a <code>SpecificTicket</code> class. Pre-deployed classes make this possible, and save blockchain space and fees too! 🌎</p>

<p>Deploying code yourself is possible, but to help, Run ships with a <code>deploy</code> tool. <code>deploy</code> is a command-line program to deploy your jig classes and update their presets. It can be found as <code>dist/deploy</code> and it is a self-contained app.</p>

<p>To use <code>deploy</code>, you&#39;ll specify:</p>

<ul>
<li><strong>files</strong> - which files you wish to deploy (ex. <code>my-jigs/**</code>)</li>
<li><strong>network</strong> - which networks to deploy to (ex. <code>main</code>)</li>
<li><strong>purse</strong> - which purses to use (ex. <code>&lt;private key&gt;</code>)</li>
</ul>

<p><code>deploy</code> will find which classes to deploy based on your module&#39;s exports, deploy them to each blockchain, print out your new presets, and then update your source code to save <a href="#advanced-usage-code-presets">the presets</a>. </p>

<p>To setup your purse keys, it is recommended that you create a <code>.env</code> file to persist them. If you run <code>deploy</code> without a purse, it&#39;ll prompt you to create a new <code>.env</code> file and fund your new keys, as seen to the right. You can also pass a pre-existing purse on the command line. For example: <code>deploy --purse=&lt;my key&gt; --main my-jigs.js</code>.</p>

<p>For more details, see <code>deploy --help</code>.</p>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>

  <!-- Twemoji provides the emoji asset in one of the examples -->
  <script src="https://twemoji.maxcdn.com/2/twemoji.min.js?12.0.4" crossorigin="anonymous"></script>

  <script>
    twemoji.parse(document.body)
  </script>

</html>
